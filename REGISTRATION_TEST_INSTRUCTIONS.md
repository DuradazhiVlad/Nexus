# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

## 1. –í–∏–∫–æ–Ω–∞–π—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç–∏

### –°–ø–æ—á–∞—Ç–∫—É –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤:
```sql
-- –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤ Supabase Dashboard SQL Editor
-- –§–∞–π–ª: fix_registration_trigger.sql
```

### –ü–æ—Ç—ñ–º –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç:
```sql
-- –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤ Supabase Dashboard SQL Editor
-- –§–∞–π–ª: test_registration.sql
```

## 2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—å

### –¢–∞–±–ª–∏—Ü—è auth.users:
- `id` (uuid) - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
- `email` (varchar) - email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `encrypted_password` (varchar) - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å
- `email_confirmed_at` (timestamp) - —á–∞—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email
- `raw_user_meta_data` (jsonb) - –º–µ—Ç–∞–¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (—ñ–º'—è, –ø—Ä—ñ–∑–≤–∏—â–µ)
- `created_at` (timestamp) - —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
- `updated_at` (timestamp) - —á–∞—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

### –¢–∞–±–ª–∏—Ü—è user_profiles:
- `id` (uuid) - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
- `auth_user_id` (uuid) - –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ auth.users
- `name` (text) - —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `last_name` (text) - –ø—Ä—ñ–∑–≤–∏—â–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `email` (text) - email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `hobbies` (text[]) - –º–∞—Å–∏–≤ —Ö–æ–±—ñ
- `languages` (text[]) - –º–∞—Å–∏–≤ –º–æ–≤
- `notifications` (jsonb) - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
- `privacy` (jsonb) - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—ñ
- `created_at` (timestamp) - —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
- `updated_at` (timestamp) - —á–∞—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

## 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

### –ö—Ä–æ–∫ 1: –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–æ–¥–∞—Ç–æ–∫
```bash
npm run dev
```

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
- –í—ñ–¥–∫—Ä–∏–π—Ç–µ http://localhost:5173/register
- –ê–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è" –≤ –º–µ–Ω—é

### –ö—Ä–æ–∫ 3: –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
- **–Ü–º'—è**: –í–≤–µ–¥—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–µ —ñ–º'—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–¢–µ—Å—Ç")
- **–ü—Ä—ñ–∑–≤–∏—â–µ**: –í–≤–µ–¥—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–µ –ø—Ä—ñ–∑–≤–∏—â–µ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á")
- **Email**: –í–≤–µ–¥—ñ—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π email (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "test@example.com")
- **–ü–∞—Ä–æ–ª—å**: –í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤

### –ö—Ä–æ–∫ 4: –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è"

### –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

#### –í –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–≤–∏–Ω–Ω—ñ –∑'—è–≤–∏—Ç–∏—Å—è –ª–æ–≥–∏:
```
üöÄ Starting registration process...
‚úÖ Auth signup successful: [user_id]
üìù Creating user profile...
‚úÖ User profile created successfully
```

#### –í Supabase Dashboard –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

1. **–¢–∞–±–ª–∏—Ü—è auth.users**:
```sql
SELECT 
    id,
    email,
    email_confirmed_at,
    raw_user_meta_data,
    created_at
FROM auth.users 
ORDER BY created_at DESC 
LIMIT 1;
```

2. **–¢–∞–±–ª–∏—Ü—è user_profiles**:
```sql
SELECT 
    id,
    auth_user_id,
    name,
    last_name,
    email,
    hobbies,
    languages,
    notifications,
    privacy,
    created_at
FROM user_profiles 
ORDER BY created_at DESC 
LIMIT 1;
```

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–≤'—è–∑–æ–∫**:
```sql
SELECT 
    au.id as auth_user_id,
    au.email as auth_email,
    up.name as profile_name,
    up.last_name as profile_last_name,
    up.hobbies,
    up.languages
FROM auth.users au
JOIN user_profiles up ON au.id = up.auth_user_id
WHERE au.email = 'test@example.com';
```

## 4. –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### ‚úÖ –£—Å–ø—ñ—à–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è:
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤ `auth.users`
- –ü—Ä–æ—Ñ—ñ–ª—å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤ `user_profiles`
- –í—Å—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- `hobbies` —Ç–∞ `languages` - –ø–æ—Ä–æ–∂–Ω—ñ –º–∞—Å–∏–≤–∏
- `notifications` —Ç–∞ `privacy` - JSON –æ–±'—î–∫—Ç–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

### ‚ùå –ú–æ–∂–ª–∏–≤—ñ –ø–æ–º–∏–ª–∫–∏:
- **Email –≤–∂–µ —ñ—Å–Ω—É—î**: –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–∏–π email
- **–ü–∞—Ä–æ–ª—å –∑–∞–Ω–∞–¥—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏–π**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤
- **–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
- **–¢—Ä–∏–≥–µ—Ä –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é `handle_new_user`

## 5. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –Ø–∫—â–æ –ø—Ä–æ—Ñ—ñ–ª—å –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç—Ä–∏–≥–µ—Ä–∏
SELECT 
    trigger_name,
    event_manipulation,
    event_object_table,
    action_statement
FROM information_schema.triggers 
WHERE event_object_table = 'users' AND event_object_schema = 'auth';

-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é
SELECT 
    routine_name,
    routine_definition
FROM information_schema.routines 
WHERE routine_name = 'handle_new_user';
```

### –Ø–∫—â–æ RLS –±–ª–æ–∫—É—î –æ–ø–µ—Ä–∞—Ü—ñ—ó:
```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
SELECT 
    schemaname,
    tablename,
    policyname,
    permissive,
    roles,
    cmd,
    qual,
    with_check
FROM pg_policies 
WHERE tablename = 'user_profiles';
```

## 6. –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç–µ—Å—Ç–∏

### –¢–µ—Å—Ç –∑ —Ä—ñ–∑–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏:
- –°–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –∑ —Ä—ñ–∑–Ω–∏–º–∏ —ñ–º–µ–Ω–∞–º–∏ —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–∞–º–∏
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∫–∏—Ä–∏–ª–∏—á–Ω—ñ —Å–∏–º–≤–æ–ª–∏
- –¢–µ—Å—Ç—É–π—Ç–µ –∑ –¥–æ–≤–≥–∏–º–∏ —ñ–º–µ–Ω–∞–º–∏

### –¢–µ—Å—Ç –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:
- –°–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–º email
- –°–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –∑ –∫–æ—Ä–æ—Ç–∫–∏–º –ø–∞—Ä–æ–ª–µ–º
- –°–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ –ø–æ–ª—è–º–∏

### –¢–µ—Å—Ç –¥—É–±–ª—é–≤–∞–Ω–Ω—è:
- –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è –∑ —Ç–∏–º —Å–∞–º–∏–º email –¥–≤—ñ—á—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –ø–æ–º–∏–ª–∫–∞

## 7. –û—á–∏—â–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

–ü—ñ—Å–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ:
```sql
-- –í–∏–¥–∞–ª—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
DELETE FROM user_profiles WHERE email = 'test@example.com';
DELETE FROM auth.users WHERE email = 'test@example.com';
``` 