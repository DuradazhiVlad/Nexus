# Виправлення проблем з постами

## Проблеми, які були виправлені:

### 1. Пости не рахують кількість друзів
**Виправлено:** Додано поле `friends_count` до таблиці `user_profiles` та автоматичні тригери для оновлення кількості друзів.

### 2. Пости не можна видалити
**Виправлено:** 
- Оновлено функцію `deletePost` в `postService.ts` для перевірки прав користувача
- Додано RLS політику для видалення постів
- Додано видалення лайків та коментарів перед видаленням поста

### 3. Фото не можна додати
**Виправлено:** 
- Додано функціональність завантаження файлів до компонента `Wall.tsx`
- Додано кнопку завантаження з підтримкою зображень та відео
- Додано превью завантажених файлів
- Додано валідацію розміру та типу файлів

## Що потрібно зробити:

### 1. Виконати SQL скрипт
Відкрийте Supabase Dashboard → SQL Editor та виконайте файл `fix_posts_and_friends.sql`

### 2. Перевірити зміни
Після виконання SQL скрипту перевірте:
- Чи з'явилося поле `friends_count` в таблиці `user_profiles`
- Чи працює завантаження фото в постах
- Чи можна видаляти пости
- Чи відображається кількість друзів у постах

### 3. Тестування функціональності

#### Завантаження фото:
1. Відкрийте сторінку "Стрічка"
2. Натисніть на іконку завантаження (Upload)
3. Виберіть зображення або відео
4. Перевірте, чи з'являється превью
5. Опублікуйте пост

#### Видалення постів:
1. Створіть пост
2. Натисніть на три крапки біля поста
3. Виберіть "Видалити"
4. Підтвердіть видалення

#### Перевірка кількості друзів:
1. Додайте кілька друзів
2. Створіть пост
3. Перевірте, чи відображається кількість друзів під іменем автора

## Файли, які були змінені:

1. `src/lib/postService.ts` - оновлено функції для роботи з постами
2. `src/pages/wall/Wall.tsx` - додано завантаження файлів та відображення кількості друзів
3. `fix_posts_and_friends.sql` - SQL скрипт для виправлення бази даних

## Додаткові покращення:

- Додано валідацію файлів (розмір до 5MB, тільки зображення та відео)
- Додано індикатор завантаження
- Додано можливість видалення завантаженого файлу перед публікацією
- Покращено обробку помилок
- Додано автоматичне оновлення кількості друзів при додаванні/видаленні дружби

## Якщо щось не працює:

1. Перевірте консоль браузера на наявність помилок
2. Перевірте, чи виконаний SQL скрипт
3. Перевірте, чи правильно налаштовані RLS політики
4. Перевірте, чи створений bucket `media` в Supabase Storage 