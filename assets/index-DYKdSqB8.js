import{r as d,a as Ft,b as Fe}from"./vendor-BPcwhftq.js";import{u as We,L as os,N as He,a as Dt,b as Ut,R as At,c as Ce,B as Lt}from"./router-Bz_1EYEn.js";import{c as ut}from"./supabase-BmfSc9Wy.js";import{G as Rt,M as mt,L as Be,U as As,C as Js,a as cs,B as Zs,b as ds,S as Mt,c as Ps,d as ys,H as es,e as us,P as Vt,f as Pt,I as Ls,X as ve,V as $s,g as $t,h as js,i as $e,j as Ge,k as Ot,l as It,T as xt,m as Xs,n as Tt,Z as qt,o as xs,p as ms,q as Gt,r as Rs,E as ht,s as as,t as Bt,u as ft,v as Wt,w as Ht,x as Jt,y as Zt,z as Xt,A as Qt,D as Os,F as gt,J as ls,K as Je,N as vs,O as Kt,Q as Yt,R as er,W as sr,Y as tr,_ as rr,$ as ar,a0 as lr,a1 as Ds,a2 as ir,a3 as Ms,a4 as nr,a5 as or,a6 as cr,a7 as Qs,a8 as dr,a9 as ur}from"./ui-C2N9xj_f.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();var bt={exports:{}},_s={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mr=d,xr=Symbol.for("react.element"),hr=Symbol.for("react.fragment"),fr=Object.prototype.hasOwnProperty,gr=mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,br={key:!0,ref:!0,__self:!0,__source:!0};function pt(s,r,t){var a,o={},l=null,i=null;t!==void 0&&(l=""+t),r.key!==void 0&&(l=""+r.key),r.ref!==void 0&&(i=r.ref);for(a in r)fr.call(r,a)&&!br.hasOwnProperty(a)&&(o[a]=r[a]);if(s&&s.defaultProps)for(a in r=s.defaultProps,r)o[a]===void 0&&(o[a]=r[a]);return{$$typeof:xr,type:s,key:l,ref:i,props:o,_owner:gr.current}}_s.Fragment=hr;_s.jsx=pt;_s.jsxs=pt;bt.exports=_s;var e=bt.exports,yt,Ks=Ft;yt=Ks.createRoot,Ks.hydrateRoot;const pr="https://gtfgvqttfydelzgvgwly.supabase.co",yr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0Zmd2cXR0ZnlkZWx6Z3Znd2x5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjE0OTEsImV4cCI6MjA1OTU5NzQ5MX0.nBdVMHZ6LJ8ZvdSuXk_uDVMb6DxB5iTeFdc0dM7zolI",T=ut(pr,yr);function jr(){const[s,r]=d.useState(""),[t,a]=d.useState(""),[o,l]=d.useState(""),[i,g]=d.useState(!1),p=We(),P=async E=>{E.preventDefault(),l(""),g(!0);try{const{error:v}=await T.auth.signInWithPassword({email:s,password:t});if(v)throw v;p("/profile")}catch(v){console.error("Login error:",v),l(v.message||"Помилка входу")}finally{g(!1)}},h=async()=>{try{const{error:E}=await T.auth.signInWithOAuth({provider:"github",options:{redirectTo:`${window.location.origin}/profile`,queryParams:{access_type:"offline",prompt:"consent"}}});if(E)throw E}catch(E){console.error("GitHub login error:",E),l(E.message||"Помилка входу через GitHub")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Вхід до аккаунту"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Або"," ",e.jsx(os,{to:"/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"створіть новий аккаунт"})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[o&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:o}),e.jsxs("button",{onClick:h,className:"w-full flex justify-center items-center gap-2 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 mb-6",children:[e.jsx(Rt,{size:20}),"Увійти через GitHub"]}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Або увійдіть за допомогою email"})})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(mt,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"email",type:"email",value:s,onChange:E=>r(E.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Пароль"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(Be,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"password",type:"password",value:t,onChange:E=>a(E.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть пароль",required:!0})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:i,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Завантаження...":"Увійти"})})]})]})})]})}function vr(){const[s,r]=d.useState(""),[t,a]=d.useState(""),[o,l]=d.useState(""),[i,g]=d.useState(""),[p,P]=d.useState(""),[h,E]=d.useState(!1),v=We(),M=async y=>{y.preventDefault(),P(""),E(!0);try{const{data:_,error:D}=await T.auth.signUp({email:o,password:i});if(D)throw D;if(_.user){const{error:W}=await T.from("users").insert([{auth_user_id:_.user.id,name:s,lastName:t,email:o,date:new Date().toISOString()}]);if(W)throw W;v("/profile/confirm")}}catch(_){console.error("Registration error:",_),P(_.message||"Помилка реєстрації")}finally{E(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Створення нового аккаунту"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Або"," ",e.jsx(os,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"увійдіть в існуючий аккаунт"})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[p&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:p}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Ім'я"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(As,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"name",type:"text",value:s,onChange:y=>r(y.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть ім'я",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700",children:"Прізвище"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(As,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"lastName",type:"text",value:t,onChange:y=>a(y.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть прізвище",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(mt,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"email",type:"email",value:o,onChange:y=>l(y.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Пароль"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(Be,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"password",type:"password",value:i,onChange:y=>g(y.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть пароль",required:!0,minLength:6})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Завантаження...":"Зареєструватися"})})]})]})})]})}var hs=s=>s.type==="checkbox",Ze=s=>s instanceof Date,je=s=>s==null;const jt=s=>typeof s=="object";var oe=s=>!je(s)&&!Array.isArray(s)&&jt(s)&&!Ze(s),Nr=s=>oe(s)&&s.target?hs(s.target)?s.target.checked:s.target.value:s,wr=s=>s.substring(0,s.search(/\.\d+(\.|$)/))||s,kr=(s,r)=>s.has(wr(r)),_r=s=>{const r=s.constructor&&s.constructor.prototype;return oe(r)&&r.hasOwnProperty("isPrototypeOf")},Is=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function fe(s){let r;const t=Array.isArray(s),a=typeof FileList<"u"?s instanceof FileList:!1;if(s instanceof Date)r=new Date(s);else if(!(Is&&(s instanceof Blob||a))&&(t||oe(s)))if(r=t?[]:{},!t&&!_r(s))r=s;else for(const o in s)s.hasOwnProperty(o)&&(r[o]=fe(s[o]));else return s;return r}var Ss=s=>/^\w*$/.test(s),ue=s=>s===void 0,Ts=s=>Array.isArray(s)?s.filter(Boolean):[],qs=s=>Ts(s.replace(/["|']|\]/g,"").split(/\.|\[/)),R=(s,r,t)=>{if(!r||!oe(s))return t;const a=(Ss(r)?[r]:qs(r)).reduce((o,l)=>je(o)?o:o[l],s);return ue(a)||a===s?ue(s[r])?t:s[r]:a},Ve=s=>typeof s=="boolean",ie=(s,r,t)=>{let a=-1;const o=Ss(r)?[r]:qs(r),l=o.length,i=l-1;for(;++a<l;){const g=o[a];let p=t;if(a!==i){const P=s[g];p=oe(P)||Array.isArray(P)?P:isNaN(+o[a+1])?{}:[]}if(g==="__proto__"||g==="constructor"||g==="prototype")return;s[g]=p,s=s[g]}};const Ys={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},De={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ie={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Sr=Fe.createContext(null);Sr.displayName="HookFormContext";var Cr=(s,r,t,a=!0)=>{const o={defaultValues:r._defaultValues};for(const l in s)Object.defineProperty(o,l,{get:()=>{const i=l;return r._proxyFormState[i]!==De.all&&(r._proxyFormState[i]=!a||De.all),s[i]}});return o};const Er=typeof window<"u"?d.useLayoutEffect:d.useEffect;var Pe=s=>typeof s=="string",zr=(s,r,t,a,o)=>Pe(s)?(a&&r.watch.add(s),R(t,s,o)):Array.isArray(s)?s.map(l=>(a&&r.watch.add(l),R(t,l))):(a&&(r.watchAll=!0),t),Fr=(s,r,t,a,o)=>r?{...t[s],types:{...t[s]&&t[s].types?t[s].types:{},[a]:o||!0}}:{},is=s=>Array.isArray(s)?s:[s],et=()=>{let s=[];return{get observers(){return s},next:o=>{for(const l of s)l.next&&l.next(o)},subscribe:o=>(s.push(o),{unsubscribe:()=>{s=s.filter(l=>l!==o)}}),unsubscribe:()=>{s=[]}}},Vs=s=>je(s)||!jt(s);function qe(s,r,t=new WeakSet){if(Vs(s)||Vs(r))return s===r;if(Ze(s)&&Ze(r))return s.getTime()===r.getTime();const a=Object.keys(s),o=Object.keys(r);if(a.length!==o.length)return!1;if(t.has(s)||t.has(r))return!0;t.add(s),t.add(r);for(const l of a){const i=s[l];if(!o.includes(l))return!1;if(l!=="ref"){const g=r[l];if(Ze(i)&&Ze(g)||oe(i)&&oe(g)||Array.isArray(i)&&Array.isArray(g)?!qe(i,g,t):i!==g)return!1}}return!0}var we=s=>oe(s)&&!Object.keys(s).length,Gs=s=>s.type==="file",Ue=s=>typeof s=="function",Ns=s=>{if(!Is)return!1;const r=s?s.ownerDocument:0;return s instanceof(r&&r.defaultView?r.defaultView.HTMLElement:HTMLElement)},vt=s=>s.type==="select-multiple",Bs=s=>s.type==="radio",Dr=s=>Bs(s)||hs(s),Us=s=>Ns(s)&&s.isConnected;function Ur(s,r){const t=r.slice(0,-1).length;let a=0;for(;a<t;)s=ue(s)?a++:s[r[a++]];return s}function Ar(s){for(const r in s)if(s.hasOwnProperty(r)&&!ue(s[r]))return!1;return!0}function de(s,r){const t=Array.isArray(r)?r:Ss(r)?[r]:qs(r),a=t.length===1?s:Ur(s,t),o=t.length-1,l=t[o];return a&&delete a[l],o!==0&&(oe(a)&&we(a)||Array.isArray(a)&&Ar(a))&&de(s,t.slice(0,-1)),s}var Nt=s=>{for(const r in s)if(Ue(s[r]))return!0;return!1};function ws(s,r={}){const t=Array.isArray(s);if(oe(s)||t)for(const a in s)Array.isArray(s[a])||oe(s[a])&&!Nt(s[a])?(r[a]=Array.isArray(s[a])?[]:{},ws(s[a],r[a])):je(s[a])||(r[a]=!0);return r}function wt(s,r,t){const a=Array.isArray(s);if(oe(s)||a)for(const o in s)Array.isArray(s[o])||oe(s[o])&&!Nt(s[o])?ue(r)||Vs(t[o])?t[o]=Array.isArray(s[o])?ws(s[o],[]):{...ws(s[o])}:wt(s[o],je(r)?{}:r[o],t[o]):t[o]=!qe(s[o],r[o]);return t}var ts=(s,r)=>wt(s,r,ws(r));const st={value:!1,isValid:!1},tt={value:!0,isValid:!0};var kt=s=>{if(Array.isArray(s)){if(s.length>1){const r=s.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:r,isValid:!!r.length}}return s[0].checked&&!s[0].disabled?s[0].attributes&&!ue(s[0].attributes.value)?ue(s[0].value)||s[0].value===""?tt:{value:s[0].value,isValid:!0}:tt:st}return st},_t=(s,{valueAsNumber:r,valueAsDate:t,setValueAs:a})=>ue(s)?s:r?s===""?NaN:s&&+s:t&&Pe(s)?new Date(s):a?a(s):s;const rt={isValid:!1,value:null};var St=s=>Array.isArray(s)?s.reduce((r,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:r,rt):rt;function at(s){const r=s.ref;return Gs(r)?r.files:Bs(r)?St(s.refs).value:vt(r)?[...r.selectedOptions].map(({value:t})=>t):hs(r)?kt(s.refs).value:_t(ue(r.value)?s.ref.value:r.value,s)}var Lr=(s,r,t,a)=>{const o={};for(const l of s){const i=R(r,l);i&&ie(o,l,i._f)}return{criteriaMode:t,names:[...s],fields:o,shouldUseNativeValidation:a}},ks=s=>s instanceof RegExp,rs=s=>ue(s)?s:ks(s)?s.source:oe(s)?ks(s.value)?s.value.source:s.value:s,lt=s=>({isOnSubmit:!s||s===De.onSubmit,isOnBlur:s===De.onBlur,isOnChange:s===De.onChange,isOnAll:s===De.all,isOnTouch:s===De.onTouched});const it="AsyncFunction";var Rr=s=>!!s&&!!s.validate&&!!(Ue(s.validate)&&s.validate.constructor.name===it||oe(s.validate)&&Object.values(s.validate).find(r=>r.constructor.name===it)),Mr=s=>s.mount&&(s.required||s.min||s.max||s.maxLength||s.minLength||s.pattern||s.validate),nt=(s,r,t)=>!t&&(r.watchAll||r.watch.has(s)||[...r.watch].some(a=>s.startsWith(a)&&/^\.\w+/.test(s.slice(a.length))));const ns=(s,r,t,a)=>{for(const o of t||Object.keys(s)){const l=R(s,o);if(l){const{_f:i,...g}=l;if(i){if(i.refs&&i.refs[0]&&r(i.refs[0],o)&&!a)return!0;if(i.ref&&r(i.ref,i.name)&&!a)return!0;if(ns(g,r))break}else if(oe(g)&&ns(g,r))break}}};function ot(s,r,t){const a=R(s,t);if(a||Ss(t))return{error:a,name:t};const o=t.split(".");for(;o.length;){const l=o.join("."),i=R(r,l),g=R(s,l);if(i&&!Array.isArray(i)&&t!==l)return{name:t};if(g&&g.type)return{name:l,error:g};if(g&&g.root&&g.root.type)return{name:`${l}.root`,error:g.root};o.pop()}return{name:t}}var Vr=(s,r,t,a)=>{t(s);const{name:o,...l}=s;return we(l)||Object.keys(l).length>=Object.keys(r).length||Object.keys(l).find(i=>r[i]===(!a||De.all))},Pr=(s,r,t)=>!s||!r||s===r||is(s).some(a=>a&&(t?a===r:a.startsWith(r)||r.startsWith(a))),$r=(s,r,t,a,o)=>o.isOnAll?!1:!t&&o.isOnTouch?!(r||s):(t?a.isOnBlur:o.isOnBlur)?!s:(t?a.isOnChange:o.isOnChange)?s:!0,Or=(s,r)=>!Ts(R(s,r)).length&&de(s,r),Ir=(s,r,t)=>{const a=is(R(s,t));return ie(a,"root",r[t]),ie(s,t,a),s},ps=s=>Pe(s);function ct(s,r,t="validate"){if(ps(s)||Array.isArray(s)&&s.every(ps)||Ve(s)&&!s)return{type:t,message:ps(s)?s:"",ref:r}}var Ye=s=>oe(s)&&!ks(s)?s:{value:s,message:""},dt=async(s,r,t,a,o,l)=>{const{ref:i,refs:g,required:p,maxLength:P,minLength:h,min:E,max:v,pattern:M,validate:y,name:_,valueAsNumber:D,mount:W}=s._f,A=R(t,_);if(!W||r.has(_))return{};const G=g?g[0]:i,B=j=>{o&&G.reportValidity&&(G.setCustomValidity(Ve(j)?"":j||""),G.reportValidity())},q={},re=Bs(i),K=hs(i),O=re||K,U=(D||Gs(i))&&ue(i.value)&&ue(A)||Ns(i)&&i.value===""||A===""||Array.isArray(A)&&!A.length,z=Fr.bind(null,_,a,q),x=(j,b,V,Z=Ie.maxLength,Y=Ie.minLength)=>{const ne=j?b:V;q[_]={type:j?Z:Y,message:ne,ref:i,...z(j?Z:Y,ne)}};if(l?!Array.isArray(A)||!A.length:p&&(!O&&(U||je(A))||Ve(A)&&!A||K&&!kt(g).isValid||re&&!St(g).isValid)){const{value:j,message:b}=ps(p)?{value:!!p,message:p}:Ye(p);if(j&&(q[_]={type:Ie.required,message:b,ref:G,...z(Ie.required,b)},!a))return B(b),q}if(!U&&(!je(E)||!je(v))){let j,b;const V=Ye(v),Z=Ye(E);if(!je(A)&&!isNaN(A)){const Y=i.valueAsNumber||A&&+A;je(V.value)||(j=Y>V.value),je(Z.value)||(b=Y<Z.value)}else{const Y=i.valueAsDate||new Date(A),ne=ke=>new Date(new Date().toDateString()+" "+ke),he=i.type=="time",ye=i.type=="week";Pe(V.value)&&A&&(j=he?ne(A)>ne(V.value):ye?A>V.value:Y>new Date(V.value)),Pe(Z.value)&&A&&(b=he?ne(A)<ne(Z.value):ye?A<Z.value:Y<new Date(Z.value))}if((j||b)&&(x(!!j,V.message,Z.message,Ie.max,Ie.min),!a))return B(q[_].message),q}if((P||h)&&!U&&(Pe(A)||l&&Array.isArray(A))){const j=Ye(P),b=Ye(h),V=!je(j.value)&&A.length>+j.value,Z=!je(b.value)&&A.length<+b.value;if((V||Z)&&(x(V,j.message,b.message),!a))return B(q[_].message),q}if(M&&!U&&Pe(A)){const{value:j,message:b}=Ye(M);if(ks(j)&&!A.match(j)&&(q[_]={type:Ie.pattern,message:b,ref:i,...z(Ie.pattern,b)},!a))return B(b),q}if(y){if(Ue(y)){const j=await y(A,t),b=ct(j,G);if(b&&(q[_]={...b,...z(Ie.validate,b.message)},!a))return B(b.message),q}else if(oe(y)){let j={};for(const b in y){if(!we(j)&&!a)break;const V=ct(await y[b](A,t),G,b);V&&(j={...V,...z(b,V.message)},B(V.message),a&&(q[_]=j))}if(!we(j)&&(q[_]={ref:G,...j},!a))return q}}return B(!0),q};const Tr={mode:De.onSubmit,reValidateMode:De.onChange,shouldFocusError:!0};function qr(s={}){let r={...Tr,...s},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:Ue(r.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1},a={},o=oe(r.defaultValues)||oe(r.values)?fe(r.defaultValues||r.values)||{}:{},l=r.shouldUnregister?{}:fe(o),i={action:!1,mount:!1,watch:!1},g={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},p,P=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let E={...h};const v={array:et(),state:et()},M=r.criteriaMode===De.all,y=n=>c=>{clearTimeout(P),P=setTimeout(n,c)},_=async n=>{if(!r.disabled&&(h.isValid||E.isValid||n)){const c=r.resolver?we((await K()).errors):await U(a,!0);c!==t.isValid&&v.state.next({isValid:c})}},D=(n,c)=>{!r.disabled&&(h.isValidating||h.validatingFields||E.isValidating||E.validatingFields)&&((n||Array.from(g.mount)).forEach(f=>{f&&(c?ie(t.validatingFields,f,c):de(t.validatingFields,f))}),v.state.next({validatingFields:t.validatingFields,isValidating:!we(t.validatingFields)}))},W=(n,c=[],f,F,C=!0,k=!0)=>{if(F&&f&&!r.disabled){if(i.action=!0,k&&Array.isArray(R(a,n))){const $=f(R(a,n),F.argA,F.argB);C&&ie(a,n,$)}if(k&&Array.isArray(R(t.errors,n))){const $=f(R(t.errors,n),F.argA,F.argB);C&&ie(t.errors,n,$),Or(t.errors,n)}if((h.touchedFields||E.touchedFields)&&k&&Array.isArray(R(t.touchedFields,n))){const $=f(R(t.touchedFields,n),F.argA,F.argB);C&&ie(t.touchedFields,n,$)}(h.dirtyFields||E.dirtyFields)&&(t.dirtyFields=ts(o,l)),v.state.next({name:n,isDirty:x(n,c),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else ie(l,n,c)},A=(n,c)=>{ie(t.errors,n,c),v.state.next({errors:t.errors})},G=n=>{t.errors=n,v.state.next({errors:t.errors,isValid:!1})},B=(n,c,f,F)=>{const C=R(a,n);if(C){const k=R(l,n,ue(f)?R(o,n):f);ue(k)||F&&F.defaultChecked||c?ie(l,n,c?k:at(C._f)):V(n,k),i.mount&&_()}},q=(n,c,f,F,C)=>{let k=!1,$=!1;const ee={name:n};if(!r.disabled){if(!f||F){(h.isDirty||E.isDirty)&&($=t.isDirty,t.isDirty=ee.isDirty=x(),k=$!==ee.isDirty);const te=qe(R(o,n),c);$=!!R(t.dirtyFields,n),te?de(t.dirtyFields,n):ie(t.dirtyFields,n,!0),ee.dirtyFields=t.dirtyFields,k=k||(h.dirtyFields||E.dirtyFields)&&$!==!te}if(f){const te=R(t.touchedFields,n);te||(ie(t.touchedFields,n,f),ee.touchedFields=t.touchedFields,k=k||(h.touchedFields||E.touchedFields)&&te!==f)}k&&C&&v.state.next(ee)}return k?ee:{}},re=(n,c,f,F)=>{const C=R(t.errors,n),k=(h.isValid||E.isValid)&&Ve(c)&&t.isValid!==c;if(r.delayError&&f?(p=y(()=>A(n,f)),p(r.delayError)):(clearTimeout(P),p=null,f?ie(t.errors,n,f):de(t.errors,n)),(f?!qe(C,f):C)||!we(F)||k){const $={...F,...k&&Ve(c)?{isValid:c}:{},errors:t.errors,name:n};t={...t,...$},v.state.next($)}},K=async n=>{D(n,!0);const c=await r.resolver(l,r.context,Lr(n||g.mount,a,r.criteriaMode,r.shouldUseNativeValidation));return D(n),c},O=async n=>{const{errors:c}=await K(n);if(n)for(const f of n){const F=R(c,f);F?ie(t.errors,f,F):de(t.errors,f)}else t.errors=c;return c},U=async(n,c,f={valid:!0})=>{for(const F in n){const C=n[F];if(C){const{_f:k,...$}=C;if(k){const ee=g.array.has(k.name),te=C._f&&Rr(C._f);te&&h.validatingFields&&D([F],!0);const Ne=await dt(C,g.disabled,l,M,r.shouldUseNativeValidation&&!c,ee);if(te&&h.validatingFields&&D([F]),Ne[k.name]&&(f.valid=!1,c))break;!c&&(R(Ne,k.name)?ee?Ir(t.errors,Ne,k.name):ie(t.errors,k.name,Ne[k.name]):de(t.errors,k.name))}!we($)&&await U($,c,f)}}return f.valid},z=()=>{for(const n of g.unMount){const c=R(a,n);c&&(c._f.refs?c._f.refs.every(f=>!Us(f)):!Us(c._f.ref))&&X(n)}g.unMount=new Set},x=(n,c)=>!r.disabled&&(n&&c&&ie(l,n,c),!qe(ke(),o)),j=(n,c,f)=>zr(n,g,{...i.mount?l:ue(c)?o:Pe(n)?{[n]:c}:c},f,c),b=n=>Ts(R(i.mount?l:o,n,r.shouldUnregister?R(o,n,[]):[])),V=(n,c,f={})=>{const F=R(a,n);let C=c;if(F){const k=F._f;k&&(!k.disabled&&ie(l,n,_t(c,k)),C=Ns(k.ref)&&je(c)?"":c,vt(k.ref)?[...k.ref.options].forEach($=>$.selected=C.includes($.value)):k.refs?hs(k.ref)?k.refs.forEach($=>{(!$.defaultChecked||!$.disabled)&&(Array.isArray(C)?$.checked=!!C.find(ee=>ee===$.value):$.checked=C===$.value||!!C)}):k.refs.forEach($=>$.checked=$.value===C):Gs(k.ref)?k.ref.value="":(k.ref.value=C,k.ref.type||v.state.next({name:n,values:fe(l)})))}(f.shouldDirty||f.shouldTouch)&&q(n,C,f.shouldTouch,f.shouldDirty,!0),f.shouldValidate&&ye(n)},Z=(n,c,f)=>{for(const F in c){if(!c.hasOwnProperty(F))return;const C=c[F],k=n+"."+F,$=R(a,k);(g.array.has(n)||oe(C)||$&&!$._f)&&!Ze(C)?Z(k,C,f):V(k,C,f)}},Y=(n,c,f={})=>{const F=R(a,n),C=g.array.has(n),k=fe(c);ie(l,n,k),C?(v.array.next({name:n,values:fe(l)}),(h.isDirty||h.dirtyFields||E.isDirty||E.dirtyFields)&&f.shouldDirty&&v.state.next({name:n,dirtyFields:ts(o,l),isDirty:x(n,k)})):F&&!F._f&&!je(k)?Z(n,k,f):V(n,k,f),nt(n,g)&&v.state.next({...t}),v.state.next({name:i.mount?n:void 0,values:fe(l)})},ne=async n=>{i.mount=!0;const c=n.target;let f=c.name,F=!0;const C=R(a,f),k=te=>{F=Number.isNaN(te)||Ze(te)&&isNaN(te.getTime())||qe(te,R(l,f,te))},$=lt(r.mode),ee=lt(r.reValidateMode);if(C){let te,Ne;const Xe=c.type?at(C._f):Nr(n),Me=n.type===Ys.BLUR||n.type===Ys.FOCUS_OUT,Cs=!Mr(C._f)&&!r.resolver&&!R(t.errors,f)&&!C._f.deps||$r(Me,R(t.touchedFields,f),t.isSubmitted,ee,$),ss=nt(f,g,Me);ie(l,f,Xe),Me?(C._f.onBlur&&C._f.onBlur(n),p&&p(0)):C._f.onChange&&C._f.onChange(n);const Qe=q(f,Xe,Me),Es=!we(Qe)||ss;if(!Me&&v.state.next({name:f,type:n.type,values:fe(l)}),Cs)return(h.isValid||E.isValid)&&(r.mode==="onBlur"?Me&&_():Me||_()),Es&&v.state.next({name:f,...ss?{}:Qe});if(!Me&&ss&&v.state.next({...t}),r.resolver){const{errors:fs}=await K([f]);if(k(Xe),F){const zs=ot(t.errors,a,f),gs=ot(fs,a,zs.name||f);te=gs.error,f=gs.name,Ne=we(fs)}}else D([f],!0),te=(await dt(C,g.disabled,l,M,r.shouldUseNativeValidation))[f],D([f]),k(Xe),F&&(te?Ne=!1:(h.isValid||E.isValid)&&(Ne=await U(a,!0)));F&&(C._f.deps&&ye(C._f.deps),re(f,Ne,te,Qe))}},he=(n,c)=>{if(R(t.errors,c)&&n.focus)return n.focus(),1},ye=async(n,c={})=>{let f,F;const C=is(n);if(r.resolver){const k=await O(ue(n)?n:C);f=we(k),F=n?!C.some($=>R(k,$)):f}else n?(F=(await Promise.all(C.map(async k=>{const $=R(a,k);return await U($&&$._f?{[k]:$}:$)}))).every(Boolean),!(!F&&!t.isValid)&&_()):F=f=await U(a);return v.state.next({...!Pe(n)||(h.isValid||E.isValid)&&f!==t.isValid?{}:{name:n},...r.resolver||!n?{isValid:f}:{},errors:t.errors}),c.shouldFocus&&!F&&ns(a,he,n?C:g.mount),F},ke=n=>{const c={...i.mount?l:o};return ue(n)?c:Pe(n)?R(c,n):n.map(f=>R(c,f))},Le=(n,c)=>({invalid:!!R((c||t).errors,n),isDirty:!!R((c||t).dirtyFields,n),error:R((c||t).errors,n),isValidating:!!R(t.validatingFields,n),isTouched:!!R((c||t).touchedFields,n)}),Se=n=>{n&&is(n).forEach(c=>de(t.errors,c)),v.state.next({errors:n?t.errors:{}})},Re=(n,c,f)=>{const F=(R(a,n,{_f:{}})._f||{}).ref,C=R(t.errors,n)||{},{ref:k,message:$,type:ee,...te}=C;ie(t.errors,n,{...te,...c,ref:F}),v.state.next({name:n,errors:t.errors,isValid:!1}),f&&f.shouldFocus&&F&&F.focus&&F.focus()},u=(n,c)=>Ue(n)?v.state.subscribe({next:f=>n(j(void 0,c),f)}):j(n,c,!0),w=n=>v.state.subscribe({next:c=>{Pr(n.name,c.name,n.exact)&&Vr(c,n.formState||h,se,n.reRenderRoot)&&n.callback({values:{...l},...t,...c})}}).unsubscribe,I=n=>(i.mount=!0,E={...E,...n.formState},w({...n,formState:E})),X=(n,c={})=>{for(const f of n?is(n):g.mount)g.mount.delete(f),g.array.delete(f),c.keepValue||(de(a,f),de(l,f)),!c.keepError&&de(t.errors,f),!c.keepDirty&&de(t.dirtyFields,f),!c.keepTouched&&de(t.touchedFields,f),!c.keepIsValidating&&de(t.validatingFields,f),!r.shouldUnregister&&!c.keepDefaultValue&&de(o,f);v.state.next({values:fe(l)}),v.state.next({...t,...c.keepDirty?{isDirty:x()}:{}}),!c.keepIsValid&&_()},be=({disabled:n,name:c})=>{(Ve(n)&&i.mount||n||g.disabled.has(c))&&(n?g.disabled.add(c):g.disabled.delete(c))},J=(n,c={})=>{let f=R(a,n);const F=Ve(c.disabled)||Ve(r.disabled);return ie(a,n,{...f||{},_f:{...f&&f._f?f._f:{ref:{name:n}},name:n,mount:!0,...c}}),g.mount.add(n),f?be({disabled:Ve(c.disabled)?c.disabled:r.disabled,name:n}):B(n,!0,c.value),{...F?{disabled:c.disabled||r.disabled}:{},...r.progressive?{required:!!c.required,min:rs(c.min),max:rs(c.max),minLength:rs(c.minLength),maxLength:rs(c.maxLength),pattern:rs(c.pattern)}:{},name:n,onChange:ne,onBlur:ne,ref:C=>{if(C){J(n,c),f=R(a,n);const k=ue(C.value)&&C.querySelectorAll&&C.querySelectorAll("input,select,textarea")[0]||C,$=Dr(k),ee=f._f.refs||[];if($?ee.find(te=>te===k):k===f._f.ref)return;ie(a,n,{_f:{...f._f,...$?{refs:[...ee.filter(Us),k,...Array.isArray(R(o,n))?[{}]:[]],ref:{type:k.type,name:n}}:{ref:k}}}),B(n,!1,void 0,k)}else f=R(a,n,{}),f._f&&(f._f.mount=!1),(r.shouldUnregister||c.shouldUnregister)&&!(kr(g.array,n)&&i.action)&&g.unMount.add(n)}}},ze=()=>r.shouldFocusError&&ns(a,he,g.mount),Oe=n=>{Ve(n)&&(v.state.next({disabled:n}),ns(a,(c,f)=>{const F=R(a,f);F&&(c.disabled=F._f.disabled||n,Array.isArray(F._f.refs)&&F._f.refs.forEach(C=>{C.disabled=F._f.disabled||n}))},0,!1))},N=(n,c)=>async f=>{let F;f&&(f.preventDefault&&f.preventDefault(),f.persist&&f.persist());let C=fe(l);if(v.state.next({isSubmitting:!0}),r.resolver){const{errors:k,values:$}=await K();t.errors=k,C=fe($)}else await U(a);if(g.disabled.size)for(const k of g.disabled)de(C,k);if(de(t.errors,"root"),we(t.errors)){v.state.next({errors:{}});try{await n(C,f)}catch(k){F=k}}else c&&await c({...t.errors},f),ze(),setTimeout(ze);if(v.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:we(t.errors)&&!F,submitCount:t.submitCount+1,errors:t.errors}),F)throw F},H=(n,c={})=>{R(a,n)&&(ue(c.defaultValue)?Y(n,fe(R(o,n))):(Y(n,c.defaultValue),ie(o,n,fe(c.defaultValue))),c.keepTouched||de(t.touchedFields,n),c.keepDirty||(de(t.dirtyFields,n),t.isDirty=c.defaultValue?x(n,fe(R(o,n))):x()),c.keepError||(de(t.errors,n),h.isValid&&_()),v.state.next({...t}))},le=(n,c={})=>{const f=n?fe(n):o,F=fe(f),C=we(n),k=C?o:F;if(c.keepDefaultValues||(o=f),!c.keepValues){if(c.keepDirtyValues){const $=new Set([...g.mount,...Object.keys(ts(o,l))]);for(const ee of Array.from($))R(t.dirtyFields,ee)?ie(k,ee,R(l,ee)):Y(ee,R(k,ee))}else{if(Is&&ue(n))for(const $ of g.mount){const ee=R(a,$);if(ee&&ee._f){const te=Array.isArray(ee._f.refs)?ee._f.refs[0]:ee._f.ref;if(Ns(te)){const Ne=te.closest("form");if(Ne){Ne.reset();break}}}}if(c.keepFieldsRef)for(const $ of g.mount)Y($,R(k,$));else a={}}l=r.shouldUnregister?c.keepDefaultValues?fe(o):{}:fe(k),v.array.next({values:{...k}}),v.state.next({values:{...k}})}g={mount:c.keepDirtyValues?g.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!h.isValid||!!c.keepIsValid||!!c.keepDirtyValues,i.watch=!!r.shouldUnregister,v.state.next({submitCount:c.keepSubmitCount?t.submitCount:0,isDirty:C?!1:c.keepDirty?t.isDirty:!!(c.keepDefaultValues&&!qe(n,o)),isSubmitted:c.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:C?{}:c.keepDirtyValues?c.keepDefaultValues&&l?ts(o,l):t.dirtyFields:c.keepDefaultValues&&n?ts(o,n):c.keepDirty?t.dirtyFields:{},touchedFields:c.keepTouched?t.touchedFields:{},errors:c.keepErrors?t.errors:{},isSubmitSuccessful:c.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},ae=(n,c)=>le(Ue(n)?n(l):n,c),ce=(n,c={})=>{const f=R(a,n),F=f&&f._f;if(F){const C=F.refs?F.refs[0]:F.ref;C.focus&&(C.focus(),c.shouldSelect&&Ue(C.select)&&C.select())}},se=n=>{t={...t,...n}},_e={control:{register:J,unregister:X,getFieldState:Le,handleSubmit:N,setError:Re,_subscribe:w,_runSchema:K,_focusError:ze,_getWatch:j,_getDirty:x,_setValid:_,_setFieldArray:W,_setDisabledField:be,_setErrors:G,_getFieldArray:b,_reset:le,_resetDefaultValues:()=>Ue(r.defaultValues)&&r.defaultValues().then(n=>{ae(n,r.resetOptions),v.state.next({isLoading:!1})}),_removeUnmounted:z,_disableForm:Oe,_subjects:v,_proxyFormState:h,get _fields(){return a},get _formValues(){return l},get _state(){return i},set _state(n){i=n},get _defaultValues(){return o},get _names(){return g},set _names(n){g=n},get _formState(){return t},get _options(){return r},set _options(n){r={...r,...n}}},subscribe:I,trigger:ye,register:J,handleSubmit:N,watch:u,setValue:Y,getValues:ke,reset:ae,resetField:H,clearErrors:Se,unregister:X,setError:Re,setFocus:ce,getFieldState:Le};return{..._e,formControl:_e}}function Gr(s={}){const r=Fe.useRef(void 0),t=Fe.useRef(void 0),[a,o]=Fe.useState({isDirty:!1,isValidating:!1,isLoading:Ue(s.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1,isReady:!1,defaultValues:Ue(s.defaultValues)?void 0:s.defaultValues});if(!r.current)if(s.formControl)r.current={...s.formControl,formState:a},s.defaultValues&&!Ue(s.defaultValues)&&s.formControl.reset(s.defaultValues,s.resetOptions);else{const{formControl:i,...g}=qr(s);r.current={...g,formState:a}}const l=r.current.control;return l._options=s,Er(()=>{const i=l._subscribe({formState:l._proxyFormState,callback:()=>o({...l._formState}),reRenderRoot:!0});return o(g=>({...g,isReady:!0})),l._formState.isReady=!0,i},[l]),Fe.useEffect(()=>l._disableForm(s.disabled),[l,s.disabled]),Fe.useEffect(()=>{s.mode&&(l._options.mode=s.mode),s.reValidateMode&&(l._options.reValidateMode=s.reValidateMode)},[l,s.mode,s.reValidateMode]),Fe.useEffect(()=>{s.errors&&(l._setErrors(s.errors),l._focusError())},[l,s.errors]),Fe.useEffect(()=>{s.shouldUnregister&&l._subjects.state.next({values:l._getWatch()})},[l,s.shouldUnregister]),Fe.useEffect(()=>{if(l._proxyFormState.isDirty){const i=l._getDirty();i!==a.isDirty&&l._subjects.state.next({isDirty:i})}},[l,a.isDirty]),Fe.useEffect(()=>{s.values&&!qe(s.values,t.current)?(l._reset(s.values,{keepFieldsRef:!0,...l._options.resetOptions}),t.current=s.values,o(i=>({...i}))):l._resetDefaultValues()},[l,s.values]),Fe.useEffect(()=>{l._state.mount||(l._setValid(),l._state.mount=!0),l._state.watch&&(l._state.watch=!1,l._subjects.state.next({...l._formState})),l._removeUnmounted()}),r.current.formState=Cr(a,l),r.current}const Br="https://gtfgvqttfydelzgvgwly.supabase.co",Wr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0Zmd2cXR0ZnlkZWx6Z3Znd2x5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcyMTU5NzYsImV4cCI6MjA1Mjc5MTk3Nn0.dNzHZJlEk6mAgbQhQ3V_DGCw86_c-1vCcmPjKEtJN1o",Ee=ut(Br,Wr);class pe{static get(r,t=null){try{const a=localStorage.getItem(r);return a?JSON.parse(a):t}catch{return t}}static set(r,t){try{localStorage.setItem(r,JSON.stringify(t))}catch(a){console.error("Error saving to localStorage:",a)}}static remove(r){try{localStorage.removeItem(r)}catch(t){console.error("Error removing from localStorage:",t)}}}class ge{static async checkTableExists(r){try{const{error:t}=await Ee.from(r).select("id").limit(1);return!t||t.code!=="42P01"}catch{return!1}}static generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}static async updateCounters(r){try{const t=pe.get("nexus_posts",[]),a=pe.get("nexus_groups",[]),o=pe.get("nexus_friends",[]),l=t.filter(g=>g.user_id===r),i=a.filter(g=>g.created_by===r);return{postsCount:l.length,groupsCount:i.length,friendsCount:o.length}}catch{return{postsCount:0,groupsCount:0,friendsCount:0}}}static async getCurrentUserProfile(){var r,t,a,o,l,i,g;try{const{data:{user:p}}=await Ee.auth.getUser();if(!p)return console.error("No authenticated user found"),null;try{const{data:v,error:M}=await Ee.from("users").select("*").eq("auth_user_id",p.id).maybeSingle();if(v&&!M){const y=await this.updateCounters(v.id);return{...v,...y}}}catch{console.log("Database not available, using local storage")}const P=pe.get("nexus_users",{});let h=P[p.id];h||(h={id:this.generateId(),auth_user_id:p.id,email:p.email,name:((r=p.user_metadata)==null?void 0:r.name)||((a=(t=p.user_metadata)==null?void 0:t.full_name)==null?void 0:a.split(" ")[0])||((o=p.email)==null?void 0:o.split("@")[0])||"Користувач",lastname:((l=p.user_metadata)==null?void 0:l.lastname)||((g=(i=p.user_metadata)==null?void 0:i.full_name)==null?void 0:g.split(" ").slice(1).join(" "))||"Дурадажи",bio:"Люблю програмування, подорожі та хорошу каву. Завжди відкритий до нових знайомств! ☕️",location:"Київ, Україна",website:"https://example.com",phone:"+380501234567",birthday:"1995-05-15",work:"Senior Frontend Developer",education:"КПІ ім. Ігоря Сікорського",relationshipStatus:"Неодружений",isVerified:!0,isOnline:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),hobbies:["Програмування","Фотографія","Подорожі","Музика"],languages:["Українська","English","Русский"]},P[p.id]=h,pe.set("nexus_users",P));const E=await this.updateCounters(h.id);return{...h,...E}}catch(p){return console.error("Error in getCurrentUserProfile:",p),null}}static async updateUserProfile(r){try{const{data:{user:t}}=await Ee.auth.getUser();if(!t)throw new Error("No authenticated user");try{const{id:l,auth_user_id:i,email:g,created_at:p,...P}=r,h={...P,updated_at:new Date().toISOString()},{data:E,error:v}=await Ee.from("users").update(h).eq("auth_user_id",t.id).select().single();if(E&&!v){const M=await this.updateCounters(E.id);return{...E,...M}}}catch{console.log("Database not available, using local storage")}const a=pe.get("nexus_users",{}),o=a[t.id];if(o){const l={...o,...r,updated_at:new Date().toISOString()};a[t.id]=l,pe.set("nexus_users",a);const i=await this.updateCounters(l.id);return{...l,...i}}return null}catch(t){throw console.error("Error in updateUserProfile:",t),t}}static async getUserPosts(r){try{try{let l=Ee.from("posts").select(`
            *,
            user:users(*)
          `).order("created_at",{ascending:!1});r&&(l=l.eq("user_id",r));const{data:i,error:g}=await l;if(i&&!g)return i}catch{console.log("Database not available, using local storage")}const t=pe.get("nexus_posts",[]),a=pe.get("nexus_users",{});let o=t;return r&&(o=t.filter(l=>l.user_id===r)),o.map(l=>{const i=Object.values(a).find(g=>g.id===l.user_id);return{...l,user:i||null}}).sort((l,i)=>new Date(i.created_at).getTime()-new Date(l.created_at).getTime())}catch(t){return console.error("Error in getUserPosts:",t),[]}}static async createPost(r,t,a){try{const o=await this.getCurrentUserProfile();if(!o)throw new Error("User profile not found");const l={id:this.generateId(),user_id:o.id,content:r,media_url:t,media_type:a,created_at:new Date().toISOString(),likes_count:0,comments_count:0};try{const{data:g,error:p}=await Ee.from("posts").insert([l]).select(`
            *,
            user:users(*)
          `).single();if(g&&!p)return g}catch{console.log("Database not available, using local storage")}const i=pe.get("nexus_posts",[]);return i.unshift(l),pe.set("nexus_posts",i),{...l,user:o}}catch(o){throw console.error("Error in createPost:",o),o}}static async deletePost(r){try{try{const{error:o}=await Ee.from("posts").delete().eq("id",r);if(!o)return!0}catch{console.log("Database not available, using local storage")}const a=pe.get("nexus_posts",[]).filter(o=>o.id!==r);return pe.set("nexus_posts",a),!0}catch(t){return console.error("Error in deletePost:",t),!1}}static async getGroups(){try{try{const{data:t,error:a}=await Ee.from("groups").select(`
            *,
            created_by_profile:users!groups_created_by_fkey(*)
          `).eq("is_active",!0).order("created_at",{ascending:!1});if(t&&!a)return t}catch{console.log("Database not available, using local storage")}return pe.get("nexus_groups",[{id:"group-1",name:"Програмісти України",description:"Спільнота українських розробників для обміну досвідом та знаннями",category:"Технології",is_private:!1,created_by:"demo-user",created_at:new Date().toISOString(),member_count:1245,post_count:156,tags:["JavaScript","Python","React","Node.js"],location:"Київ, Україна",is_verified:!0,is_active:!0},{id:"group-2",name:"UI/UX Дизайнери",description:"Група для дизайнерів інтерфейсів. Діліться роботами та отримуйте фідбек",category:"Дизайн",is_private:!1,created_by:"demo-user-2",created_at:new Date().toISOString(),member_count:687,post_count:89,tags:["UI","UX","Figma","Design"],location:"Львів, Україна",is_verified:!1,is_active:!0}])}catch(r){return console.error("Error in getGroups:",r),[]}}static async createGroup(r){try{const t=await this.getCurrentUserProfile();if(!t)throw new Error("User profile not found");const a={id:this.generateId(),...r,created_by:t.id,is_private:r.is_private||!1,member_count:1,post_count:0,is_verified:!1,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),last_activity:new Date().toISOString()};try{const{data:l,error:i}=await Ee.from("groups").insert([a]).select(`
            *,
            created_by_profile:users!groups_created_by_fkey(*)
          `).single();if(l&&!i)return l}catch{console.log("Database not available, using local storage")}const o=pe.get("nexus_groups",[]);return o.unshift(a),pe.set("nexus_groups",o),{...a,created_by_profile:t}}catch(t){throw console.error("Error in createGroup:",t),t}}static async getFriends(){try{try{const{data:{user:r}}=await Ee.auth.getUser();if(r){const t=await this.getCurrentUserProfile();if(t){const{data:a,error:o}=await Ee.from("friendships").select(`
                *,
                user1:users!friendships_user1_id_fkey(*),
                user2:users!friendships_user2_id_fkey(*)
              `).or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`);if(a&&!o)return a.map(i=>i.user1_id===t.id?i.user2:i.user1).filter(Boolean)}}}catch{console.log("Database not available, using local storage")}return[{id:"friend-1",email:"anna@example.com",name:"Анна",lastname:"Іваненко",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b31c?auto=format&fit=crop&w=200&q=80",bio:"UI/UX дизайнер з пристрастю до створення красивих інтерфейсів",location:"Львів, Україна",work:"UI/UX Designer",isOnline:!0,friendsCount:156,postsCount:23,groupsCount:4},{id:"friend-2",email:"max@example.com",name:"Максим",lastname:"Петренко",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=200&q=80",bio:"Full-stack розробник з досвідом роботи в стартапах",location:"Одеса, Україна",work:"Full-stack Developer",isOnline:!1,friendsCount:89,postsCount:45,groupsCount:2},{id:"friend-3",email:"ivan@example.com",name:"Іван",lastname:"Коваленко",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=200&q=80",bio:"Ентузіаст технологій та любитель кави",location:"Харків, Україна",work:"Product Manager",isOnline:!0,friendsCount:234,postsCount:67,groupsCount:7}]}catch(r){return console.error("Error in getFriends:",r),[]}}static async sendFriendRequest(r){try{return console.log("Sending friend request to:",r),!0}catch(t){return console.error("Error in sendFriendRequest:",t),!1}}static async getFriendRequests(){try{return[]}catch(r){return console.error("Error in getFriendRequests:",r),[]}}static async uploadMedia(r,t="media"){try{return URL.createObjectURL(r)}catch(a){return console.error("Error in uploadMedia:",a),null}}}const Hr=()=>{const[s,r]=d.useState("posts"),[t,a]=d.useState(!1),[o,l]=d.useState(!1),[i,g]=d.useState(null),[p,P]=d.useState([]),[h,E]=d.useState(!0),[v,M]=d.useState(""),[y,_]=d.useState(null),[D,W]=d.useState(null),A=d.useRef(null),{register:G,handleSubmit:B,setValue:q,formState:{errors:re}}=Gr();d.useEffect(()=>{K()},[]);const K=async()=>{try{E(!0);const b=await ge.getCurrentUserProfile();b&&(g(b),q("name",b.name||""),q("lastname",b.lastname||""),q("bio",b.bio||""),q("location",b.location||""),q("website",b.website||""),q("phone",b.phone||""),q("birthday",b.birthday||""),q("work",b.work||""),q("education",b.education||""),q("relationshipStatus",b.relationshipStatus||""),O(b.id))}catch(b){console.error("Error loading profile data:",b)}finally{E(!1)}},O=async b=>{try{const V=await ge.getUserPosts(b);P(V)}catch(V){console.error("Error loading posts:",V)}},U=async b=>{try{if(!i)return;const V=await ge.updateUserProfile({...b,id:i.id});V&&(g(V),a(!1))}catch(V){console.error("Error updating profile:",V),alert("Помилка оновлення профілю")}},z=async()=>{try{if(!v.trim())return;let b=null,V=null;y&&(b=await ge.uploadMedia(y),V=y.type.startsWith("image/")?"photo":y.type.startsWith("video/")?"video":"document");const Z=await ge.createPost(v,b,V);Z&&(P(Y=>[Z,...Y]),M(""),_(null),W(null),l(!1),K())}catch(b){console.error("Error creating post:",b),alert("Помилка створення посту")}},x=b=>{var Z;const V=(Z=b.target.files)==null?void 0:Z[0];if(V)if(_(V),V.type.startsWith("image/")){const Y=new FileReader;Y.onload=ne=>{var he;W((he=ne.target)==null?void 0:he.result)},Y.readAsDataURL(V)}else W(null)},j=b=>b?new Date(b).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric"}):"";return h?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):i?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"relative h-48 sm:h-64 md:h-80 bg-gradient-to-r from-blue-400 to-purple-500",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20"}),e.jsx("button",{className:"absolute top-4 right-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-2 rounded-full transition-all",children:e.jsx(Js,{size:20})})]}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end space-y-4 sm:space-y-0 sm:space-x-6 -mt-16 sm:-mt-20",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(i.name)}&size=128&background=3b82f6&color=fff`,alt:i.name,className:"w-24 h-24 sm:w-28 sm:h-28 md:w-32 md:h-32 rounded-full border-4 border-white shadow-lg object-cover"}),e.jsx("button",{className:"absolute bottom-1 right-1 bg-blue-500 hover:bg-blue-600 text-white p-1.5 rounded-full shadow-lg transition-colors",children:e.jsx(Js,{size:14})})]}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start space-x-2 mb-2",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:[i.name," ",i.lastname]}),i.isVerified&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"✓"})})]}),i.bio&&e.jsx("p",{className:"text-gray-600 mt-1 max-w-md",children:i.bio}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center sm:justify-start gap-4 mt-2 text-sm text-gray-500",children:[i.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(cs,{size:14}),i.location]}),i.work&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Zs,{size:14}),i.work]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ds,{size:14}),"Приєднався ",j(i.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Mt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Редагувати"})]}),e.jsx("button",{className:"flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors",children:e.jsx(Ps,{size:16})})]})]}),e.jsxs("div",{className:"flex items-center justify-center sm:justify-start space-x-8 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:p.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Постів"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.friendsCount||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Друзів"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.groupsCount||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Груп"})]}),i.isVerified&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:"✓"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Верифікований"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 mt-8",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsxs("button",{onClick:()=>r("posts"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${s==="posts"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Пости (",p.length,")"]}),e.jsx("button",{onClick:()=>r("about"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${s==="about"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Інформація"}),e.jsx("button",{onClick:()=>r("media"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${s==="media"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Медіа"})]})}),e.jsxs("div",{className:"py-6",children:[s==="posts"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("button",{onClick:()=>l(!0),className:"w-full text-left text-gray-500 bg-gray-50 hover:bg-gray-100 rounded-lg p-3 transition-colors",children:["Що у вас нового, ",i.name,"?"]})}),p.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(ys,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Поки що немає постів"}),e.jsx("button",{onClick:()=>l(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Створити перший пост"})]}):p.map(b=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("img",{src:i.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(i.name)}&size=48&background=3b82f6&color=fff`,alt:i.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[i.name," ",i.lastname]}),i.isVerified&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsx("span",{className:"text-gray-500 text-sm",children:j(b.created_at)})]}),e.jsx("p",{className:"text-gray-800 mt-2",children:b.content}),b.media_url&&e.jsx("div",{className:"mt-3",children:b.media_type==="photo"?e.jsx("img",{src:b.media_url,alt:"Post media",className:"rounded-lg max-w-full h-auto"}):e.jsx("div",{className:"bg-gray-100 rounded-lg p-4",children:e.jsxs("p",{className:"text-gray-600",children:["📎 Файл: ",b.media_type]})})}),e.jsxs("div",{className:"flex items-center space-x-6 mt-4 text-gray-500",children:[e.jsxs("button",{className:"flex items-center space-x-1 hover:text-red-500 transition-colors",children:[e.jsx(es,{size:20}),e.jsx("span",{children:b.likes_count})]}),e.jsxs("button",{className:"flex items-center space-x-1 hover:text-blue-500 transition-colors",children:[e.jsx(ys,{size:20}),e.jsx("span",{children:b.comments_count})]})]})]})]})},b.id))]}),s==="about"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-4",children:"Особиста інформація"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(cs,{className:"text-gray-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.location||"Не вказано"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ds,{className:"text-gray-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.birthday?j(i.birthday):"Не вказано"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(us,{className:"text-gray-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.website?e.jsx("a",{href:i.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:i.website}):"Не вказано"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Vt,{className:"text-gray-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.phone||"Не вказано"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-4",children:"Професійна інформація"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Zs,{className:"text-gray-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.work||"Не вказано"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Pt,{className:"text-gray-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.education||"Не вказано"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-4",children:"Сімейний стан"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(es,{className:"text-red-400",size:20}),e.jsx("span",{className:"text-gray-700",children:i.relationshipStatus||"Не вказано"})]})]}),i.hobbies&&i.hobbies.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-4",children:"Інтереси"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.hobbies.map((b,V)=>e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:b},V))})]})]}),s==="media"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-4",children:"Медіа файли"}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ls,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{children:"Медіа файли будуть відображатись тут"})]})]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Редагувати профіль"}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ve,{size:24})})]}),e.jsxs("form",{onSubmit:B(U),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ім'я"}),e.jsx("input",{type:"text",...G("name",{required:"Ім'я обов'язкове"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),re.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:re.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Прізвище"}),e.jsx("input",{type:"text",...G("lastname"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Про себе"}),e.jsx("textarea",{...G("bio"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Місцезнаходження"}),e.jsx("input",{type:"text",...G("location"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Веб-сайт"}),e.jsx("input",{type:"url",...G("website"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон"}),e.jsx("input",{type:"tel",...G("phone"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"День народження"}),e.jsx("input",{type:"date",...G("birthday"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Робота"}),e.jsx("input",{type:"text",...G("work"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Освіта"}),e.jsx("input",{type:"text",...G("education"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Сімейний стан"}),e.jsxs("select",{...G("relationshipStatus"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Не вказано"}),e.jsx("option",{value:"Неодружений",children:"Неодружений"}),e.jsx("option",{value:"Одружений",children:"Одружений"}),e.jsx("option",{value:"У стосунках",children:"У стосунках"}),e.jsx("option",{value:"Все складно",children:"Все складно"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Скасувати"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Зберегти"})]})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Створити пост"}),e.jsx("button",{onClick:()=>{l(!1),M(""),_(null),W(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ve,{size:24})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx("img",{src:i.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(i.name)}&size=48&background=3b82f6&color=fff`,alt:i.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"font-semibold text-gray-900",children:[i.name," ",i.lastname]})})]}),e.jsx("textarea",{value:v,onChange:b=>M(b.target.value),placeholder:`Що у вас нового, ${i.name}?`,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4}),D&&e.jsxs("div",{className:"mt-4 relative",children:[e.jsx("img",{src:D,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>{_(null),W(null)},className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white p-1 rounded-full",children:e.jsx(ve,{size:16})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{var b;return(b=A.current)==null?void 0:b.click()},className:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Додати фото",children:e.jsx(Ls,{size:20})}),e.jsx("button",{className:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Додати відео",children:e.jsx($s,{size:20})}),e.jsx("button",{className:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Прикріпити файл",children:e.jsx($t,{size:20})})]}),e.jsx("button",{onClick:z,disabled:!v.trim(),className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:"Опублікувати"})]}),e.jsx("input",{ref:A,type:"file",accept:"image/*,video/*",onChange:x,className:"hidden"})]})]})})]}):e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Профіль не знайдено"}),e.jsx("p",{className:"text-gray-600",children:"Спробуйте оновити сторінку"})]})})};function Ae(){const s=We(),r=async()=>{try{const{error:t}=await T.auth.signOut();if(t)throw t;s("/login")}catch(t){console.error("Error logging out:",t)}};return e.jsxs("div",{className:"w-64 bg-white h-screen fixed left-0 top-0 border-r border-gray-200",children:[e.jsx("div",{className:"p-4",children:e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Соціальна мережа"})}),e.jsxs("nav",{className:"mt-8",children:[e.jsxs(He,{to:"/profile",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(js,{className:"w-5 h-5 mr-3"}),"Профіль"]}),e.jsxs(He,{to:"/people",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx($e,{className:"w-5 h-5 mr-3"}),"Люди"]}),e.jsxs(He,{to:"/reels",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx($s,{className:"w-5 h-5 mr-3"}),"Рілс"]}),e.jsxs(He,{to:"/messages",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(Ge,{className:"w-5 h-5 mr-3"}),"Повідомлення"]}),e.jsxs(He,{to:"/friends",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx($e,{className:"w-5 h-5 mr-3"}),"Друзі"]}),e.jsxs(He,{to:"/groups",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(Ot,{className:"w-5 h-5 mr-3"}),"Групи"]}),e.jsxs(He,{to:"/settings",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(Ps,{className:"w-5 h-5 mr-3"}),"Налаштування"]})]}),e.jsx("div",{className:"absolute bottom-0 w-full p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:r,className:"flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 w-full",children:[e.jsx(It,{className:"w-5 h-5 mr-3"}),"Вийти"]})})]})}function Jr(){var Hs;const[s,r]=d.useState([]),[t,a]=d.useState(0),[o,l]=d.useState(!0),[i,g]=d.useState(null),[p,P]=d.useState(!0),[h,E]=d.useState(!1),[v,M]=d.useState(!1),[y,_]=d.useState(!1),[D,W]=d.useState([]),[A,G]=d.useState(""),[B,q]=d.useState("all"),[re,K]=d.useState(""),[O,U]=d.useState(!1),[z,x]=d.useState(!1),[j,b]=d.useState("select"),[V,Z]=d.useState(null),[Y,ne]=d.useState(""),[he,ye]=d.useState(""),[ke,Le]=d.useState(""),[Se,Re]=d.useState([]),[u,w]=d.useState(""),[I,X]=d.useState("other"),[be,J]=d.useState(0),[ze,Oe]=d.useState(),[N,H]=d.useState(0),[le,ae]=d.useState(0),[ce,se]=d.useState(0),[me,_e]=d.useState(0),[n,c]=d.useState({brightness:100,contrast:100,saturation:100,blur:0,sepia:0,grayscale:0}),f=d.useRef([]),F=d.useRef(null),C=d.useRef(null),k=d.useRef(null),$=We();d.useEffect(()=>{ee()},[]),d.useEffect(()=>{i&&te()},[i,B]),d.useEffect(()=>{if(s.length>0&&f.current[t]){const m=f.current[t];m&&(p?m.play().catch(console.error):m.pause(),m.muted=h)}},[t,p,h,s]),d.useEffect(()=>{f.current.forEach((m,L)=>{m&&L!==t&&(m.pause(),m.currentTime=0)})},[t]),d.useEffect(()=>{const m=S=>{z&&(S.preventDefault(),S.deltaY>0&&t<s.length-1?a(xe=>xe+1):S.deltaY<0&&t>0&&a(xe=>xe-1))},L=F.current;if(L)return L.addEventListener("wheel",m,{passive:!1}),()=>L.removeEventListener("wheel",m)},[t,s.length,z]);const ee=async()=>{try{const{data:{user:m}}=await T.auth.getUser();m?g(m.id):$("/login")}catch(m){console.error("Error fetching user:",m),$("/login")}},te=async()=>{try{l(!0);const m=Ne();let L=m;B!=="all"&&(B==="trending"?L=m.filter(S=>S.views>1e4).sort((S,xe)=>xe.views-S.views):B==="following"?L=m.filter(S=>S.isFollowing):L=m.filter(S=>S.category===B)),re&&(L=L.filter(S=>S.title.toLowerCase().includes(re.toLowerCase())||S.description.toLowerCase().includes(re.toLowerCase())||S.hashtags.some(xe=>xe.toLowerCase().includes(re.toLowerCase()))||S.userName.toLowerCase().includes(re.toLowerCase()))),r(L),a(0)}catch(m){console.error("Error loading reels:",m)}finally{l(!1)}},Ne=()=>{const m=["trending","music","comedy","dance","food","travel","sports","education","pets","art"],L=[];for(let S=1;S<=50;S++)L.push({id:S.toString(),userId:`user_${S}`,userName:`User${S}`,userAvatar:`https://images.unsplash.com/photo-${15e11+S*1e3}?auto=format&fit=crop&w=100&q=80`,isVerified:Math.random()>.8,videoUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",thumbnailUrl:`https://images.unsplash.com/photo-${16e11+S*1e3}?auto=format&fit=crop&w=400&q=80`,title:`Amazing Reel ${S}`,description:`This is an amazing reel number ${S}! Check out this incredible content that will blow your mind! 🤯`,duration:Math.floor(Math.random()*60)+15,views:Math.floor(Math.random()*1e5)+1e3,likes:Math.floor(Math.random()*1e4)+100,comments:Math.floor(Math.random()*1e3)+10,shares:Math.floor(Math.random()*500)+5,bookmarks:Math.floor(Math.random()*2e3)+20,createdAt:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),music:Math.random()>.3?{id:`music_${S}`,title:`Track ${S}`,artist:`Artist ${S}`,url:"",duration:30}:void 0,hashtags:[`#reel${S}`,"#amazing","#viral","#trending"],location:Math.random()>.5?"Київ, Україна":void 0,isLiked:Math.random()>.7,isBookmarked:Math.random()>.8,isFollowing:Math.random()>.6,category:m[Math.floor(Math.random()*m.length)]});return L},Xe=async m=>{const L=[];for(let S=1;S<=20;S++)L.push({id:`comment_${S}`,userId:`user_${S}`,userName:`User${S}`,userAvatar:`https://images.unsplash.com/photo-${15e11+S*1e3}?auto=format&fit=crop&w=50&q=80`,content:`This is an amazing comment ${S}! I love this reel! 😍`,likes:Math.floor(Math.random()*100),replies:Math.floor(Math.random()*10),createdAt:new Date(Date.now()-Math.random()*24*60*60*1e3).toISOString(),isLiked:Math.random()>.7});W(L)},Me=async m=>{r(L=>L.map(S=>S.id===m?{...S,isLiked:!S.isLiked,likes:S.isLiked?S.likes-1:S.likes+1}:S))},Cs=async m=>{r(L=>L.map(S=>S.id===m?{...S,isBookmarked:!S.isBookmarked,bookmarks:S.isBookmarked?S.bookmarks-1:S.bookmarks+1}:S))},ss=async m=>{r(L=>L.map(S=>S.userId===m?{...S,isFollowing:!S.isFollowing}:S))},Qe=async()=>{if(!A.trim())return;const m={id:Date.now().toString(),userId:i,userName:"Ви",content:A,likes:0,replies:0,createdAt:new Date().toISOString(),isLiked:!1};W(S=>[m,...S]),G("");const L=s[t];r(S=>S.map(xe=>xe.id===L.id?{...xe,comments:xe.comments+1}:xe))},Es=m=>{var S;const L=(S=m.target.files)==null?void 0:S[0];if(L&&L.type.startsWith("video/")){Z(L);const xe=URL.createObjectURL(L);ne(xe),b("edit")}},fs=()=>{const m=k.current;m&&(H(m.duration),se(m.duration))},zs=()=>{b("select"),Z(null),ne(""),ye(""),Le(""),Re([]),w(""),X("other"),Oe(void 0),c({brightness:100,contrast:100,saturation:100,blur:0,sepia:0,grayscale:0}),ae(0),se(0)},gs=async()=>{if(!V)return;b("uploading"),J(0);for(let L=0;L<=100;L+=10)J(L),await new Promise(S=>setTimeout(S,200));const m={id:Date.now().toString(),userId:i,userName:"Ви",videoUrl:Y,title:he,description:ke,duration:ce-le,views:0,likes:0,comments:0,shares:0,bookmarks:0,createdAt:new Date().toISOString(),music:ze,hashtags:Se,location:u,isLiked:!1,isBookmarked:!1,isFollowing:!1,category:I};r(L=>[m,...L]),_(!1),zs(),a(0)},bs=m=>{const L=Math.floor(m/60),S=Math.floor(m%60);return`${L}:${S.toString().padStart(2,"0")}`},Ke=m=>m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toString(),Ws=m=>{const L=Date.now()-new Date(m).getTime(),S=Math.floor(L/(1e3*60*60)),xe=Math.floor(L/(1e3*60*60*24));return S<24?`${S} год тому`:`${xe} дн тому`},Ct=()=>{t<s.length-1&&a(m=>m+1)},Et=()=>{t>0&&a(m=>m-1)},Fs=()=>{x(!z)};if(o)return e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Завантаження рілс..."})]})})]});if(!z)return e.jsxs("div",{className:"flex min-h-screen bg-black",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-black border-b border-gray-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Рілс"}),e.jsx("div",{className:"flex space-x-2",children:[{id:"all",label:"Всі",icon:us},{id:"trending",label:"Тренди",icon:xt},{id:"following",label:"Підписки",icon:$e},{id:"music",label:"Музика",icon:Xs},{id:"comedy",label:"Комедія",icon:Tt},{id:"dance",label:"Танці",icon:qt}].map(m=>e.jsxs("button",{onClick:()=>q(m.id),className:`flex items-center space-x-1 px-3 py-2 rounded-full text-sm transition-colors ${B===m.id?"bg-blue-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[e.jsx(m.icon,{size:16}),e.jsx("span",{children:m.label})]},m.id))})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>U(!O),className:"p-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:e.jsx(xs,{size:20})}),O&&e.jsx("div",{className:"absolute right-0 top-12 w-80 bg-gray-900 rounded-lg shadow-xl border border-gray-700 p-4 z-50",children:e.jsx("input",{type:"text",placeholder:"Пошук рілс...",value:re,onChange:m=>K(m.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})})]}),e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ms,{size:20}),e.jsx("span",{children:"Створити"})]}),e.jsx("button",{onClick:Fs,className:"p-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:e.jsx(Gt,{size:20})})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map((m,L)=>{var S;return e.jsxs("div",{className:"relative aspect-[9/16] bg-gray-900 rounded-lg overflow-hidden cursor-pointer group hover:scale-105 transition-transform duration-200",onClick:()=>{a(L),Fs()},children:[e.jsx("img",{src:m.thumbnailUrl,alt:m.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden",children:m.userAvatar?e.jsx("img",{src:m.userAvatar,alt:m.userName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white text-xs font-bold",children:(S=m.userName[0])==null?void 0:S.toUpperCase()})}),e.jsx("span",{className:"text-white text-sm font-medium",children:m.userName}),m.isVerified&&e.jsx(Rs,{size:12,className:"text-blue-500"})]}),e.jsx("p",{className:"text-white text-sm line-clamp-2 mb-2",children:m.title}),e.jsxs("div",{className:"flex items-center justify-between text-white/80 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(es,{size:12,className:"mr-1"}),Ke(m.likes)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ht,{size:12,className:"mr-1"}),Ke(m.views)]})]}),e.jsx("span",{children:bs(m.duration)})]})]}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(as,{size:20,className:"text-white"})})]},m.id)})})})]})]});const Q=s[t];return Q?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex",ref:F,children:[e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:m=>{f.current[t]=m},src:Q.videoUrl,className:"max-h-full max-w-full object-contain",loop:!0,playsInline:!0,onClick:()=>P(!p)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:!p&&e.jsx("button",{onClick:()=>P(!0),className:"w-16 h-16 bg-black/50 rounded-full flex items-center justify-center text-white",children:e.jsx(as,{size:24})})}),e.jsx("button",{onClick:Et,disabled:t===0,className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-black/30 rounded-full flex items-center justify-center text-white disabled:opacity-30 hover:bg-black/50 transition-colors",children:e.jsx(Bt,{size:20})}),e.jsx("button",{onClick:Ct,disabled:t===s.length-1,className:"absolute right-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-black/30 rounded-full flex items-center justify-center text-white disabled:opacity-30 hover:bg-black/50 transition-colors",children:e.jsx(ft,{size:20})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between text-white",children:[e.jsx("button",{onClick:Fs,className:"p-2 bg-black/30 rounded-full hover:bg-black/50 transition-colors",children:e.jsx(Wt,{size:20})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>E(!h),className:"p-2 bg-black/30 rounded-full hover:bg-black/50 transition-colors",children:h?e.jsx(Ht,{size:20}):e.jsx(Jt,{size:20})})})]}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsx("div",{className:"w-full h-1 bg-white/30 rounded-full",children:e.jsx("div",{className:"h-full bg-white rounded-full transition-all duration-100",style:{width:`${me/Q.duration*100}%`}})})})]}),e.jsxs("div",{className:"w-80 bg-black/50 backdrop-blur-sm p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden",children:Q.userAvatar?e.jsx("img",{src:Q.userAvatar,alt:Q.userName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white text-lg font-bold",children:(Hs=Q.userName[0])==null?void 0:Hs.toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-white font-semibold",children:Q.userName}),Q.isVerified&&e.jsx(Rs,{size:16,className:"text-blue-500"})]}),e.jsx("p",{className:"text-white/60 text-sm",children:Ws(Q.createdAt)})]}),Q.userId!==i&&e.jsx("button",{onClick:()=>ss(Q.userId),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${Q.isFollowing?"bg-gray-600 text-white hover:bg-gray-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:Q.isFollowing?"Відписатися":"Підписатися"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-white text-lg font-semibold mb-2",children:Q.title}),e.jsx("p",{className:"text-white/80 text-sm mb-3",children:Q.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Q.hashtags.map((m,L)=>e.jsx("span",{className:"text-blue-400 text-sm hover:text-blue-300 cursor-pointer",children:m},L))}),Q.music&&e.jsxs("div",{className:"flex items-center space-x-2 text-white/60 text-sm mb-3",children:[e.jsx(Xs,{size:14}),e.jsxs("span",{children:[Q.music.artist," - ",Q.music.title]})]}),Q.location&&e.jsxs("div",{className:"flex items-center space-x-2 text-white/60 text-sm",children:[e.jsx(us,{size:14}),e.jsx("span",{children:Q.location})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-lg font-semibold",children:Ke(Q.views)}),e.jsx("div",{className:"text-white/60 text-sm",children:"Переглядів"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-lg font-semibold",children:Ke(Q.likes)}),e.jsx("div",{className:"text-white/60 text-sm",children:"Вподобань"})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("button",{onClick:()=>Me(Q.id),className:`w-full flex items-center justify-center space-x-2 py-3 rounded-lg transition-colors ${Q.isLiked?"bg-red-600 text-white hover:bg-red-700":"bg-gray-800 text-white hover:bg-gray-700"}`,children:[e.jsx(es,{size:20,className:Q.isLiked?"fill-current":""}),e.jsx("span",{children:Q.isLiked?"Не подобається":"Подобається"})]}),e.jsxs("button",{onClick:()=>{M(!0),Xe(Q.id)},className:"w-full flex items-center justify-center space-x-2 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx(Ge,{size:20}),e.jsxs("span",{children:["Коментарі (",Ke(Q.comments),")"]})]}),e.jsxs("button",{onClick:()=>Cs(Q.id),className:`w-full flex items-center justify-center space-x-2 py-3 rounded-lg transition-colors ${Q.isBookmarked?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-gray-800 text-white hover:bg-gray-700"}`,children:[Q.isBookmarked?e.jsx(Zt,{size:20}):e.jsx(Xt,{size:20}),e.jsx("span",{children:Q.isBookmarked?"В збережених":"Зберегти"})]}),e.jsxs("button",{className:"w-full flex items-center justify-center space-x-2 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx(Qt,{size:20}),e.jsx("span",{children:"Поділитися"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold mb-3",children:"Схожі рілс"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.slice(t+1,t+5).map((m,L)=>e.jsx("div",{className:"aspect-[9/16] bg-gray-800 rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform",onClick:()=>a(t+1+L),children:e.jsx("img",{src:m.thumbnailUrl,alt:m.title,className:"w-full h-full object-cover"})},m.id))})]})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-60",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("h3",{className:"text-white text-lg font-semibold",children:["Коментарі (",Ke(Q.comments),")"]}),e.jsx("button",{onClick:()=>M(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ve,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:D.map(m=>{var L;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0",children:m.userAvatar?e.jsx("img",{src:m.userAvatar,alt:m.userName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:(L=m.userName[0])==null?void 0:L.toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-white font-medium text-sm",children:m.userName}),e.jsx("span",{className:"text-gray-400 text-xs",children:Ws(m.createdAt)})]}),e.jsx("p",{className:"text-white/80 text-sm mb-2",children:m.content}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-400 text-xs",children:[e.jsxs("button",{className:"hover:text-white flex items-center space-x-1",children:[e.jsx(es,{size:12,className:m.isLiked?"fill-current text-red-500":""}),e.jsx("span",{children:m.likes})]}),e.jsx("button",{className:"hover:text-white",children:"Відповісти"})]})]})]},m.id)})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("input",{type:"text",placeholder:"Додати коментар...",value:A,onChange:m=>G(m.target.value),className:"flex-1 bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:m=>m.key==="Enter"&&Qe()}),e.jsx("button",{onClick:Qe,disabled:!A.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Надіслати"})]})})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-60",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[j==="select"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-white text-2xl font-bold",children:"Створити рел"}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ve,{size:24})})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-12 text-center cursor-pointer hover:border-gray-500 transition-colors",onClick:()=>{var m;return(m=C.current)==null?void 0:m.click()},children:[e.jsx(Os,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Завантажити відео"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Перетягніть відео сюди або натисніть для вибору"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Підтримувані формати: MP4, MOV, AVI. Максимум 100MB"})]}),e.jsx("input",{ref:C,type:"file",accept:"video/*",onChange:Es,className:"hidden"})]}),j==="edit"&&e.jsxs("div",{className:"flex h-[80vh]",children:[e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-6",children:e.jsx("video",{ref:k,src:Y,className:"max-h-full max-w-full object-contain",controls:!0,onLoadedMetadata:fs,onTimeUpdate:m=>_e(m.currentTarget.currentTime),style:{filter:`brightness(${n.brightness}%) contrast(${n.contrast}%) saturate(${n.saturation}%) blur(${n.blur}px) sepia(${n.sepia}%) grayscale(${n.grayscale}%)`}})}),e.jsxs("div",{className:"w-80 bg-gray-800 p-6 overflow-y-auto",children:[e.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Редагування відео"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Обрізати відео"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 text-sm mb-1",children:["Початок: ",bs(le)]}),e.jsx("input",{type:"range",min:0,max:N,step:.1,value:le,onChange:m=>ae(Number(m.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 text-sm mb-1",children:["Кінець: ",bs(ce)]}),e.jsx("input",{type:"range",min:0,max:N,step:.1,value:ce,onChange:m=>se(Number(m.target.value)),className:"w-full"})]}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Тривалість: ",bs(ce-le)]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Фільтри"}),e.jsx("div",{className:"space-y-3",children:Object.entries(n).map(([m,L])=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 text-sm mb-1 capitalize",children:[m,": ",L,m==="blur"?"px":"%"]}),e.jsx("input",{type:"range",min:m==="blur"?0:m==="brightness"||m==="contrast"||m==="saturation"?50:0,max:m==="blur"?10:m==="brightness"||m==="contrast"||m==="saturation"?150:100,value:L,onChange:S=>c(xe=>({...xe,[m]:Number(S.target.value)})),className:"w-full"})]},m))})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>b("select"),className:"flex-1 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Назад"}),e.jsx("button",{onClick:()=>b("details"),className:"flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Далі"})]})]})]}),j==="details"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-white text-2xl font-bold",children:"Деталі рілу"}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ve,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Назва *"}),e.jsx("input",{type:"text",value:he,onChange:m=>ye(m.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введіть назву рілу",maxLength:100}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[he.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Опис"}),e.jsx("textarea",{value:ke,onChange:m=>Le(m.target.value),rows:4,className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Розкажіть про ваш рел",maxLength:500}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[ke.length,"/500"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Категорія"}),e.jsxs("select",{value:I,onChange:m=>X(m.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"other",children:"Інше"}),e.jsx("option",{value:"music",children:"Музика"}),e.jsx("option",{value:"comedy",children:"Комедія"}),e.jsx("option",{value:"dance",children:"Танці"}),e.jsx("option",{value:"food",children:"Їжа"}),e.jsx("option",{value:"travel",children:"Подорожі"}),e.jsx("option",{value:"sports",children:"Спорт"}),e.jsx("option",{value:"education",children:"Освіта"}),e.jsx("option",{value:"pets",children:"Тварини"}),e.jsx("option",{value:"art",children:"Мистецтво"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Локація"}),e.jsx("input",{type:"text",value:u,onChange:m=>w(m.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Де було знято відео"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Хештеги"}),e.jsx("input",{type:"text",placeholder:"Додайте хештеги через кому",className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:m=>{if(m.key==="Enter"||m.key===","){m.preventDefault();const L=m.currentTarget.value.trim();L&&!Se.includes(`#${L}`)&&(Re(S=>[...S,`#${L}`]),m.currentTarget.value="")}}}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Se.map((m,L)=>e.jsxs("span",{className:"bg-blue-600 text-white px-2 py-1 rounded-full text-sm flex items-center space-x-1",children:[e.jsx("span",{children:m}),e.jsx("button",{onClick:()=>Re(S=>S.filter((xe,zt)=>zt!==L)),className:"hover:text-red-300",children:e.jsx(ve,{size:12})})]},L))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-white font-medium mb-2",children:"Попередній перегляд"}),e.jsx("div",{className:"aspect-[9/16] bg-black rounded-lg overflow-hidden",children:e.jsx("video",{src:Y,className:"w-full h-full object-cover",muted:!0,loop:!0,autoPlay:!0})})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx("button",{onClick:()=>b("edit"),className:"px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Назад"}),e.jsx("button",{onClick:gs,disabled:!he.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Опублікувати"})]})]}),j==="uploading"&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-white text-2xl font-bold mb-2",children:"Завантаження рілу"}),e.jsx("p",{className:"text-gray-400",children:"Будь ласка, зачекайте..."})]}),e.jsxs("div",{className:"w-64 mx-auto",children:[e.jsx("div",{className:"bg-gray-700 rounded-full h-4 mb-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-300",style:{width:`${be}%`}})}),e.jsxs("p",{className:"text-white text-lg font-semibold",children:[be,"%"]})]})]})]})})]}):null}function Zr(){return new URLSearchParams(Dt().search)}function Xr(){var re,K,O;const[s,r]=d.useState([]),[t,a]=d.useState(null),[o,l]=d.useState([]),[i,g]=d.useState(null),[p,P]=d.useState(""),[h,E]=d.useState(!0),[v,M]=d.useState(!1),y=d.useRef(null),_=Zr();d.useEffect(()=>{y.current&&y.current.scrollIntoView({behavior:"smooth"})},[o]),d.useEffect(()=>{D()},[]),d.useEffect(()=>{i&&W()},[i]),d.useEffect(()=>{const U=_.get("user");U&&i&&A(U)},[i]);async function D(){const U=await ge.getCurrentUserProfile();g(U)}async function W(){E(!0);const{data:U,error:z}=await T.from("conversations").select(`
        *,
        participant1:users!conversations_participant1_id_fkey (id, name, lastname, avatar),
        participant2:users!conversations_participant2_id_fkey (id, name, lastname, avatar)
      `).or(`participant1_id.eq.${i.id},participant2_id.eq.${i.id}`).order("updated_at",{ascending:!1});if(z){r([]),E(!1);return}const x=(U||[]).map(j=>{const b=j.participant1_id===i.id?j.participant2:j.participant1;return{id:j.id,participant:b,updated_at:j.updated_at}});r(x),E(!1)}async function A(U){let z=s.find(x=>x.participant&&x.participant.id===U);if(!z){const{data:x,error:j}=await T.from("conversations").insert([{participant1_id:i.id,participant2_id:U}]).select(`
          *,
          participant1:users!conversations_participant1_id_fkey (id, name, lastname, avatar),
          participant2:users!conversations_participant2_id_fkey (id, name, lastname, avatar)
        `).single();if(j)return;const b=x.participant1_id===i.id?x.participant2:x.participant1;z={id:x.id,participant:b,updated_at:x.updated_at},r(V=>[z,...V])}a(z),G(z.id)}async function G(U){const{data:z,error:x}=await T.from("messages").select("*").eq("conversation_id",U).order("created_at",{ascending:!0});if(x){l([]);return}l(z||[])}async function B(U){a(U),G(U.id)}async function q(U){if(U.preventDefault(),!p.trim()||!t)return;M(!0);const{error:z}=await T.from("messages").insert([{conversation_id:t.id,sender_id:i.id,content:p.trim()}]);M(!1),P(""),z||G(t.id)}return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 ml-64 flex",children:[e.jsxs("div",{className:"w-80 border-r border-gray-200 bg-white flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Діалоги"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsx("div",{className:"p-4 text-gray-500",children:"Завантаження..."}):s.length===0?e.jsx("div",{className:"p-4 text-gray-500",children:"Немає діалогів"}):s.map(U=>{var z,x,j;return e.jsxs("div",{className:`flex items-center px-4 py-3 cursor-pointer hover:bg-gray-50 ${t&&t.id===U.id?"bg-gray-100":""}`,onClick:()=>B(U),children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:(z=U.participant)!=null&&z.avatar?e.jsx("img",{src:U.participant.avatar,alt:U.participant.name,className:"w-full h-full object-cover"}):e.jsx(js,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[(x=U.participant)==null?void 0:x.name," ",(j=U.participant)==null?void 0:j.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Останнє оновлення: ",new Date(U.updated_at).toLocaleString("uk-UA")]})]})]},U.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center border-b border-gray-200 px-6 py-4 bg-white",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:(re=t.participant)!=null&&re.avatar?e.jsx("img",{src:t.participant.avatar,alt:t.participant.name,className:"w-full h-full object-cover"}):e.jsx(js,{className:"w-7 h-7 text-gray-400"})}),e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:"font-semibold text-gray-900",children:[(K=t.participant)==null?void 0:K.name," ",(O=t.participant)==null?void 0:O.lastName]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 bg-gray-50",children:o.length===0?e.jsx("div",{className:"text-gray-500 text-center mt-8",children:"Немає повідомлень"}):e.jsxs("div",{className:"space-y-4",children:[o.map(U=>e.jsx("div",{className:`flex ${U.sender_id===i.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs px-4 py-2 rounded-lg shadow-sm ${U.sender_id===i.id?"bg-blue-600 text-white":"bg-white text-gray-900 border"}`,children:[U.content,e.jsx("div",{className:"text-xs text-gray-300 mt-1 text-right",children:new Date(U.created_at).toLocaleTimeString("uk-UA",{hour:"2-digit",minute:"2-digit"})})]})},U.id)),e.jsx("div",{ref:y})]})}),e.jsxs("form",{onSubmit:q,className:"flex items-center px-6 py-4 border-t border-gray-200 bg-white",children:[e.jsx("input",{type:"text",value:p,onChange:U=>P(U.target.value),placeholder:"Введіть повідомлення...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:v}),e.jsx("button",{type:"submit",disabled:v||!p.trim(),className:"ml-4 px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50",children:e.jsx(gt,{className:"w-5 h-5"})})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 text-xl",children:"Виберіть діалог для перегляду повідомлень"})})]})]})}const Qr=()=>{const[s,r]=d.useState([]),[t,a]=d.useState([]),[o,l]=d.useState(!0),[i,g]=d.useState(""),[p,P]=d.useState("friends");d.useEffect(()=>{h()},[]);const h=async()=>{try{l(!0);const[y,_]=await Promise.all([ge.getFriends(),ge.getFriendRequests()]);r(y),a(_)}catch(y){console.error("Error loading friends data:",y),r([{id:"1",email:"anna@example.com",name:"Анна",lastname:"Іваненко",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b31c?auto=format&fit=crop&w=200&q=80",bio:"UI/UX дизайнер з пристрастю до створення красивих інтерфейсів",location:"Львів, Україна",work:"UI/UX Designer",isOnline:!0},{id:"2",email:"max@example.com",name:"Максим",lastname:"Петренко",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=200&q=80",bio:"Full-stack розробник з досвідом роботи в стартапах",location:"Одеса, Україна",work:"Full-stack Developer",isOnline:!1},{id:"3",email:"ivan@example.com",name:"Іван",lastname:"Коваленко",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=200&q=80",bio:"Ентузіаст технологій та любитель кави",location:"Харків, Україна",work:"Product Manager",isOnline:!0}]),a([])}finally{l(!1)}},E=async y=>{try{await ge.sendFriendRequest(y)&&alert("Запит на дружбу надіслано!")}catch(_){console.error("Error sending friend request:",_),alert("Помилка надсилання запиту на дружбу")}},v=()=>i?s.filter(y=>{var _,D;return`${y.name} ${y.lastname}`.toLowerCase().includes(i.toLowerCase())||((_=y.bio)==null?void 0:_.toLowerCase().includes(i.toLowerCase()))||((D=y.location)==null?void 0:D.toLowerCase().includes(i.toLowerCase()))}):s,M=y=>new Date(y).toLocaleDateString("uk-UA",{month:"long",day:"numeric"});return o?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Друзі"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Знайдіть нових друзів та керуйте існуючими зв'язками"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-8",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex",children:[e.jsx("button",{onClick:()=>P("friends"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${p==="friends"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($e,{size:20}),e.jsxs("span",{children:["Мої друзі (",s.length,")"]})]})}),e.jsx("button",{onClick:()=>P("requests"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${p==="requests"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{size:20}),e.jsxs("span",{children:["Запити (",t.length,")"]})]})}),e.jsx("button",{onClick:()=>P("suggestions"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${p==="suggestions"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Je,{size:20}),e.jsx("span",{children:"Рекомендації"})]})})]})}),p==="friends"&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук друзів...",value:i,onChange:y=>g(y.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})})]}),p==="friends"&&e.jsx("div",{children:v().length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx($e,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i?"Друзів не знайдено":"У вас поки немає друзів"}),e.jsx("p",{className:"text-gray-600 mb-6",children:i?"Спробуйте змінити критерії пошуку":"Почніть додавати друзів, щоб розширити свою мережу"}),!i&&e.jsxs("button",{onClick:()=>P("suggestions"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Je,{size:20,className:"mr-2"}),"Знайти друзів"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v().map(y=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(y.name)}&size=64&background=3b82f6&color=fff`,alt:y.name,className:"w-16 h-16 rounded-full object-cover"}),y.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 truncate",children:[y.name," ",y.lastname]}),y.work&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:y.work}),y.location&&e.jsx("p",{className:"text-xs text-gray-500 truncate",children:y.location})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx(vs,{size:20})})]}),y.bio&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:y.bio}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Ge,{size:16,className:"mr-1"}),"Написати"]}),e.jsx("button",{className:"flex-1 flex items-center justify-center px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Профіль"})]})]},y.id))})}),p==="requests"&&e.jsx("div",{children:t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(ls,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Немає запитів на дружбу"}),e.jsx("p",{className:"text-gray-600",children:"Коли хтось надішле вам запит на дружбу, він з'явиться тут"})]}):e.jsx("div",{className:"space-y-4",children:t.map(y=>{var _,D,W,A,G,B;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:((_=y.sender)==null?void 0:_.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((D=y.sender)==null?void 0:D.name)||"")}&size=64&background=3b82f6&color=fff`,alt:(W=y.sender)==null?void 0:W.name,className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[(A=y.sender)==null?void 0:A.name," ",(G=y.sender)==null?void 0:G.lastname]}),((B=y.sender)==null?void 0:B.work)&&e.jsx("p",{className:"text-sm text-gray-600",children:y.sender.work}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Надіслав запит ",M(y.created_at)]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Rs,{size:16,className:"mr-1"}),"Прийняти"]}),e.jsxs("button",{className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:[e.jsx(ve,{size:16,className:"mr-1"}),"Відхилити"]})]})]})},y.id)})})}),p==="suggestions"&&e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(Je,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Рекомендації друзів"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Ця функція буде доступна незабаром. Ми працюємо над алгоритмом, який допоможе вам знайти цікавих людей за спільними інтересами."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8",children:[{id:"suggestion-1",name:"Олександра",lastname:"Мельник",work:"Frontend Developer",location:"Київ, Україна",mutualFriends:3,avatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=200&q=80"},{id:"suggestion-2",name:"Дмитро",lastname:"Волков",work:"Backend Developer",location:"Львів, Україна",mutualFriends:1,avatar:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=200&q=80"},{id:"suggestion-3",name:"Катерина",lastname:"Сидорова",work:"Product Designer",location:"Одеса, Україна",mutualFriends:5,avatar:"https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?auto=format&fit=crop&w=200&q=80"}].map(y=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:y.avatar,alt:y.name,className:"w-20 h-20 rounded-full object-cover mx-auto mb-4"}),e.jsxs("h3",{className:"font-semibold text-gray-900 mb-1",children:[y.name," ",y.lastname]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:y.work}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:y.location}),e.jsxs("p",{className:"text-xs text-blue-600 mb-4",children:[y.mutualFriends," спільних друзів"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>E(y.id),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Je,{size:16,className:"mr-1"}),"Додати"]}),e.jsx("button",{className:"flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Профіль"})]})]})},y.id))})]})})]})})};function Kr(){const[s,r]=d.useState("profile"),[t,a]=d.useState(!0),o=We(),[l,i]=d.useState({name:"",lastName:"",email:"",bio:"",city:"",birthDate:"",notifications:{email:!0,messages:!0,friendRequests:!0},privacy:{profileVisibility:"public",showBirthDate:!0,showEmail:!1},familyStatus:"",status:"",phone:"",website:""});d.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:{user:h},error:E}=await T.auth.getUser();if(E||!h){o("/login");return}const{data:v,error:M}=await T.from("users").select("*").eq("auth_user_id",h.id).single();if(M){console.error("Error fetching user settings:",M);return}i({...l,...v,notifications:v.notifications||l.notifications,privacy:v.privacy||l.privacy})}catch(h){console.error("Error loading user settings:",h)}finally{a(!1)}},p=async h=>{h.preventDefault();try{const{data:{user:E},error:v}=await T.auth.getUser();if(v||!E){o("/login");return}const{error:M}=await T.from("users").update({name:l.name,lastName:l.lastName,bio:l.bio,city:l.city,birthDate:l.birthDate,notifications:l.notifications,privacy:l.privacy,familyStatus:l.familyStatus,status:l.status,phone:l.phone,website:l.website}).eq("auth_user_id",E.id);if(M)throw M;alert("Налаштування збережено успішно")}catch(E){console.error("Error saving settings:",E),alert("Помилка при збереженні налаштувань")}},P=[{id:"profile",label:"Профіль",icon:As},{id:"privacy",label:"Приватність",icon:Be},{id:"notifications",label:"Сповіщення",icon:Kt}];return t?e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"text-center",children:"Завантаження..."})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Налаштування"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"flex border-b border-gray-200",children:P.map(({id:h,label:E,icon:v})=>e.jsxs("button",{onClick:()=>r(h),className:`flex items-center px-6 py-3 text-sm font-medium ${s===h?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(v,{size:18,className:"mr-2"}),E]},h))}),e.jsxs("div",{className:"p-6",children:[s==="profile"&&e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Ім'я"}),e.jsx("input",{type:"text",value:l.name,onChange:h=>i({...l,name:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Прізвище"}),e.jsx("input",{type:"text",value:l.lastName,onChange:h=>i({...l,lastName:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Місто"}),e.jsx("input",{type:"text",value:l.city||"",onChange:h=>i({...l,city:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Сімейний стан"}),e.jsx("input",{type:"text",value:l.familyStatus||"",onChange:h=>i({...l,familyStatus:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Статус"}),e.jsx("input",{type:"text",value:l.status||"",onChange:h=>i({...l,status:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Телефон"}),e.jsx("input",{type:"text",value:l.phone||"",onChange:h=>i({...l,phone:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Веб-сайт"}),e.jsx("input",{type:"text",value:l.website||"",onChange:h=>i({...l,website:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Дата народження"}),e.jsx("input",{type:"date",value:l.birthDate||"",onChange:h=>i({...l,birthDate:h.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Про мене"}),e.jsx("textarea",{value:l.bio,onChange:h=>i({...l,bio:h.target.value}),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Зберегти зміни"})})]}),s==="privacy"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Налаштування приватності"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Видимість профілю"}),e.jsxs("select",{value:l.privacy.profileVisibility,onChange:h=>i({...l,privacy:{...l.privacy,profileVisibility:h.target.value}}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"public",children:"Публічний"}),e.jsx("option",{value:"friends",children:"Тільки друзі"}),e.jsx("option",{value:"private",children:"Приватний"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Показувати дату народження"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.privacy.showBirthDate,onChange:h=>i({...l,privacy:{...l.privacy,showBirthDate:h.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Показувати email"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.privacy.showEmail,onChange:h=>i({...l,privacy:{...l.privacy,showEmail:h.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})}),s==="notifications"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Налаштування сповіщень"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Email сповіщення"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.notifications.email,onChange:h=>i({...l,notifications:{...l.notifications,email:h.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Сповіщення про повідомлення"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.notifications.messages,onChange:h=>i({...l,notifications:{...l.notifications,messages:h.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Сповіщення про запити в друзі"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.notifications.friendRequests,onChange:h=>i({...l,notifications:{...l.notifications,friendRequests:h.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})})]})]})]})})]})}const Yr=()=>{const[s,r]=d.useState([]),[t,a]=d.useState(!0),[o,l]=d.useState(""),[i,g]=d.useState("all"),[p,P]=d.useState(!1),[h,E]=d.useState(!1),[v,M]=d.useState({name:"",description:"",category:"Технології",is_private:!1,tags:[],location:"",website:"",rules:["Поважайте інших учасників","Заборонений спам та реклама"],contactEmail:""}),[y,_]=d.useState(""),D=["all","Технології","Дизайн","Спорт","Музика","Кулінарія","Подорожі","Фотографія","Освіта","Бізнес","Інше"];d.useEffect(()=>{W()},[]);const W=async()=>{try{a(!0);const x=await ge.getGroups();r(x)}catch(x){console.error("Error loading groups:",x)}finally{a(!1)}},A=async x=>{if(x.preventDefault(),!v.name.trim()){alert("Назва групи обов'язкова");return}try{E(!0);const j=await ge.createGroup(v);j&&(r(b=>[j,...b]),P(!1),G())}catch(j){console.error("Error creating group:",j),alert("Помилка створення групи")}finally{E(!1)}},G=()=>{M({name:"",description:"",category:"Технології",is_private:!1,tags:[],location:"",website:"",rules:["Поважайте інших учасників","Заборонений спам та реклама"],contactEmail:""}),_("")},B=()=>{y.trim()&&!v.tags.includes(y.trim())&&(M(x=>({...x,tags:[...x.tags,y.trim()]})),_(""))},q=x=>{M(j=>({...j,tags:j.tags.filter(b=>b!==x)}))},re=()=>{M(x=>({...x,rules:[...x.rules,""]}))},K=(x,j)=>{M(b=>({...b,rules:b.rules.map((V,Z)=>Z===x?j:V)}))},O=x=>{M(j=>({...j,rules:j.rules.filter((b,V)=>V!==x)}))},U=()=>{let x=s;return o&&(x=x.filter(j=>{var b,V;return j.name.toLowerCase().includes(o.toLowerCase())||((b=j.description)==null?void 0:b.toLowerCase().includes(o.toLowerCase()))||((V=j.tags)==null?void 0:V.some(Z=>Z.toLowerCase().includes(o.toLowerCase())))})),i!=="all"&&(x=x.filter(j=>j.category===i)),x},z=x=>new Date(x).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric"});return t?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Групи"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Знайдіть спільноти за інтересами або створіть власну"})]}),e.jsxs("button",{onClick:()=>P(!0),className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ms,{size:20,className:"mr-2"}),"Створити групу"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук груп...",value:o,onChange:x=>l(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"lg:w-64",children:e.jsx("select",{value:i,onChange:x=>g(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:D.map(x=>e.jsx("option",{value:x,children:x==="all"?"Всі категорії":x},x))})})]})}),e.jsxs("div",{className:"mb-4 text-gray-600",children:["Знайдено ",U().length," груп"]}),U().length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx($e,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Груп не знайдено"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Спробуйте змінити критерії пошуку або створіть нову групу"}),e.jsxs("button",{onClick:()=>P(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ms,{size:20,className:"mr-2"}),"Створити групу"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:U().map(x=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600",children:[x.cover&&e.jsx("img",{src:x.cover,alt:x.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20"}),e.jsx("div",{className:"absolute top-3 right-3",children:x.is_private?e.jsx(Be,{size:16,className:"text-white"}):e.jsx(us,{size:16,className:"text-white"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:x.avatar?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full object-cover rounded-lg"}):x.name.substring(0,2).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:x.name}),x.category&&e.jsx("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full mt-1",children:x.category})]})]}),x.description&&e.jsx("p",{className:"text-gray-600 text-sm mt-3 line-clamp-2",children:x.description}),x.tags&&x.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-3",children:[x.tags.slice(0,3).map((j,b)=>e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["#",j]},b)),x.tags.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["+",x.tags.length-3]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx($e,{size:16,className:"mr-1"}),x.member_count]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ys,{size:16,className:"mr-1"}),x.post_count]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(os,{to:`/groups/${x.id}`,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Переглянути"})})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ds,{size:12,className:"mr-1"}),"Створено ",z(x.created_at)]}),x.location&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(cs,{size:12,className:"mr-1"}),x.location]})]})]})]},x.id))})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Створити нову групу"}),e.jsx("button",{onClick:()=>{P(!1),G()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ve,{size:24})})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Назва групи *"}),e.jsx("input",{type:"text",value:v.name,onChange:x=>M(j=>({...j,name:x.target.value})),placeholder:"Введіть назву групи",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Опис"}),e.jsx("textarea",{value:v.description,onChange:x=>M(j=>({...j,description:x.target.value})),rows:3,placeholder:"Розкажіть про групу...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категорія"}),e.jsx("select",{value:v.category,onChange:x=>M(j=>({...j,category:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:D.filter(x=>x!=="all").map(x=>e.jsx("option",{value:x,children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Місцезнаходження"}),e.jsx("input",{type:"text",value:v.location,onChange:x=>M(j=>({...j,location:x.target.value})),placeholder:"Місто, країна",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:v.is_private,onChange:x=>M(j=>({...j,is_private:x.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Приватна група"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Тільки учасники можуть бачити пости та список членів"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Теги"}),e.jsxs("div",{className:"flex space-x-2 mb-2",children:[e.jsx("input",{type:"text",value:y,onChange:x=>_(x.target.value),onKeyPress:x=>x.key==="Enter"&&(x.preventDefault(),B()),placeholder:"Додати тег",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"button",onClick:B,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Додати"})]}),v.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:v.tags.map((x,j)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded",children:["#",x,e.jsx("button",{type:"button",onClick:()=>q(x),className:"ml-1 text-blue-600 hover:text-blue-800",children:e.jsx(ve,{size:14})})]},j))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Веб-сайт"}),e.jsx("input",{type:"url",value:v.website,onChange:x=>M(j=>({...j,website:x.target.value})),placeholder:"https://example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Контактний email"}),e.jsx("input",{type:"email",value:v.contactEmail,onChange:x=>M(j=>({...j,contactEmail:x.target.value})),placeholder:"contact@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Правила групи"}),e.jsxs("div",{className:"space-y-2",children:[v.rules.map((x,j)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:x,onChange:b=>K(j,b.target.value),placeholder:`Правило ${j+1}`,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),v.rules.length>1&&e.jsx("button",{type:"button",onClick:()=>O(j),className:"p-2 text-red-600 hover:text-red-800",children:e.jsx(ve,{size:20})})]},j)),e.jsx("button",{type:"button",onClick:re,className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Додати правило"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{P(!1),G()},className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Скасувати"}),e.jsx("button",{type:"submit",disabled:h||!v.name.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:h?"Створення...":"Створити групу"})]})]})]})})]})};function ea(){var be,J,ze,Oe;const{groupId:s}=Ut(),r=We(),[t,a]=d.useState(null),[o,l]=d.useState([]),[i,g]=d.useState([]),[p,P]=d.useState(null),[h,E]=d.useState(null),[v,M]=d.useState(!0),[y,_]=d.useState("posts"),[D,W]=d.useState(""),[A,G]=d.useState([]),[B,q]=d.useState(!1),[re,K]=d.useState(!1),[O,U]=d.useState(""),[z,x]=d.useState(null),[j,b]=d.useState(!1);d.useEffect(()=>{V()},[]),d.useEffect(()=>{p&&s&&(Z(),Y(),ne(),he())},[p,s]);const V=async()=>{try{const{data:{user:N},error:H}=await T.auth.getUser();if(H||!N){r("/login");return}const{data:le,error:ae}=await T.from("users").select("*").eq("auth_user_id",N.id).single();if(ae){console.error("Error fetching user profile:",ae);return}P(le)}catch(N){console.error("Error fetching current user:",N)}},Z=async()=>{try{const{data:N,error:H}=await T.from("groups").select(`
          *,
          created_by_profile:users!groups_created_by_fkey(name, lastname, avatar)
        `).eq("id",s).single();if(H)throw H;a(N)}catch(N){console.error("Error fetching group details:",N),r("/groups")}finally{M(!1)}},Y=async()=>{try{const{data:N,error:H}=await T.from("group_posts").select(`
          *,
          author:users!group_posts_author_id_fkey(name, lastname, avatar),
          media:group_post_media(*)
        `).eq("group_id",s).order("created_at",{ascending:!1});if(H)throw H;l(N||[])}catch(N){console.error("Error fetching group posts:",N)}},ne=async()=>{try{const{data:N,error:H}=await T.from("group_members").select(`
          *,
          user:users!group_members_user_id_fkey(name, lastname, avatar)
        `).eq("group_id",s).order("joined_at",{ascending:!1});if(H)throw H;g(N||[])}catch(N){console.error("Error fetching group members:",N)}},he=async()=>{try{if(!p)return;const{data:N,error:H}=await T.from("group_members").select("*").eq("group_id",s).eq("user_id",p.id).single();if(H&&H.code!=="PGRST116")throw H;E(N)}catch(N){console.error("Error checking user membership:",N)}},ye=async()=>{try{if(!p)return;const{error:N}=await T.from("group_members").insert([{group_id:s,user_id:p.id,role:"member"}]);if(N)throw N;he(),ne(),alert("Ви успішно приєдналися до групи!")}catch(N){console.error("Error joining group:",N),alert("Помилка при приєднанні до групи")}},ke=async()=>{try{if(!p||!h)return;if(h.role==="admin"){alert("Адміністратор не може покинути групу");return}const{error:N}=await T.from("group_members").delete().eq("group_id",s).eq("user_id",p.id);if(N)throw N;E(null),ne(),alert("Ви покинули групу")}catch(N){console.error("Error leaving group:",N),alert("Помилка при виході з групи")}},Le=N=>{const H=Array.from(N.target.files);G(H)},Se=N=>{G(H=>H.filter((le,ae)=>ae!==N))},Re=async N=>{if(N.preventDefault(),!(!p||!h||!D.trim()&&A.length===0))try{q(!0);const{data:H,error:le}=await T.from("group_posts").insert([{group_id:s,author_id:p.id,content:D.trim()}]).select().single();if(le)throw le;if(A.length>0)for(const ae of A){const ce=ae.name.split(".").pop(),se=`${Date.now()}-${Math.random().toString(36).substring(7)}.${ce}`,me=`group-posts/${s}/${se}`,_e=ae.type.startsWith("video/")?"video":"image",{error:n}=await T.storage.from("media").upload(me,ae);if(n)throw n;const{data:{publicUrl:c}}=T.storage.from("media").getPublicUrl(me);await T.from("group_post_media").insert([{post_id:H.id,type:_e,url:c,filename:ae.name,file_size:ae.size}])}W(""),G([]),Y()}catch(H){console.error("Error creating post:",H),alert("Помилка при створенні поста")}finally{q(!1)}},u=N=>new Date(N).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=N=>{switch(N){case"admin":return"Адміністратор";case"moderator":return"Модератор";default:return"Учасник"}};if(v)return e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"text-center",children:"Завантаження..."})})]});if(!t)return e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"text-center",children:"Група не знайдена"})})]});const I=!!h,X=(h==null?void 0:h.role)==="admin";return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>r("/groups"),className:"mr-4 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Yt,{size:20})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mr-4",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full rounded-full object-cover"}):e.jsx($e,{size:24,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mr-2",children:t.name}),t.is_private?e.jsx(Be,{size:16,className:"text-gray-500"}):e.jsx(us,{size:16,className:"text-gray-500"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 space-x-4",children:[e.jsxs("span",{children:[t.member_count||i.length," учасників"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Створено ",u(t.created_at)]})]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:I?e.jsxs(e.Fragment,{children:[!X&&e.jsxs("button",{onClick:ke,className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(er,{size:18,className:"mr-2"}),"Покинути"]}),X&&e.jsxs("button",{className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(Ps,{size:18,className:"mr-2"}),"Керувати"]})]}):e.jsxs("button",{onClick:ye,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Je,{size:18,className:"mr-2"}),"Приєднатися"]})})]}),t.description&&e.jsx("p",{className:"mt-4 text-gray-600",children:t.description})]})}),e.jsx("div",{className:"max-w-6xl mx-auto px-8 py-6",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>_("posts"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y==="posts"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Пости (",o.length,")"]}),e.jsxs("button",{onClick:()=>_("members"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y==="members"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Учасники (",i.length,")"]}),e.jsx("button",{onClick:()=>_("info"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y==="info"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Інформація"})]})}),y==="posts"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("form",{onSubmit:Re,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:p!=null&&p.avatar?e.jsx("img",{src:p.avatar,alt:p.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm text-gray-600",children:(J=(be=p==null?void 0:p.name)==null?void 0:be[0])==null?void 0:J.toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:D,onChange:N=>W(N.target.value),placeholder:"Поділіться чимось з групою...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3}),A.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-4 gap-2",children:A.map((N,H)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:N.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(N),alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx($s,{size:24,className:"text-gray-400"})})}),e.jsx("button",{type:"button",onClick:()=>Se(H),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center",children:e.jsx(ve,{size:12})})]},H))}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-lg cursor-pointer",children:[e.jsx(Ls,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Фото/Відео"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",className:"hidden",onChange:Le})]})}),e.jsxs("button",{type:"submit",disabled:B||!D.trim()&&A.length===0,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[B?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(gt,{size:16,className:"mr-2"}),B?"Публікація...":"Опублікувати"]})]})]})]})})}),o.length>0?o.map(N=>{var H,le,ae,ce,se,me;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:(H=N.author)!=null&&H.avatar?e.jsx("img",{src:N.author.avatar,alt:N.author.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm text-gray-600",children:(ce=(ae=(le=N.author)==null?void 0:le.name)==null?void 0:ae[0])==null?void 0:ce.toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[(se=N.author)==null?void 0:se.name," ",(me=N.author)==null?void 0:me.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:u(N.created_at)})]})]}),e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(vs,{size:16,className:"text-gray-400"})})]})}),N.content&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("p",{className:"text-gray-900",children:N.content})}),N.media&&N.media.length>0&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:N.media.map((_e,n)=>e.jsx("div",{className:"rounded-lg overflow-hidden",children:_e.type==="image"?e.jsx("img",{src:_e.url,alt:"",className:"w-full h-64 object-cover"}):e.jsx("video",{src:_e.url,className:"w-full h-64 object-cover",controls:!0})},n))})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{className:"flex items-center text-gray-600 hover:text-red-500",children:[e.jsx(es,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Подобається"})]}),e.jsxs("button",{className:"flex items-center text-gray-600 hover:text-blue-500",children:[e.jsx(Ge,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Коментувати"})]}),e.jsxs("button",{className:"flex items-center text-gray-600 hover:text-green-500",children:[e.jsx(sr,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Поділитися"})]})]})})})]},N.id)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ge,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Поки що немає постів"}),e.jsx("p",{className:"text-gray-600",children:"Станьте першим, хто поділиться чимось цікавим!"})]})]}),y==="members"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Учасники групи (",i.length,")"]}),e.jsx("div",{className:"space-y-4",children:i.map(N=>{var H,le,ae,ce,se,me,_e;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center",children:(H=N.user)!=null&&H.avatar?e.jsx("img",{src:N.user.avatar,alt:N.user.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-lg text-gray-600",children:(ce=(ae=(le=N.user)==null?void 0:le.name)==null?void 0:ae[0])==null?void 0:ce.toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[(se=N.user)==null?void 0:se.name," ",(me=N.user)==null?void 0:me.last_name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${N.role==="admin"?"bg-red-100 text-red-800":N.role==="moderator"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:w(N.role)}),e.jsxs("span",{className:"ml-2",children:["Приєднався ",u(N.joined_at)]})]})]})]}),X&&((_e=N.user)==null?void 0:_e.id)!==(p==null?void 0:p.id)&&e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx(vs,{size:16})})]},N.id)})})]})}),y==="info"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 max-w-xl mx-auto",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-24 h-24 mb-4",children:[e.jsx("img",{src:z?URL.createObjectURL(z):t.avatar||"",alt:"Group avatar",className:"w-24 h-24 rounded-full object-cover border border-gray-200"}),X&&e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white rounded-full p-1 cursor-pointer hover:bg-blue-700",children:[e.jsx(Os,{size:16}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:N=>x(N.target.files[0])})]})]}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:t.name}),e.jsxs("div",{className:"text-gray-600 mb-2",children:["Створено: ",u(t.created_at)]}),e.jsxs("div",{className:"text-gray-600 mb-2",children:["Адміністратор: ",((Oe=(ze=i.find(N=>N.role==="admin"))==null?void 0:ze.user)==null?void 0:Oe.name)||"—"]}),re?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border rounded p-2 mb-2",rows:3,value:O,onChange:N=>U(N.target.value)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:j,onClick:async()=>{b(!0);let N=t.avatar;if(z){const le=z.name.split(".").pop(),ae=`${Date.now()}-${Math.random().toString(36).substring(7)}.${le}`,ce=`group-avatars/${s}/${ae}`,{error:se}=await T.storage.from("media").upload(ce,z);if(!se){const{data:{publicUrl:me}}=T.storage.from("media").getPublicUrl(ce);N=me}}const{error:H}=await T.from("groups").update({description:O,avatar:N}).eq("id",s);H||(a({...t,description:O,avatar:N}),K(!1),x(null)),b(!1)},children:"Зберегти"}),e.jsx("button",{className:"px-4 py-2 border rounded hover:bg-gray-100",onClick:()=>{K(!1),U(t.description||""),x(null)},children:"Скасувати"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 text-gray-800 w-full text-center min-h-[48px]",children:t.description||"Опис відсутній"}),X&&e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>{K(!0),U(t.description||"")},children:"Редагувати опис"})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Be,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Приєднайтеся до групи"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Щоб переглядати пости та брати участь в обговореннях, приєднайтеся до групи"}),e.jsxs("button",{onClick:ye,className:"flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mx-auto",children:[e.jsx(Je,{size:18,className:"mr-2"}),"Приєднатися до групи"]})]})})]})]})}function sa(){const[s,r]=d.useState([]),[t,a]=d.useState([]),[o,l]=d.useState([]),[i,g]=d.useState(""),[p,P]=d.useState(!0),[h,E]=d.useState(null),[v,M]=d.useState(!1),[y,_]=d.useState("grid"),[D,W]=d.useState({city:"",onlineStatus:"all",friendStatus:"all",sortBy:"date",sortOrder:"desc",hasAvatar:!1,hasBio:!1}),[A,G]=d.useState([]),[B,q]=d.useState(new Set),[re,K]=d.useState(!1),O=We();d.useEffect(()=>{U(),z()},[]),d.useEffect(()=>{j()},[i,s,D,o]);const U=async()=>{try{const{data:{user:u},error:w}=await T.auth.getUser();if(w||!u){const J=[{id:"1",name:"Анна",lastName:"Петренко",avatar:void 0,email:"anna@example.com",city:"Київ",isOnline:!0,lastSeen:new Date().toISOString(),mutualFriends:12,canAddToFriend:!0},{id:"2",name:"Максим",lastName:"Іваненко",avatar:void 0,email:"maxim@example.com",city:"Львів",isOnline:!1,lastSeen:new Date(Date.now()-36e5).toISOString(),mutualFriends:8,canAddToFriend:!0}];r(J),a(J);return}E(u.id);let I=await ge.getAllUsers();I=I.filter(J=>J&&J.id&&J.name&&(J.lastname||J.lastName)&&J.email);const X=I.map(J=>({...J,lastName:J.lastname||J.lastName,lastname:J.lastname,birthDate:J.birthdate,date:J.created_at||J.date,isOnline:Math.random()>.7,lastSeen:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),friendsCount:Math.floor(Math.random()*100),postsCount:Math.floor(Math.random()*50),mutualFriends:Math.floor(Math.random()*20),canAddToFriend:J.id!==u.id}));r(X);const be=[...new Set(X.filter(J=>J.city).map(J=>J.city))].sort();G(be)}catch(u){console.error("Error fetching users:",u),r([]),a([])}finally{P(!1)}},z=async()=>{try{const{data:{user:u}}=await T.auth.getUser();if(!u){l([]);return}const{data:w,error:I}=await T.from("friend_requests").select("*").or(`sender_id.eq.${u.id},receiver_id.eq.${u.id}`).eq("status","pending");if(I)throw I;l(w||[])}catch(u){console.error("Error fetching friend requests:",u),l([])}},x=u=>{if(!h)return"not_friends";if(u===h)return"self";const w=o.find(I=>I.user_id===h&&I.friend_id===u||I.user_id===u&&I.friend_id===h);return w?w.status==="accepted"?"friends":w.status==="pending"?w.user_id===h?"sent":"received":"not_friends":"not_friends"},j=()=>{let u=[...s];i.trim()!==""&&(u=u.filter(w=>w.name.toLowerCase().includes(i.toLowerCase())||(w.lastname||w.lastName||"").toLowerCase().includes(i.toLowerCase())||w.email.toLowerCase().includes(i.toLowerCase())||w.city&&w.city.toLowerCase().includes(i.toLowerCase())||w.bio&&w.bio.toLowerCase().includes(i.toLowerCase()))),D.city&&(u=u.filter(w=>w.city===D.city)),D.onlineStatus!=="all"&&(u=u.filter(w=>D.onlineStatus==="online"?w.isOnline:!w.isOnline)),D.friendStatus!=="all"&&(u=u.filter(w=>{const I=x(w.auth_user_id);switch(D.friendStatus){case"friends":return I==="friends";case"not_friends":return I==="not_friends";case"pending":return I==="sent"||I==="received";default:return!0}})),D.hasAvatar&&(u=u.filter(w=>w.avatar)),D.hasBio&&(u=u.filter(w=>w.bio&&w.bio.trim()!=="")),u.sort((w,I)=>{let X=0;switch(D.sortBy){case"name":X=`${w.name} ${w.lastName}`.localeCompare(`${I.name} ${I.lastName}`);break;case"date":X=new Date(w.date).getTime()-new Date(I.date).getTime();break;case"city":X=(w.city||"").localeCompare(I.city||"");break;case"lastSeen":w.isOnline&&!I.isOnline?X=-1:!w.isOnline&&I.isOnline?X=1:X=new Date(I.lastSeen||0).getTime()-new Date(w.lastSeen||0).getTime();break;case"popularity":X=(I.friendsCount||0)-(w.friendsCount||0);break}return D.sortOrder==="asc"?X:-X}),a(u)},b=async u=>{try{if(!h)return;if(u===h){alert("Ви не можете додати себе в друзі!");return}if(o.find(X=>X.user_id===h&&X.friend_id===u||X.user_id===u&&X.friend_id===h)){alert("Запит на дружбу вже існує!");return}const{error:I}=await T.from("friend_requests").insert([{sender_id:h,receiver_id:u,status:"pending"}]);if(I)throw I;alert("Запит на дружбу надіслано!"),z()}catch(w){console.error("Error adding friend:",w),alert("Помилка при додаванні в друзі")}},V=async(u,w)=>{try{const{error:I}=await T.from("friend_requests").update({status:w==="accept"?"accepted":"rejected"}).eq("id",u);if(I)throw I;alert(w==="accept"?"Запит прийнято!":"Запит відхилено!"),z()}catch(I){console.error("Error handling friend request:",I),alert("Помилка при обробці запиту")}},Z=async u=>{try{if(!h)return;const{error:w}=await T.from("friendships").delete().or(`and(user1_id.eq.${h},user2_id.eq.${u}),and(user1_id.eq.${u},user2_id.eq.${h})`);if(w)throw w;alert("Користувача видалено з друзів!"),z()}catch(w){console.error("Error removing friend:",w),alert("Помилка при видаленні з друзів")}},Y=u=>{const w=new Set(B);w.has(u)?w.delete(u):w.add(u),q(w),K(w.size>0)},ne=()=>{q(new Set),K(!1)},he=async()=>{for(const u of B)await b(u);ne()},ye=()=>{W({city:"",onlineStatus:"all",friendStatus:"all",sortBy:"date",sortOrder:"desc",hasAvatar:!1,hasBio:!1}),g("")},ke=u=>new Date(u).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric"}),Le=(u,w)=>{if(w)return"Онлайн";if(!u)return"Давно не з'являвся";const I=Date.now()-new Date(u).getTime(),X=Math.floor(I/(1e3*60)),be=Math.floor(I/(1e3*60*60)),J=Math.floor(I/(1e3*60*60*24));return X<60?`${X} хв тому`:be<24?`${be} год тому`:`${J} дн тому`},Se=()=>{let u=0;return D.city&&u++,D.onlineStatus!=="all"&&u++,D.friendStatus!=="all"&&u++,(D.sortBy!=="date"||D.sortOrder!=="desc")&&u++,D.hasAvatar&&u++,D.hasBio&&u++,u},Re=u=>{var X,be,J,ze,Oe,N,H,le,ae,ce;const w=x(u.auth_user_id),I=B.has(u.id);return y==="list"?e.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-all duration-200 ${I?"ring-2 ring-blue-500 bg-blue-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:()=>Y(u.id),className:"absolute top-0 left-0 w-4 h-4 rounded border-gray-300 text-blue-600"}),e.jsxs("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl font-bold overflow-hidden ml-6",children:[u.avatar?e.jsx("img",{src:u.avatar,alt:u.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{children:[(be=(X=u.name)==null?void 0:X[0])==null?void 0:be.toUpperCase(),(ze=(J=u.lastname||u.lastName)==null?void 0:J[0])==null?void 0:ze.toUpperCase()]}),u.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:[u.name," ",u.lastname||u.lastName]}),((Oe=u.privacy)==null?void 0:Oe.profileVisibility)==="private"&&e.jsx(Be,{size:16,className:"text-gray-400"}),w==="friends"&&e.jsx(Ds,{size:16,className:"text-green-500"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ds,{size:14,className:"mr-1"}),ke(u.date)]}),u.city&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(cs,{size:14,className:"mr-1"}),u.city]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ls,{size:14,className:"mr-1"}),Le(u.lastSeen,u.isOnline)]})]}),u.bio&&e.jsx("p",{className:"text-gray-600 text-sm mt-2 line-clamp-2",children:u.bio}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-2",children:[e.jsxs("span",{children:[u.friendsCount," друзів"]}),e.jsxs("span",{children:[u.postsCount," постів"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[w==="self"?e.jsx("button",{className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium cursor-default",disabled:!0,children:"Це ви"}):w==="friends"?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>Z(u.auth_user_id),className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Видалити з друзів"}),e.jsx("button",{onClick:()=>O(`/messages?user=${u.id}`),className:"p-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsx(Ge,{size:16})})]}):w==="sent"?e.jsx("button",{className:"px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg text-sm font-medium cursor-default",disabled:!0,children:"Запит надіслано"}):w==="received"?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{const se=o.find(me=>me.user_id===u.auth_user_id);se&&V(se.id,"accept")},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Прийняти"}),e.jsx("button",{onClick:()=>{const se=o.find(me=>me.user_id===u.auth_user_id);se&&V(se.id,"reject")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"Відхилити"})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>b(u.auth_user_id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Додати в друзі"}),e.jsx("button",{onClick:()=>O(`/messages?user=${u.id}`),className:"p-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsx(Ge,{size:16})})]}),e.jsx("button",{className:"p-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsx(vs,{size:16})})]})]})},u.id):e.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-200 cursor-pointer group hover:scale-105 ${I?"ring-2 ring-blue-500":""}`,onClick:()=>O(`/profile/${u.id}`),children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:se=>{se.stopPropagation(),Y(u.id)},className:"absolute top-3 left-3 w-4 h-4 rounded border-gray-300 text-blue-600 z-10"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs("div",{className:"relative w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl font-bold overflow-hidden flex-shrink-0",children:[u.avatar?e.jsx("img",{src:u.avatar,alt:u.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{children:[(H=(N=u.name)==null?void 0:N[0])==null?void 0:H.toUpperCase(),(ae=(le=u.lastname||u.lastName)==null?void 0:le[0])==null?void 0:ae.toUpperCase()]}),u.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors truncate",children:[u.name," ",u.lastname||u.lastName]}),((ce=u.privacy)==null?void 0:ce.profileVisibility)==="private"&&e.jsx(Be,{size:16,className:"text-gray-400"}),w==="friends"&&e.jsx(Ds,{size:16,className:"text-green-500"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(ls,{size:14,className:"mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:Le(u.lastSeen,u.isOnline)})]})]})]}),u.bio&&e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-3",children:u.bio}),e.jsxs("div",{className:"space-y-2 mb-4",children:[u.city&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(cs,{size:14,className:"mr-2 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:u.city})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ds,{size:14,className:"mr-2 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Приєднався ",ke(u.date)]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:[u.friendsCount," друзів"]}),e.jsxs("span",{children:[u.postsCount," постів"]})]})]}),e.jsxs("div",{className:"flex space-x-2",onClick:se=>se.stopPropagation(),children:[w==="self"?e.jsxs("button",{className:"flex-1 flex items-center justify-center px-3 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium cursor-default",disabled:!0,children:[e.jsx(js,{size:16,className:"mr-1"}),"Це ви"]}):w==="friends"?e.jsxs("button",{onClick:()=>Z(u.auth_user_id),className:"flex-1 flex items-center justify-center px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:[e.jsx(ir,{size:16,className:"mr-1"}),"Видалити"]}):w==="sent"?e.jsxs("button",{className:"flex-1 flex items-center justify-center px-3 py-2 bg-yellow-100 text-yellow-700 rounded-lg text-sm font-medium cursor-default",disabled:!0,children:[e.jsx(ls,{size:16,className:"mr-1"}),"Надіслано"]}):w==="received"?e.jsxs("button",{onClick:()=>{const se=o.find(me=>me.user_id===u.auth_user_id);se&&V(se.id,"accept")},className:"flex-1 flex items-center justify-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[e.jsx(Ds,{size:16,className:"mr-1"}),"Прийняти"]}):e.jsxs("button",{onClick:()=>b(u.auth_user_id),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx(Je,{size:16,className:"mr-1"}),"Додати"]}),w!=="self"&&e.jsx("button",{onClick:()=>O(`/messages?user=${u.id}`),className:"flex items-center justify-center px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",title:"Написати повідомлення",children:e.jsx(Ge,{size:16})})]})]})]})},u.id)};return p?e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Завантаження користувачів..."})]})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Всі користувачі"}),e.jsx("p",{className:"text-gray-600",children:"Перегляньте всіх зареєстрованих користувачів нашої соціальної мережі"})]}),re&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-blue-800",children:["Обрано ",B.size," користувачів"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:he,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Додати всіх в друзі"}),e.jsx("button",{onClick:ne,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Скасувати"})]})]})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук серед всіх користувачів...",value:i,onChange:u=>g(u.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),i&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{size:18})})]}),e.jsxs("button",{onClick:()=>M(!v),className:`flex items-center px-4 py-3 border rounded-lg transition-colors relative ${v?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(tr,{size:20,className:"mr-2"}),"Фільтри",Se()>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Se()}),e.jsx(ft,{size:16,className:`ml-2 transition-transform ${v?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>_("grid"),className:`p-3 ${y==="grid"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:e.jsx(rr,{size:18})}),e.jsx("button",{onClick:()=>_("list"),className:`p-3 ${y==="list"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:e.jsx(ar,{size:18})})]})]}),v&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Місто"}),e.jsxs("select",{value:D.city,onChange:u=>W(w=>({...w,city:u.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Всі міста"}),A.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Онлайн статус"}),e.jsxs("select",{value:D.onlineStatus,onChange:u=>W(w=>({...w,onlineStatus:u.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі"}),e.jsx("option",{value:"online",children:"Онлайн"}),e.jsx("option",{value:"offline",children:"Офлайн"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Статус дружби"}),e.jsxs("select",{value:D.friendStatus,onChange:u=>W(w=>({...w,friendStatus:u.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі"}),e.jsx("option",{value:"friends",children:"Друзі"}),e.jsx("option",{value:"not_friends",children:"Не друзі"}),e.jsx("option",{value:"pending",children:"Очікуючі запити"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Сортувати за"}),e.jsxs("select",{value:D.sortBy,onChange:u=>W(w=>({...w,sortBy:u.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"date",children:"Датою реєстрації"}),e.jsx("option",{value:"name",children:"Ім'ям"}),e.jsx("option",{value:"city",children:"Містом"}),e.jsx("option",{value:"lastSeen",children:"Останньою активністю"}),e.jsx("option",{value:"popularity",children:"Популярністю"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:D.hasAvatar,onChange:u=>W(w=>({...w,hasAvatar:u.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Тільки з фото"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:D.hasBio,onChange:u=>W(w=>({...w,hasBio:u.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Тільки з біографією"})]}),e.jsxs("button",{onClick:()=>W(u=>({...u,sortOrder:u.sortOrder==="asc"?"desc":"asc"})),className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(lr,{size:16,className:"mr-1"}),D.sortOrder==="asc"?"За зростанням":"За спаданням"]})]}),e.jsx("button",{onClick:ye,className:"text-sm text-blue-600 hover:text-blue-800",children:"Скинути фільтри"})]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[i?`Знайдено ${t.length} користувачів з ${s.length}`:`Всього ${t.length} користувачів`,i&&e.jsxs("span",{children:[' за запитом "',e.jsx("span",{className:"font-semibold",children:i}),'"']})]}),B.size>0&&e.jsx("button",{onClick:()=>{B.size===t.length?ne():(q(new Set(t.map(u=>u.id))),K(!0))},className:"text-sm text-blue-600 hover:text-blue-800",children:B.size===t.length?"Скасувати вибір":"Обрати всіх"})]}),t.length>0?e.jsx("div",{className:y==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:t.map(Re)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx($e,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Користувачів не знайдено"}),e.jsx("p",{className:"text-gray-600 mb-4",children:i||Se()>0?"Спробуйте змінити критерії пошуку або фільтри":"Поки що немає зареєстрованих користувачів"}),(i||Se()>0)&&e.jsx("button",{onClick:ye,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Скинути всі фільтри"})]})]})})]})}class Te{static async getAllGames(r,t){try{let a=T.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("is_active",!0).order("created_at",{ascending:!1});r&&r!=="other"&&(a=a.eq("category",r)),t&&t.length>=2&&(a=a.ilike("title",`%${t}%`));const{data:o,error:l}=await a;if(l)throw l;return o||[]}catch(a){return console.error("Error fetching games:",a),[]}}static async getGameById(r){try{const{data:t,error:a}=await T.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("id",r).eq("is_active",!0).single();if(a)throw a;return t}catch(t){return console.error("Error fetching game:",t),null}}static async createGame(r){try{const t=await ge.getCurrentUserProfile();if(!t)return null;const{data:a,error:o}=await T.from("games").insert([{...r,developer_id:t.id.toString()}]).select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).single();if(o)throw o;return a}catch(t){return console.error("Error creating game:",t),null}}static async updateGame(r,t){try{const{error:a}=await T.from("games").update({...t,updated_at:new Date().toISOString()}).eq("id",r);if(a)throw a;return!0}catch(a){return console.error("Error updating game:",a),!1}}static async deleteGame(r){try{const{error:t}=await T.from("games").delete().eq("id",r);if(t)throw t;return!0}catch(t){return console.error("Error deleting game:",t),!1}}static async getGamesByDeveloper(){try{const r=await ge.getCurrentUserProfile();if(!r)return[];const{data:t,error:a}=await T.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("developer_id",r.id.toString()).order("created_at",{ascending:!1});if(a)throw a;return t||[]}catch(r){return console.error("Error fetching developer games:",r),[]}}static async recordGamePlay(r,t=0){try{const a=await ge.getCurrentUserProfile();if(!a)return!1;const{error:o}=await T.from("game_plays").insert([{game_id:r,user_id:a.id.toString(),duration:t}]);if(o)throw o;return!0}catch(a){return console.error("Error recording game play:",a),!1}}static async rateGame(r,t,a=""){try{const o=await ge.getCurrentUserProfile();if(!o)return!1;const{error:l}=await T.from("game_ratings").upsert([{game_id:r,user_id:o.id.toString(),rating:t,review:a}]);if(l)throw l;return!0}catch(o){return console.error("Error rating game:",o),!1}}static async getGameRatings(r){try{const{data:t,error:a}=await T.from("game_ratings").select(`
          *,
          user:users!game_ratings_user_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("game_id",r).order("created_at",{ascending:!1});if(a)throw a;return t||[]}catch(t){return console.error("Error fetching game ratings:",t),[]}}static async getUserGameRating(r){try{const t=await ge.getCurrentUserProfile();if(!t)return null;const{data:a,error:o}=await T.from("game_ratings").select("*").eq("game_id",r).eq("user_id",t.id.toString()).single();if(o){if(o.code==="PGRST116")return null;throw o}return a}catch(t){return console.error("Error fetching user game rating:",t),null}}static async getPopularGames(r=10){try{const{data:t,error:a}=await T.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("is_active",!0).order("play_count",{ascending:!1}).limit(r);if(a)throw a;return t||[]}catch(t){return console.error("Error fetching popular games:",t),[]}}static async getTopRatedGames(r=10){try{const{data:t,error:a}=await T.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("is_active",!0).gt("rating",0).order("rating",{ascending:!1}).limit(r);if(a)throw a;return t||[]}catch(t){return console.error("Error fetching top rated games:",t),[]}}}function ta({game:s,onPlay:r}){var o,l,i,g,p,P;const t=h=>({action:"Екшн",puzzle:"Головоломки",strategy:"Стратегія",arcade:"Аркада",adventure:"Пригоди",simulation:"Симулятори",sports:"Спорт",racing:"Гонки",other:"Інше"})[h]||h,a=h=>h>=1e3?`${(h/1e3).toFixed(1)}k`:h.toString();return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow overflow-hidden group",children:[e.jsxs("div",{className:"relative h-48 bg-gradient-to-br from-blue-500 to-purple-600 overflow-hidden",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(as,{className:"text-white opacity-50",size:48})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("button",{onClick:r,className:"flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(as,{size:20,className:"mr-2"}),"Грати"]})}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded-full",children:t(s.category)})}),s.rating>0&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("div",{className:"flex items-center px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded-full",children:[e.jsx(Ms,{size:12,className:"mr-1 fill-current text-yellow-400"}),s.rating.toFixed(1)]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-1",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:s.description||"Немає опису"}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center mr-2",children:(o=s.developer)!=null&&o.avatar?e.jsx("img",{src:s.developer.avatar,alt:s.developer.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs text-gray-600",children:(g=(i=(l=s.developer)==null?void 0:l.name)==null?void 0:i[0])==null?void 0:g.toUpperCase()})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(p=s.developer)==null?void 0:p.name," ",(P=s.developer)==null?void 0:P.lastName]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ht,{size:16,className:"mr-1"}),e.jsxs("span",{children:[a(s.play_count)," грали"]})]}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("uk-UA")})]}),e.jsxs("button",{onClick:r,className:"w-full mt-4 flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(as,{size:18,className:"mr-2"}),"Грати зараз"]})]})]})}const ra=[{value:"action",label:"Екшн"},{value:"puzzle",label:"Головоломки"},{value:"strategy",label:"Стратегія"},{value:"arcade",label:"Аркада"},{value:"adventure",label:"Пригоди"},{value:"simulation",label:"Симулятори"},{value:"sports",label:"Спорт"},{value:"racing",label:"Гонки"},{value:"other",label:"Інше"}];function aa({onClose:s,onSubmit:r}){const[t,a]=d.useState(""),[o,l]=d.useState(""),[i,g]=d.useState(""),[p,P]=d.useState(""),[h,E]=d.useState("other"),[v,M]=d.useState(!1),y=async _=>{if(_.preventDefault(),!(!t.trim()||!p.trim())){M(!0);try{await r({title:t.trim(),description:o.trim(),thumbnail:i.trim()||void 0,game_url:p.trim(),category:h})}finally{M(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Додати нову гру"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ve,{size:24})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Назва гри *"}),e.jsx("input",{type:"text",value:t,onChange:_=>a(_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введіть назву гри",required:!0,maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Опис гри"}),e.jsx("textarea",{value:o,onChange:_=>l(_.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Розкажіть про вашу гру...",maxLength:500})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категорія *"}),e.jsx("select",{value:h,onChange:_=>E(_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:ra.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL гри *"}),e.jsxs("div",{className:"relative",children:[e.jsx(nr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"url",value:p,onChange:_=>P(_.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/game.html",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Посилання на HTML файл гри або веб-сторінку з грою"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Зображення гри (URL)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"url",value:i,onChange:_=>g(_.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/thumbnail.jpg"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Посилання на зображення-превью гри (необов'язково)"})]}),i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Превью:"}),e.jsx("img",{src:i,alt:"Game thumbnail preview",className:"w-full h-32 object-cover rounded-lg",onError:_=>{_.currentTarget.style.display="none"}})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Скасувати"}),e.jsx("button",{type:"submit",disabled:v||!t.trim()||!p.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Додавання...":"Додати гру"})]})]})]})})}function la({game:s,onClose:r}){var O,U;const[t,a]=d.useState(!1),[o,l]=d.useState(null),[i,g]=d.useState([]),[p,P]=d.useState(0),[h,E]=d.useState(""),[v,M]=d.useState(!1),[y]=d.useState(Date.now()),[_,D]=d.useState(!1);d.useEffect(()=>{W(),A(),G()},[s.id]);const W=async()=>{const z=await Te.getGameRatings(s.id);g(z)},A=async()=>{const z=await Te.getUserGameRating(s.id);l(z),z&&(P(z.rating),E(z.review))},G=async()=>{await Te.recordGamePlay(s.id)},B=async z=>{if(z.preventDefault(),p===0)return;D(!0),await Te.rateGame(s.id,p,h)&&(await W(),await A(),M(!1)),D(!1)},q=async()=>{const z=Math.floor((Date.now()-y)/1e3);z>10&&await Te.recordGamePlay(s.id,z),r()},re=()=>{a(!t)},K=(z,x=!1,j)=>e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(b=>e.jsx("button",{type:x?"button":void 0,onClick:x&&j?()=>j(b):void 0,className:`${x?"cursor-pointer hover:scale-110":"cursor-default"} transition-transform`,disabled:!x,children:e.jsx(Ms,{size:20,className:`${b<=z?"text-yellow-400 fill-current":"text-gray-300"}`})},b))});return e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${t?"p-0":"p-4"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl ${t?"w-full h-full rounded-none":"w-full max-w-6xl h-[90vh]"} flex flex-col`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mr-4",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ms,{size:16,className:"mr-1 text-yellow-400 fill-current"}),e.jsxs("span",{children:[s.rating.toFixed(1)," (",i.length," відгуків)"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:re,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",title:t?"Вийти з повноекранного режиму":"Повноекранний режим",children:e.jsx(or,{size:20})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",title:"Перезапустити гру",children:e.jsx(cr,{size:20})}),e.jsx("button",{onClick:q,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",children:e.jsx(ve,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx("div",{className:"flex-1 bg-gray-100",children:e.jsx("iframe",{src:s.game_url,className:"w-full h-full border-0",title:s.title,allowFullScreen:!0,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-pointer-lock"})}),!t&&e.jsx("div",{className:"w-80 border-l border-gray-200 bg-gray-50 overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Про гру"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description||"Немає опису"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Розробник:"}),e.jsxs("span",{className:"text-gray-900",children:[(O=s.developer)==null?void 0:O.name," ",(U=s.developer)==null?void 0:U.lastName]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Категорія:"}),e.jsx("span",{className:"text-gray-900",children:s.category})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Зіграно:"}),e.jsxs("span",{className:"text-gray-900",children:[s.play_count," разів"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Оцінка"}),!o&&e.jsx("button",{onClick:()=>M(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:"Оцінити"})]}),v&&e.jsxs("form",{onSubmit:B,className:"mb-4 p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ваша оцінка:"}),K(p,!0,P)]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Відгук (необов'язково):"}),e.jsx("textarea",{value:h,onChange:z=>E(z.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Поділіться враженнями від гри..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>M(!1),className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Скасувати"}),e.jsx("button",{type:"submit",disabled:_||p===0,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:_?"Збереження...":"Зберегти"})]})]}),o&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Ваша оцінка:"}),e.jsx("button",{onClick:()=>M(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:"Змінити"})]}),K(o.rating),o.review&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:o.review})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ys,{size:18,className:"mr-2"}),"Відгуки (",i.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:i.length>0?i.map(z=>{var x,j,b,V,Z,Y;return e.jsxs("div",{className:"p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center mr-2",children:(x=z.user)!=null&&x.avatar?e.jsx("img",{src:z.user.avatar,alt:z.user.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs text-gray-600",children:(V=(b=(j=z.user)==null?void 0:j.name)==null?void 0:b[0])==null?void 0:V.toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[(Z=z.user)==null?void 0:Z.name," ",(Y=z.user)==null?void 0:Y.lastName]})]}),K(z.rating)]}),z.review&&e.jsx("p",{className:"text-sm text-gray-600",children:z.review}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(z.created_at).toLocaleDateString("uk-UA")})]},z.id)}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Поки немає відгуків"})})]})]})})]})]})})}const ia=[{value:"action",label:"Екшн"},{value:"puzzle",label:"Головоломки"},{value:"strategy",label:"Стратегія"},{value:"arcade",label:"Аркада"},{value:"adventure",label:"Пригоди"},{value:"simulation",label:"Симулятори"},{value:"sports",label:"Спорт"},{value:"racing",label:"Гонки"},{value:"other",label:"Інше"}];function na(){const[s,r]=d.useState([]),[t,a]=d.useState([]),[o,l]=d.useState([]),[i,g]=d.useState(!0),[p,P]=d.useState(""),[h,E]=d.useState(""),[v,M]=d.useState(!1),[y,_]=d.useState(null),[D,W]=d.useState("all");We(),d.useEffect(()=>{A(),G(),B()},[]),d.useEffect(()=>{const O=setTimeout(()=>{A()},300);return()=>clearTimeout(O)},[p,h]);const A=async()=>{try{g(!0);const O=await Te.getAllGames(h,p);r(O)}catch(O){console.error("Error loading games:",O)}finally{g(!1)}},G=async()=>{try{const O=await Te.getPopularGames(6);a(O)}catch(O){console.error("Error loading popular games:",O)}},B=async()=>{try{const O=await Te.getTopRatedGames(6);l(O)}catch(O){console.error("Error loading top rated games:",O)}},q=async O=>{const U=await Te.createGame(O);U&&(r(z=>[U,...z]),M(!1))},re=O=>{_(O)},K=()=>{switch(D){case"popular":return t;case"top-rated":return o;default:return s}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qs,{className:"h-8 w-8 text-blue-600 mr-3"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ігри"})]}),e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ms,{size:20,className:"mr-2"}),"Додати гру"]})]}),e.jsxs("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg w-fit",children:[e.jsx("button",{onClick:()=>W("all"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="all"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Всі ігри"}),e.jsxs("button",{onClick:()=>W("popular"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="popular"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(xt,{size:16,className:"mr-1"}),"Популярні"]}),e.jsxs("button",{onClick:()=>W("top-rated"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="top-rated"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(dr,{size:16,className:"mr-1"}),"Найкращі"]})]}),D==="all"&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук ігор...",value:p,onChange:O=>P(O.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ur,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsxs("select",{value:h,onChange:O=>E(O.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Всі категорії"}),ia.map(O=>e.jsx("option",{value:O.value,children:O.label},O.value))]})]})]}),i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Завантаження ігор..."})]}):K().length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:K().map(O=>e.jsx(ta,{game:O,onPlay:()=>re(O)},O.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qs,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:p||h?"Ігри не знайдено":"Немає ігор"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:p||h?"Спробуйте змінити пошуковий запит або фільтр":"Додайте першу гру для спільноти"}),!p&&!h&&e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>M(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(ms,{className:"-ml-1 mr-2 h-5 w-5"}),"Додати гру"]})})]})]})}),v&&e.jsx(aa,{onClose:()=>M(!1),onSubmit:q}),y&&e.jsx(la,{game:y,onClose:()=>_(null)})]})}function oa(){return d.useEffect(()=>{(async()=>{var t,a,o,l,i,g,p;const{data:{session:r}}=await T.auth.getSession();if(r!=null&&r.user){const{data:P}=await T.from("users").select("id").eq("email",r.user.email).single();P||await T.from("users").insert([{name:((t=r.user.user_metadata)==null?void 0:t.name)||((o=(a=r.user.user_metadata)==null?void 0:a.full_name)==null?void 0:o.split(" ")[0])||((l=r.user.email)==null?void 0:l.split("@")[0])||"User",lastName:((i=r.user.user_metadata)==null?void 0:i.lastName)||((p=(g=r.user.user_metadata)==null?void 0:g.full_name)==null?void 0:p.split(" ").slice(1).join(" "))||"",email:r.user.email,date:new Date().toISOString(),notifications:{email:!0,messages:!0,friendRequests:!0},privacy:{profileVisibility:"public",showBirthDate:!0,showEmail:!1}}])}})()},[]),null}function ca(){return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($e,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Соціальна мережа"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(os,{to:"/login",className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"Вхід"}),e.jsx(os,{to:"/register",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200",children:"Реєстрація"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-8",children:"Ласкаво просимо до нашої спільноти"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Приєднуйтесь до нашої соціальної мережі, щоб спілкуватися з друзями, ділитися моментами та знаходити нові знайомства."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-12",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Спілкування"}),e.jsx("p",{className:"text-gray-600",children:"Спілкуйтеся з друзями та знаходьте нові знайомства"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Контент"}),e.jsx("p",{className:"text-gray-600",children:"Діліться фото, відео та іншими матеріалами"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Приватність"}),e.jsx("p",{className:"text-gray-600",children:"Повний контроль над вашими даними та приватністю"})]})]})]})})]})}function da(){return e.jsxs(e.Fragment,{children:[e.jsx(oa,{}),e.jsxs(At,{children:[e.jsx(Ce,{path:"/",element:e.jsx(ca,{})}),e.jsx(Ce,{path:"/login",element:e.jsx(jr,{})}),e.jsx(Ce,{path:"/register",element:e.jsx(vr,{})}),e.jsx(Ce,{path:"/profile",element:e.jsx(Hr,{})}),e.jsx(Ce,{path:"/reels",element:e.jsx(Jr,{})}),e.jsx(Ce,{path:"/messages",element:e.jsx(Xr,{})}),e.jsx(Ce,{path:"/friends",element:e.jsx(Qr,{})}),e.jsx(Ce,{path:"/people",element:e.jsx(sa,{})}),e.jsx(Ce,{path:"/settings",element:e.jsx(Kr,{})}),e.jsx(Ce,{path:"/groups",element:e.jsx(Yr,{})}),e.jsx(Ce,{path:"/groups/:groupId",element:e.jsx(ea,{})}),e.jsx(Ce,{path:"/games",element:e.jsx(na,{})})]})]})}yt(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(Lt,{basename:"/Nexus",children:e.jsx(da,{})})}));
