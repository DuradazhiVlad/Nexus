import{r as s,a as Qs}from"./vendor-CvXYpQ0N.js";import{u as Re,L as ts,N as Ae,a as Te,b as Xs,R as Ks,c as ze,H as Ys}from"./router-DAMWZ6Fk.js";import{c as et}from"./supabase-DjP6qkfU.js";import{G as st,M as fs,L as qe,U as Ve,C as tt,a as Me,V as zs,b as Se,c as rt,S as bs,d as at,X as we,e as He,A as ms,f as Ze,g as $s,P as Rs,h as lt,i as rs,j as ss,H as Be,k as Ls,I as ps,l as We,F as Ms,m as Qe,T as js,n as ws,o as Ps,Z as Ds,p as Ye,q as Xe,r as it,E as Ts,s as Oe,t as nt,u as ys,v as ot,w as As,x as qs,B as ct,y as dt,z as vs,D as xs,J as ut,K as mt,N as Ke,O as xt,Q as ht,R as gt,W as _s,Y as ft,_ as bt,$ as Fs,a0 as Is,a1 as Gs,a2 as pt,a3 as as,a4 as jt,a5 as yt,a6 as vt,a7 as Nt,a8 as hs,a9 as wt,aa as _t,ab as kt,ac as Ct,ad as ks,ae as St,af as Et,ag as Cs}from"./ui-BsJ1JwKk.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(c){if(c.ep)return;c.ep=!0;const o=t(c);fetch(c.href,o)}})();var Bs={exports:{}},is={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ut=s,zt=Symbol.for("react.element"),$t=Symbol.for("react.fragment"),Rt=Object.prototype.hasOwnProperty,Lt=Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Mt={key:!0,ref:!0,__self:!0,__source:!0};function Os(r,l,t){var n,c={},o=null,u=null;t!==void 0&&(o=""+t),l.key!==void 0&&(o=""+l.key),l.ref!==void 0&&(u=l.ref);for(n in l)Rt.call(l,n)&&!Mt.hasOwnProperty(n)&&(c[n]=l[n]);if(r&&r.defaultProps)for(n in l=r.defaultProps,l)c[n]===void 0&&(c[n]=l[n]);return{$$typeof:zt,type:r,key:o,ref:u,props:c,_owner:Lt.current}}is.Fragment=$t;is.jsx=Os;is.jsxs=Os;Bs.exports=is;var e=Bs.exports,Vs,Ss=Qs;Vs=Ss.createRoot,Ss.hydrateRoot;const Pt="https://gtfgvqttfydelzgvgwly.supabase.co",Dt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0Zmd2cXR0ZnlkZWx6Z3Znd2x5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjE0OTEsImV4cCI6MjA1OTU5NzQ5MX0.nBdVMHZ6LJ8ZvdSuXk_uDVMb6DxB5iTeFdc0dM7zolI";let Je=null;function Tt(){return Je||(Je=et(Pt,Dt,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:typeof window<"u"?window.localStorage:void 0,storageKey:"nexus-supabase-auth-token",flowType:"pkce"},global:{headers:{"x-application-name":"nexus-social-network","x-client-info":"nexus/1.0.0"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}}),Je.auth.onAuthStateChange((r,l)=>{r==="SIGNED_OUT"&&localStorage.removeItem("nexus-supabase-auth-token")}),Je)}const f=Tt(),Ge={signUp:(r,l,t)=>f.auth.signUp({email:r,password:l,options:t}),signIn:(r,l)=>f.auth.signInWithPassword({email:r,password:l}),signOut:()=>f.auth.signOut(),getUser:()=>f.auth.getUser(),getSession:()=>f.auth.getSession()};class Le{static async ensureAuthenticated(){try{const{data:{user:l},error:t}=await f.auth.getUser();if(t)throw console.error("Auth check failed:",t.message),new Error(`Authentication failed: ${t.message}`);if(!l)throw new Error("User not authenticated");return l}catch(l){throw console.error("Authentication error:",l),l}}static async getCurrentUserProfile(){try{const l=await this.ensureAuthenticated(),{data:t,error:n}=await f.from("user_profiles").select("*").eq("auth_user_id",l.id).single();if(n){if(n.code==="PGRST116")return await this.createUserProfile(l);throw console.error("Error fetching user profile:",n),new Error(`Failed to fetch user profile: ${n.message}`)}return t}catch(l){throw console.error("Error getting current user profile:",l),l}}static async createUserProfile(l){var t,n,c,o,u,L,w;try{const S={auth_user_id:l.id,name:((t=l.user_metadata)==null?void 0:t.name)||((c=(n=l.user_metadata)==null?void 0:n.full_name)==null?void 0:c.split(" ")[0])||((o=l.email)==null?void 0:o.split("@")[0])||"User",last_name:((u=l.user_metadata)==null?void 0:u.lastname)||((w=(L=l.user_metadata)==null?void 0:L.full_name)==null?void 0:w.split(" ").slice(1).join(" "))||"",email:l.email,notifications:{email:!0,messages:!0,friendRequests:!0},privacy:{profileVisibility:"public",showBirthDate:!0,showEmail:!1}},{data:b,error:I}=await f.from("user_profiles").insert([S]).select().single();if(I)throw console.error("Error creating user profile:",I),new Error(`Failed to create user profile: ${I.message}`);return b}catch(S){throw console.error("Error creating user profile:",S),S}}static async searchUsers(l){try{if(l.length<2)return[];await this.ensureAuthenticated();const{data:t,error:n}=await f.from("user_profiles").select("auth_user_id, name, last_name, avatar, email").or(`name.ilike.%${l}%,last_name.ilike.%${l}%`).limit(10);if(n)throw console.error("Error searching user_profiles:",n),new Error(`Search failed: ${n.message}`);return t||[]}catch(t){return console.error("Error searching user_profiles:",t),[]}}static async getAllUsers({limit:l=100,offset:t=0}={}){try{console.log("🔍 DatabaseService.getAllUsers called with:",{limit:l,offset:t}),await this.ensureAuthenticated(),console.log("📡 Executing Supabase query...");const{data:n,error:c}=await f.from("user_profiles").select("*").order("created_at",{ascending:!1}).range(t,t+l-1);if(console.log("📊 Supabase response:",{data:n,error:c}),c)throw console.error("❌ Error fetching all user_profiles:",c),new Error(`Failed to fetch user_profiles: ${c.message}`);const o=(n||[]).filter(u=>u&&u.auth_user_id&&u.name&&u.email&&u.name.trim()!==""&&u.email.trim()!=="");return console.log("✅ Valid profiles found:",o.length),console.log("📋 Sample profile:",o[0]),o}catch(n){return console.error("❌ Error fetching all user_profiles:",n),[]}}static async getUserPosts(l){try{const{data:t,error:n}=await f.from("posts").select("*").eq("user_id",l).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){return console.error("Error fetching user posts:",t),[]}}static async getUserMedia(l){try{const{data:t,error:n}=await f.from("media").select("*").eq("user_id",l).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){return console.error("Error fetching user media:",t),[]}}static async updateUserProfile(l){try{const t=await this.ensureAuthenticated(),{id:n,...c}=l;console.log("Updating user profile with:",c);const{data:o,error:u}=await f.from("user_profiles").update(c).eq("auth_user_id",t.id).select().single();if(u)throw console.error("Error updating user profile:",u),new Error(`Failed to update profile: ${u.message}`);return console.log("Successfully updated user profile:",o),o}catch(t){throw console.error("Error updating user profile:",t),t}}static async createPost(l,t,n){try{const c=await this.getCurrentUserProfile();if(!c)throw new Error("User not authenticated");const o={user_id:c.auth_user_id,content:l,media_url:t,media_type:n},{data:u,error:L}=await f.from("posts").insert([o]).select().single();if(L)throw L;return u}catch(c){return console.error("Error creating post:",c),null}}static async getUserGroups(l){try{const{data:t,error:n}=await f.from("group_members").select(`
          groups:group_id (
            id,
            name,
            description,
            avatar,
            is_private,
            created_by,
            created_at,
            member_count
          )
        `).eq("user_id",l);if(n)throw n;return(t==null?void 0:t.map(c=>c.groups).filter(Boolean))||[]}catch(t){return console.error("Error fetching user groups:",t),[]}}static async getUserFriends(l){try{const{data:t,error:n}=await f.from("friendships").select("*").or(`user1_id.eq.${l},user2_id.eq.${l}`);if(n)throw n;const c=(t||[]).map(L=>L.user1_id===l?L.user2_id:L.user1_id);if(c.length===0)return[];const{data:o,error:u}=await f.from("user_profiles").select("id, name, lastname, avatar, email").in("auth_user_id",c);if(u)throw u;return o||[]}catch(t){return console.error("Error fetching user friends:",t),[]}}static async sendFriendRequest(l){try{const t=await this.getCurrentUserProfile();if(!t)throw new Error("User not authenticated");const{error:n}=await f.from("friend_requests").insert([{sender_id:t.auth_user_id,receiver_id:l,status:"pending"}]);if(n)throw n;return!0}catch(t){return console.error("Error sending friend request:",t),!1}}static async addFriend(l){try{const t=await this.getCurrentUserProfile();if(!t)return!1;const{error:n}=await f.from("friends").insert([{user_id:t.auth_user_id,friend_id:l}]);if(n)throw n;return!0}catch(t){return console.error("Error adding friend:",t),!1}}}const ls=class ls{static async initialize(){try{console.log("Initializing AuthService...");const{data:{session:l},error:t}=await Ge.getSession();if(t){console.error("Error getting session:",t.message),this.updateState({user:null,profile:null,loading:!1,error:t.message});return}if(l!=null&&l.user){console.log("Found existing session for:",l.user.email);try{const n=await Le.getCurrentUserProfile();this.updateState({user:l.user,profile:n,loading:!1,error:null})}catch(n){console.error("Error loading profile:",n),this.updateState({user:l.user,profile:null,loading:!1,error:n instanceof Error?n.message:"Profile load error"})}}else console.log("No existing session found"),this.updateState({user:null,profile:null,loading:!1,error:null});f.auth.onAuthStateChange(async(n,c)=>{var o;if(console.log("Auth state change:",n,((o=c==null?void 0:c.user)==null?void 0:o.email)||"no user"),c!=null&&c.user)try{const u=await Le.getCurrentUserProfile();this.updateState({user:c.user,profile:u,loading:!1,error:null})}catch(u){console.error("Error loading profile on auth change:",u),this.updateState({user:c.user,profile:null,loading:!1,error:u instanceof Error?u.message:"Profile load error"})}else this.updateState({user:null,profile:null,loading:!1,error:null})})}catch(l){console.error("Error initializing auth:",l),this.updateState({user:null,profile:null,loading:!1,error:l instanceof Error?l.message:"Unknown error"})}}static async signIn(l,t){try{this.updateState({...this.currentState,loading:!0,error:null});const{data:n,error:c}=await Ge.signIn(l,t);return c?(this.updateState({...this.currentState,loading:!1,error:c.message}),{success:!1,error:c.message}):{success:!0,user:n.user}}catch(n){const c=n instanceof Error?n.message:"Unknown error";return this.updateState({...this.currentState,loading:!1,error:c}),{success:!1,error:c}}}static async signUp(l,t,n){try{this.updateState({...this.currentState,loading:!0,error:null});const{data:c,error:o}=await Ge.signUp(l,t,{data:{name:n.name,lastname:n.lastname||""}});return o?(this.updateState({...this.currentState,loading:!1,error:o.message}),{success:!1,error:o.message}):{success:!0,user:c.user}}catch(c){const o=c instanceof Error?c.message:"Unknown error";return this.updateState({...this.currentState,loading:!1,error:o}),{success:!1,error:o}}}static async signOut(){try{const{error:l}=await Ge.signOut();return l?(console.error("Error signing out:",l.message),{success:!1,error:l.message}):{success:!0}}catch(l){const t=l instanceof Error?l.message:"Unknown error";return console.error("Error signing out:",t),{success:!1,error:t}}}static getState(){return this.currentState}static subscribe(l){return this.listeners.push(l),()=>{this.listeners=this.listeners.filter(t=>t!==l)}}static updateState(l){this.currentState={...this.currentState,...l},this.listeners.forEach(t=>t(this.currentState))}};ls.listeners=[],ls.currentState={user:null,profile:null,loading:!0,error:null};let gs=ls;async function At(r){return await f.auth.resend({type:"signup",email:r})}function qt(){const[r,l]=s.useState(""),[t,n]=s.useState(""),[c,o]=s.useState(""),[u,L]=s.useState(!1),[w,S]=s.useState(!1),[b,I]=s.useState(!1),[_,V]=s.useState(!1),E=Re(),k=async $=>{$.preventDefault(),o(""),L(!0),S(!1),V(!1);try{const{error:J}=await f.auth.signInWithPassword({email:r,password:t});if(J){if(J.message&&J.message.toLowerCase().includes("email not confirmed")){o("Електронна пошта не підтверджена. Будь ласка, підтвердіть email."),S(!0);return}throw J}E("/profile")}catch(J){console.error("Login error:",J),o(J.message||"Помилка входу")}finally{L(!1)}},v=async()=>{I(!0),V(!1);try{const{error:$}=await At(r);if($)throw $;V(!0)}catch($){o("Не вдалося надіслати листа. "+($.message||$))}finally{I(!1)}},T=async()=>{try{const{error:$}=await f.auth.signInWithOAuth({provider:"github",options:{redirectTo:`${window.location.origin}/profile`,queryParams:{access_type:"offline",prompt:"consent"}}});if($)throw $}catch($){console.error("GitHub login error:",$),o($.message||"Помилка входу через GitHub")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Вхід до аккаунту"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Або"," ",e.jsx(ts,{to:"/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"створіть новий аккаунт"})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[c&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:[c,w&&e.jsxs("div",{className:"mt-2",children:[e.jsx("button",{onClick:v,disabled:b,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 mt-2",children:b?"Відправка...":"Відправити лист повторно"}),_&&e.jsx("div",{className:"text-green-600 mt-2",children:"Лист для підтвердження відправлено!"})]})]}),e.jsxs("button",{onClick:T,className:"w-full flex justify-center items-center gap-2 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 mb-6",children:[e.jsx(st,{size:20}),"Увійти через GitHub"]}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Або увійдіть за допомогою email"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(fs,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"email",type:"email",value:r,onChange:$=>l($.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Пароль"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(qe,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"password",type:"password",value:t,onChange:$=>n($.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть пароль",required:!0})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:u,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Завантаження...":"Увійти"})})]})]})})]})}async function Ft(r){const{data:l,error:t}=await f.from("user_profiles").select("*").eq("auth_user_id",r).single();if(t)throw t;return l}async function Hs({auth_user_id:r,name:l,last_name:t,email:n,...c}){const o={auth_user_id:r,name:l,last_name:t,email:n,...c};o.birth_date===""&&(o.birth_date=null),o.birthday===""&&(o.birthday=null);const{data:u,error:L}=await f.from("user_profiles").select("id").eq("auth_user_id",r).maybeSingle();if(L)return{error:L};if(u){const{data:w,error:S}=await f.from("user_profiles").update(o).eq("auth_user_id",r).select().maybeSingle();return{data:w,error:S}}else{const{data:w,error:S}=await f.from("user_profiles").insert(o).select().maybeSingle();return{data:w,error:S}}}function It(){const[r,l]=s.useState(""),[t,n]=s.useState(""),[c,o]=s.useState(""),[u,L]=s.useState(""),[w,S]=s.useState(""),[b,I]=s.useState(!1),_=Re(),V=async E=>{E.preventDefault(),S(""),I(!0);try{const{data:k,error:v}=await f.auth.signUp({email:c,password:u});if(v)throw v;if(k.user){const{error:T}=await Hs({auth_user_id:k.user.id,name:r,last_name:t,email:c});if(T)throw T;_("/profile/confirm")}}catch(k){console.error("Registration error:",k),S(k.message||"Помилка реєстрації")}finally{I(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Створення нового аккаунту"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Або"," ",e.jsx(ts,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"увійдіть в існуючий аккаунт"})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[w&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:w}),e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Ім'я"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(Ve,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"name",type:"text",value:r,onChange:E=>l(E.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть ім'я",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700",children:"Прізвище"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(Ve,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"lastName",type:"text",value:t,onChange:E=>n(E.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть прізвище",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(fs,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"email",type:"email",value:c,onChange:E=>o(E.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Пароль"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(qe,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{id:"password",type:"password",value:u,onChange:E=>L(E.target.value),className:"appearance-none block w-full px-10 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введіть пароль",required:!0,minLength:6})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:b,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Завантаження...":"Зареєструватися"})})]})]})})]})}function ke(){const r=Re(),l=async()=>{try{const{error:t}=await f.auth.signOut();if(t)throw t;r("/login")}catch(t){console.error("Error logging out:",t)}};return e.jsxs("div",{className:"w-64 bg-white h-screen fixed left-0 top-0 border-r border-gray-200",children:[e.jsx("div",{className:"p-4",children:e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Соціальна мережа"})}),e.jsxs("nav",{className:"mt-8",children:[e.jsxs(Ae,{to:"/profile",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(tt,{className:"w-5 h-5 mr-3"}),"Профіль"]}),e.jsxs(Ae,{to:"/people",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(Me,{className:"w-5 h-5 mr-3"}),"Люди"]}),e.jsxs(Ae,{to:"/reels",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(zs,{className:"w-5 h-5 mr-3"}),"Рілс"]}),e.jsxs(Ae,{to:"/messages",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(Se,{className:"w-5 h-5 mr-3"}),"Повідомлення"]}),e.jsxs(Ae,{to:"/friends",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(Me,{className:"w-5 h-5 mr-3"}),"Друзі"]}),e.jsxs(Ae,{to:"/groups",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(rt,{className:"w-5 h-5 mr-3"}),"Групи"]}),e.jsxs(Ae,{to:"/settings",className:({isActive:t})=>`flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 ${t?"bg-gray-100":""}`,children:[e.jsx(bs,{className:"w-5 h-5 mr-3"}),"Налаштування"]})]}),e.jsx("div",{className:"absolute bottom-0 w-full p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:l,className:"flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 w-full",children:[e.jsx(at,{className:"w-5 h-5 mr-3"}),"Вийти"]})})]})}function Gt({onUploadSuccess:r,onUploadError:l,accept:t="image/*",maxSize:n=5,className:c="",buttonText:o="Завантажити файл",showPreview:u=!0}){const[L,w]=s.useState(!1),[S,b]=s.useState(null),I=s.useRef(null),_=async v=>{var $;const T=($=v.target.files)==null?void 0:$[0];if(T){if(T.size>n*1024*1024){l(`Файл занадто великий. Максимальний розмір: ${n}MB`);return}if(!T.type.startsWith("image/")){l("Будь ласка, виберіть зображення");return}if(u){const J=new FileReader;J.onload=m=>{var M;b((M=m.target)==null?void 0:M.result)},J.readAsDataURL(T)}await V(T)}},V=async v=>{try{w(!0);const T=v.name.split(".").pop(),J=`avatars/${`${Math.random()}.${T}`}`,{error:m}=await f.storage.from("avatars").upload(J,v);if(m)throw m;const{data:{publicUrl:M}}=f.storage.from("avatars").getPublicUrl(J);r(M)}catch(T){console.error("Error uploading file:",T),l(T instanceof Error?T.message:"Помилка завантаження файлу")}finally{w(!1)}},E=()=>{var v;(v=I.current)==null||v.click()},k=()=>{b(null),I.current&&(I.current.value="")};return e.jsxs("div",{className:c,children:[e.jsx("input",{ref:I,type:"file",accept:t,onChange:_,className:"hidden"}),u&&S?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:S,alt:"Preview",className:"w-16 h-16 rounded-full object-cover"}),e.jsx("button",{onClick:k,className:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:e.jsx(we,{size:12})})]}):e.jsxs("button",{onClick:E,disabled:L,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",children:[L?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(He,{size:16,className:"mr-2"}),L?"Завантаження...":o]})]})}async function Js(){return f.from("posts").select("*, user_profiles!posts_user_id_fkey (id, name, last_name, avatar)").order("created_at",{ascending:!1})}async function Zs(r){const{data:{user:l}}=await f.auth.getUser();if(!l)throw new Error("User not authenticated");const{data:t,error:n}=await f.from("user_profiles").select("id").eq("auth_user_id",l.id).single();if(n||!t)throw new Error("User profile not found");return f.from("posts").insert([{...r,user_id:t.id}])}async function Bt(r){const{data:{user:l}}=await f.auth.getUser();if(!l)throw new Error("User not authenticated");const{data:t,error:n}=await f.from("user_profiles").select("id").eq("auth_user_id",l.id).single();if(n||!t)throw new Error("User profile not found");return f.from("post_likes").insert([{post_id:r,user_id:t.id}])}async function Ot(r){const{data:{user:l}}=await f.auth.getUser();if(!l)throw new Error("User not authenticated");const{data:t,error:n}=await f.from("user_profiles").select("id").eq("auth_user_id",l.id).single();if(n||!t)throw new Error("User profile not found");return f.from("post_likes").delete().eq("post_id",r).eq("user_id",t.id)}async function Es(r){return f.from("post_comments").select("*, user_profiles!post_comments_user_id_fkey (id, name, last_name, avatar)").eq("post_id",r).order("created_at",{ascending:!0})}async function Vt(r,l){const{data:{user:t}}=await f.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:n,error:c}=await f.from("user_profiles").select("id").eq("auth_user_id",t.id).single();if(c||!n)throw new Error("User profile not found");return f.from("post_comments").insert([{post_id:r,user_id:n.id,content:l}])}async function Ht(r,l){return f.from("posts").update(l).eq("id",r)}async function Jt(r){return f.from("posts").delete().eq("id",r)}function Zt(){var F,de,me,p,O;const[r,l]=s.useState(null),[t,n]=s.useState(!0),[c,o]=s.useState(null),[u,L]=s.useState(null),[w,S]=s.useState(!1),[b,I]=s.useState(!1),[_,V]=s.useState(null),[E,k]=s.useState(""),[v,T]=s.useState(""),[$,J]=s.useState(""),[m,M]=s.useState(!1),[D,Z]=s.useState(!1),[x,z]=s.useState(!1),[P,ee]=s.useState(!1),[X,K]=s.useState(0),[ie,ne]=s.useState([]),[oe,je]=s.useState(!1),[R,q]=s.useState({name:"",last_name:"",email:"",bio:"",city:"",birth_date:"",avatar:"",education:"",phone:"",hobbies:[],relationship_status:"",work:"",website:"",languages:[],newHobby:"",newLanguage:"",notifications:{email:!0,messages:!0,friendRequests:!0},privacy:{profileVisibility:"public",showBirthDate:!0,showEmail:!1}}),C=Re(),A=Te(),W=280,ce=["😊","😂","❤️","👍","🎉","🔥","😍","🤔","😭","😎","🥳","💪","✨","🌟","💯"];s.useEffect(()=>{he()},[A.key]),s.useEffect(()=>{_&&y()},[_]),s.useEffect(()=>{K(E.length)},[E]);const he=async()=>{var a,g,Y,ae;try{n(!0),o(null),console.log("🔍 Loading profile...");const{data:{user:Ne},error:Pe}=await f.auth.getUser();if(Pe)throw console.error("Auth error:",Pe),new Error(`Помилка аутентифікації: ${Pe.message}`);if(!Ne){console.log("No authenticated user, redirecting to login"),C("/login");return}console.log("✅ Authenticated user:",Ne.email),V(Ne);const ye=await Le.getCurrentUserProfile();if(ye)console.log("✅ User profile loaded:",ye),l(ye),q({name:ye.name,last_name:ye.last_name||"",email:ye.email,bio:ye.bio||"",city:ye.city||"",birth_date:ye.birth_date||"",avatar:ye.avatar||"",education:ye.education||"",phone:ye.phone||"",hobbies:ye.hobbies||[],relationship_status:ye.relationship_status||"",work:ye.work||"",website:ye.website||"",languages:ye.languages||[],newHobby:"",newLanguage:"",notifications:ye.notifications||{email:!0,messages:!0,friendRequests:!0},privacy:ye.privacy||{profileVisibility:"public",showBirthDate:!0,showEmail:!1}});else{console.log("No user profile found, creating new one");const Fe={auth_user_id:Ne.id,name:((g=(a=Ne.user_metadata)==null?void 0:a.full_name)==null?void 0:g.split(" ")[0])||"Користувач",last_name:((ae=(Y=Ne.user_metadata)==null?void 0:Y.full_name)==null?void 0:ae.split(" ").slice(1).join(" "))||"",email:Ne.email||"",bio:"",city:"",birth_date:"",avatar:"",education:"",phone:"",hobbies:[],relationship_status:"",work:"",website:"",languages:[],email_verified:!!Ne.email_confirmed_at,notifications:{email:!0,messages:!0,friendRequests:!0},privacy:{profileVisibility:"public",showBirthDate:!0,showEmail:!1}},{data:pe,error:Ie}=await f.from("user_profiles").insert([Fe]).select().single();if(Ie)throw Ie;l(pe),q({name:pe.name,last_name:pe.last_name||"",email:pe.email,bio:pe.bio||"",city:pe.city||"",birth_date:pe.birth_date||"",avatar:pe.avatar||"",education:pe.education||"",phone:pe.phone||"",hobbies:pe.hobbies||[],relationship_status:pe.relationship_status||"",work:pe.work||"",website:pe.website||"",languages:pe.languages||[],newHobby:"",newLanguage:"",notifications:pe.notifications||{email:!0,messages:!0,friendRequests:!0},privacy:pe.privacy||{profileVisibility:"public",showBirthDate:!0,showEmail:!1}})}}catch(Ne){console.error("Error loading profile:",Ne),o(Ne instanceof Error?Ne.message:"Помилка завантаження профілю")}finally{n(!1)}},ue=()=>{const a=[];R.name.trim()||a.push("Ім'я є обов'язковим полем");const g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return R.email&&!g.test(R.email)&&a.push("Невірний формат email"),R.phone&&!/^[\d\s\-\+\(\)]+$/.test(R.phone)&&a.push("Невірний формат телефону"),R.website&&!/^https?:\/\/.+/.test(R.website)&&a.push("Веб-сайт повинен починатися з http:// або https://"),R.bio&&R.bio.length>500&&a.push("Біо не може перевищувати 500 символів"),a},xe=async()=>{try{I(!0),o(null);const a=ue();if(a.length>0){o(a.join(", "));return}if(!_)throw new Error("Користувач не авторизований");const g={name:R.name.trim(),last_name:R.last_name.trim(),email:R.email.trim(),bio:R.bio.trim(),city:R.city.trim(),birth_date:R.birth_date,avatar:R.avatar,education:R.education.trim(),phone:R.phone.trim(),hobbies:R.hobbies,relationship_status:R.relationship_status.trim(),work:R.work.trim(),website:R.website.trim(),languages:R.languages,notifications:R.notifications,privacy:R.privacy,updated_at:new Date().toISOString()},{error:Y}=await f.from("user_profiles").update(g).eq("auth_user_id",_.id);if(Y)throw Y;L("Профіль успішно оновлено!"),S(!1),he(),setTimeout(()=>L(null),3e3)}catch(a){console.error("Error saving profile:",a),o(a instanceof Error?a.message:"Помилка збереження профілю")}finally{I(!1)}},se=()=>{S(!1),o(null),r&&q({name:r.name,last_name:r.last_name||"",email:r.email,bio:r.bio||"",city:r.city||"",birth_date:r.birth_date||"",avatar:r.avatar||"",education:r.education||"",phone:r.phone||"",hobbies:r.hobbies||[],relationship_status:r.relationship_status||"",work:r.work||"",website:r.website||"",languages:r.languages||[],newHobby:"",newLanguage:"",notifications:r.notifications||{email:!0,messages:!0,friendRequests:!0},privacy:r.privacy||{profileVisibility:"public",showBirthDate:!0,showEmail:!1}})},ge=()=>{R.newHobby.trim()&&!R.hobbies.includes(R.newHobby.trim())&&q(a=>({...a,hobbies:[...a.hobbies,R.newHobby.trim()],newHobby:""}))},re=a=>{q(g=>({...g,hobbies:g.hobbies.filter(Y=>Y!==a)}))},fe=()=>{R.newLanguage.trim()&&!R.languages.includes(R.newLanguage.trim())&&q(a=>({...a,languages:[...a.languages,R.newLanguage.trim()],newLanguage:""}))},Ee=a=>{q(g=>({...g,languages:g.languages.filter(Y=>Y!==a)}))},ve=a=>a?new Date(a).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric"}):"Не вказано",N=(a,g)=>{const Y=a?a[0].toUpperCase():"",ae=g?g[0].toUpperCase():"";return`${Y}${ae}`},H=a=>{X+a.length<=W&&k(g=>g+a)},d=async a=>{if(a.preventDefault(),!(!E.trim()||!_||X>W)){M(!0);try{console.log("Creating post with content:",E);const{data:g,error:Y}=await Zs({content:E,media_url:v||void 0,media_type:$||void 0});if(Y)throw console.error("Error creating post:",Y),Y;console.log("Post created successfully:",g),k(""),T(""),J(""),ee(!1),z(!1),Z(!1),L("Пост успішно створено!"),y()}catch(g){console.error("Error creating post:",g),o("Не вдалося створити пост")}finally{M(!1)}}},y=async()=>{if(_){je(!0);try{console.log("Loading posts for user:",_.id);const{data:a,error:g}=await Js();if(g)throw console.error("Error fetching posts:",g),g;console.log("All posts fetched:",a);const Y=(a||[]).filter(ae=>(console.log("Checking post:",ae.id,"user_id:",ae.user_id,"currentUser.id:",_.id),ae.user_id===_.id));console.log("Filtered user posts:",Y),ne(Y)}catch(a){console.error("Error loading user posts:",a)}finally{je(!1)}}},G=a=>{const g=new Date(a),ae=Math.floor((new Date().getTime()-g.getTime())/(1e3*60*60));return ae<1?"щойно":ae<24?`${ae}г тому`:g.toLocaleDateString("uk-UA",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})};return t?e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Завантаження профілю..."})]})})})]}):c&&!r?e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ms,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Помилка завантаження"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c}),e.jsx("button",{onClick:he,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Спробувати знову"})]})})})]}):r?e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[u&&e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center",children:[e.jsx(Ze,{className:"h-5 w-5 mr-2"}),u]}),c&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center",children:[e.jsx(ms,{className:"h-5 w-5 mr-2"}),c]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-6",children:[e.jsx("div",{className:"h-48 bg-gradient-to-r from-blue-500 to-purple-600 relative",children:e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20"})}),e.jsxs("div",{className:"relative px-6 pb-6",children:[e.jsxs("div",{className:"flex items-end justify-between -mt-16 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 bg-white rounded-full p-2 shadow-lg",children:r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:N(r.name,r.last_name)})}),w&&e.jsx("button",{className:"absolute bottom-2 right-2 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors",children:e.jsx($s,{size:16})})]}),e.jsx("div",{className:"flex space-x-2",children:w?e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:xe,disabled:b,className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[b?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(lt,{size:16,className:"mr-2"}),b?"Збереження...":"Зберегти"]}),e.jsxs("button",{onClick:se,disabled:b,className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:[e.jsx(we,{size:16,className:"mr-2"}),"Скасувати"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Rs,{size:16,className:"mr-2"}),"Редагувати профіль"]}),e.jsxs("button",{onClick:()=>C("/settings"),className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(bs,{size:16,className:"mr-2"}),"Налаштування"]})]})})]}),e.jsx("div",{className:"space-y-4",children:w?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ім'я *"}),e.jsx("input",{type:"text",value:R.name,onChange:a=>q(g=>({...g,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть ім'я",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:R.email,onChange:a=>q(g=>({...g,email:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть email",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Про себе"}),e.jsx("textarea",{value:R.bio,onChange:a=>q(g=>({...g,bio:a.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Розкажіть про себе",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[R.bio.length,"/500"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Місто"}),e.jsx("input",{type:"text",value:R.city,onChange:a=>q(g=>({...g,city:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть місто"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Освіта"}),e.jsx("input",{type:"text",value:R.education,onChange:a=>q(g=>({...g,education:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть освіту"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Телефон"}),e.jsx("input",{type:"tel",value:R.phone,onChange:a=>q(g=>({...g,phone:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть телефон"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Хобі"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent",children:[R.hobbies.map((a,g)=>e.jsxs("span",{className:"flex items-center bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full",children:[a,e.jsx("button",{type:"button",onClick:()=>re(a),className:"ml-1 text-blue-800 hover:text-blue-900 focus:outline-none",children:e.jsx(we,{size:12})})]},g)),e.jsx("input",{type:"text",value:R.newHobby,onChange:a=>q(g=>({...g,newHobby:a.target.value})),onKeyPress:a=>{a.key==="Enter"&&ge()},className:"flex-1 px-1 py-0.5 bg-transparent focus:outline-none",placeholder:"Додати хобі і натиснути Enter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Сімейний стан"}),e.jsx("input",{type:"text",value:R.relationship_status,onChange:a=>q(g=>({...g,relationship_status:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть сімейний стан"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Прізвище"}),e.jsx("input",{type:"text",value:R.last_name,onChange:a=>q(g=>({...g,last_name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть прізвище"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Аватар"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center",children:R.avatar?e.jsx("img",{src:R.avatar,alt:"Avatar",className:"w-full h-full rounded-full object-cover"}):e.jsx(Ve,{className:"h-8 w-8 text-gray-400"})}),e.jsx(Gt,{onUploadSuccess:a=>q(g=>({...g,avatar:a})),onUploadError:a=>o(a),accept:"image/*",maxSize:5,buttonText:"Завантажити аватар",showPreview:!1})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"День народження"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:R.birth_date,onChange:a=>q(g=>({...g,birth_date:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx(ss,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Робота"}),e.jsx("input",{type:"text",value:R.work,onChange:a=>q(g=>({...g,work:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть роботу"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Веб-сайт"}),e.jsx("input",{type:"url",value:R.website,onChange:a=>q(g=>({...g,website:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Мови"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent",children:[R.languages.map((a,g)=>e.jsxs("span",{className:"flex items-center bg-purple-100 text-purple-800 text-sm font-medium px-2.5 py-0.5 rounded-full",children:[a,e.jsx("button",{type:"button",onClick:()=>Ee(a),className:"ml-1 text-purple-800 hover:text-purple-900 focus:outline-none",children:e.jsx(we,{size:12})})]},g)),e.jsx("input",{type:"text",value:R.newLanguage,onChange:a=>q(g=>({...g,newLanguage:a.target.value})),onKeyPress:a=>{a.key==="Enter"&&fe()},className:"flex-1 px-1 py-0.5 bg-transparent focus:outline-none",placeholder:"Додати мову і натиснути Enter"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Показувати дату народження"}),e.jsxs("select",{value:R.privacy.showBirthDate?"true":"false",onChange:a=>q(g=>({...g,privacy:{...g.privacy,showBirthDate:a.target.value==="true"}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"true",children:"Так"}),e.jsx("option",{value:"false",children:"Ні"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Показувати email"}),e.jsxs("select",{value:R.privacy.showEmail?"true":"false",onChange:a=>q(g=>({...g,privacy:{...g.privacy,showEmail:a.target.value==="true"}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"true",children:"Так"}),e.jsx("option",{value:"false",children:"Ні"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Показувати профіль всім"}),e.jsxs("select",{value:R.privacy.profileVisibility,onChange:a=>q(g=>({...g,privacy:{...g.privacy,profileVisibility:a.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"public",children:"Всім"}),e.jsx("option",{value:"friends",children:"Друзям"}),e.jsx("option",{value:"private",children:"Тільки мені"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[r.name," ",r.last_name]}),e.jsxs("p",{className:"text-gray-600 flex items-center mt-1",children:[e.jsx(fs,{size:16,className:"mr-2"}),r.email]})]}),r.bio&&e.jsx("p",{className:"text-gray-700 text-lg leading-relaxed",children:r.bio}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600",children:[r.city&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(rs,{size:16,className:"mr-1"}),r.city]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ss,{size:16,className:"mr-1"}),"Приєднався ",ve(r.created_at)]}),r.birth_date&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ss,{size:16,className:"mr-1"}),"Народився ",ve(r.birth_date)]})]}),(r.education||r.work||r.phone||r.website||((F=r.hobbies)==null?void 0:F.length)||((de=r.languages)==null?void 0:de.length))&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Додаткова інформація"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.education&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Освіта:"}),e.jsx("p",{className:"text-gray-900",children:r.education})]}),r.work&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Робота:"}),e.jsx("p",{className:"text-gray-900",children:r.work})]}),r.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Телефон:"}),e.jsx("p",{className:"text-gray-900",children:r.phone})]}),r.website&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Веб-сайт:"}),e.jsx("a",{href:r.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:r.website})]}),r.relationship_status&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Сімейний стан:"}),e.jsx("p",{className:"text-gray-900",children:r.relationship_status})]})]}),((me=r.hobbies)==null?void 0:me.length)>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Хобі:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:r.hobbies.map((a,g)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full",children:a},g))})]}),((p=r.languages)==null?void 0:p.length)>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Мови:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:r.languages.map((a,g)=>e.jsx("span",{className:"bg-purple-100 text-purple-800 text-sm font-medium px-2.5 py-0.5 rounded-full",children:a},g))})]})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(Be,{className:"h-6 w-6 text-blue-600"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Вподобань"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(Se,{className:"h-6 w-6 text-green-600"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Постів"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(Me,{className:"h-6 w-6 text-purple-600"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Друзів"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsx("button",{className:"py-4 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm",children:"Пости"}),e.jsx("button",{className:"py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm",children:"Фото"}),e.jsx("button",{className:"py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm",children:"Друзі"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold",children:((O=r==null?void 0:r.name)==null?void 0:O.charAt(0).toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("form",{onSubmit:d,children:[e.jsx("textarea",{className:"w-full border-0 resize-none text-lg placeholder-gray-500 focus:outline-none focus:ring-0 bg-transparent",placeholder:"Що нового?",value:E,onChange:a=>k(a.target.value),rows:3,maxLength:W}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>z(!x),className:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 rounded-full transition-colors",children:e.jsx(Ls,{size:18})}),e.jsx("button",{type:"button",onClick:()=>ee(!P),className:"p-2 text-gray-500 hover:text-green-500 hover:bg-green-50 rounded-full transition-colors",children:e.jsx(ps,{size:18})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:`text-sm ${X>W?"text-red-500":"text-gray-500"}`,children:[X,"/",W]}),e.jsxs("button",{type:"submit",disabled:m||!E.trim()||X>W,className:"px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center text-sm",children:[m?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(We,{size:14,className:"mr-2"}),m?"Створення...":"Опублікувати"]})]})]})]}),x&&e.jsx("div",{className:"mt-3 p-3 bg-white rounded-lg border",children:e.jsx("div",{className:"grid grid-cols-8 gap-2",children:ce.map((a,g)=>e.jsx("button",{onClick:()=>H(a),className:"text-xl hover:bg-gray-100 rounded p-1 transition-colors",children:a},g))})}),P&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Посилання на медіа (необов'язково)",value:v,onChange:a=>T(a.target.value)}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",value:$,onChange:a=>J(a.target.value),children:[e.jsx("option",{value:"",children:"Тип медіа"}),e.jsx("option",{value:"photo",children:"Фото"}),e.jsx("option",{value:"video",children:"Відео"}),e.jsx("option",{value:"document",children:"Документ"})]})]})]})]})})}),oe?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Завантаження постів..."})]}):ie.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(Se,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-base font-medium text-gray-900 mb-1",children:"Поки що немає постів"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Створіть свій перший пост вище!"})]}):e.jsx("div",{className:"space-y-4",children:ie.map(a=>{var g;return e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold",children:((g=r==null?void 0:r.name)==null?void 0:g.charAt(0).toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-900 text-sm",children:[r==null?void 0:r.name," ",r==null?void 0:r.last_name]}),e.jsx("span",{className:"text-xs text-gray-500",children:G(a.created_at)})]}),e.jsx("div",{className:"text-gray-700 text-sm whitespace-pre-line mb-2",children:a.content}),a.media_url&&e.jsx("div",{className:"mb-2",children:a.media_type==="photo"?e.jsx("img",{src:a.media_url,alt:"media",className:"max-h-48 w-full object-cover rounded-lg"}):a.media_type==="video"?e.jsx("video",{src:a.media_url,controls:!0,className:"max-h-48 w-full rounded-lg"}):a.media_type==="document"?e.jsxs("a",{href:a.media_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm",children:[e.jsx(Ms,{size:14,className:"mr-1"}),"Переглянути документ"]}):null}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["❤️ ",a.likes_count||0]}),e.jsxs("span",{children:["💬 ",a.comments_count||0]})]})]})]})},a.id)})})]})]})]})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ve,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Профіль не знайдено"}),e.jsx("p",{className:"text-gray-600",children:"Не вдалося завантажити дані профілю"})]})})})]})}function Wt(){var Ns;const[r,l]=s.useState([]),[t,n]=s.useState(0),[c,o]=s.useState(!0),[u,L]=s.useState(null),[w,S]=s.useState(!0),[b,I]=s.useState(!1),[_,V]=s.useState(!1),[E,k]=s.useState(!1),[v,T]=s.useState([]),[$,J]=s.useState(""),[m,M]=s.useState("all"),[D,Z]=s.useState(""),[x,z]=s.useState(!1),[P,ee]=s.useState(!1),[X,K]=s.useState("select"),[ie,ne]=s.useState(null),[oe,je]=s.useState(""),[R,q]=s.useState(""),[C,A]=s.useState(""),[W,ce]=s.useState([]),[he,ue]=s.useState(""),[xe,se]=s.useState("other"),[ge,re]=s.useState(0),[fe,Ee]=s.useState(),[ve,N]=s.useState(0),[H,d]=s.useState(0),[y,G]=s.useState(0),[F,de]=s.useState(0),[me,p]=s.useState({brightness:100,contrast:100,saturation:100,blur:0,sepia:0,grayscale:0}),O=s.useRef([]),a=s.useRef(null),g=s.useRef(null),Y=s.useRef(null),ae=Re();s.useEffect(()=>{Ne()},[]),s.useEffect(()=>{u&&Pe()},[u,m]),s.useEffect(()=>{if(r.length>0&&O.current[t]){const h=O.current[t];h&&(w?h.play().catch(console.error):h.pause(),h.muted=b)}},[t,w,b,r]),s.useEffect(()=>{O.current.forEach((h,B)=>{h&&B!==t&&(h.pause(),h.currentTime=0)})},[t]),s.useEffect(()=>{const h=U=>{P&&(U.preventDefault(),U.deltaY>0&&t<r.length-1?n(_e=>_e+1):U.deltaY<0&&t>0&&n(_e=>_e-1))},B=a.current;if(B)return B.addEventListener("wheel",h,{passive:!1}),()=>B.removeEventListener("wheel",h)},[t,r.length,P]);const Ne=async()=>{try{const{data:{user:h}}=await f.auth.getUser();h?L(h.id):ae("/login")}catch(h){console.error("Error fetching user:",h),ae("/login")}},Pe=async()=>{try{o(!0);const h=ye();let B=h;m!=="all"&&(m==="trending"?B=h.filter(U=>U.views>1e4).sort((U,_e)=>_e.views-U.views):m==="following"?B=h.filter(U=>U.isFollowing):B=h.filter(U=>U.category===m)),D&&(B=B.filter(U=>U.title.toLowerCase().includes(D.toLowerCase())||U.description.toLowerCase().includes(D.toLowerCase())||U.hashtags.some(_e=>_e.toLowerCase().includes(D.toLowerCase()))||U.userName.toLowerCase().includes(D.toLowerCase()))),l(B),n(0)}catch(h){console.error("Error loading reels:",h)}finally{o(!1)}},ye=()=>{const h=["trending","music","comedy","dance","food","travel","sports","education","pets","art"],B=[];for(let U=1;U<=50;U++)B.push({id:U.toString(),userId:`user_${U}`,userName:`User${U}`,userAvatar:`https://images.unsplash.com/photo-${15e11+U*1e3}?auto=format&fit=crop&w=100&q=80`,isVerified:Math.random()>.8,videoUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",thumbnailUrl:`https://images.unsplash.com/photo-${16e11+U*1e3}?auto=format&fit=crop&w=400&q=80`,title:`Amazing Reel ${U}`,description:`This is an amazing reel number ${U}! Check out this incredible content that will blow your mind! 🤯`,duration:Math.floor(Math.random()*60)+15,views:Math.floor(Math.random()*1e5)+1e3,likes:Math.floor(Math.random()*1e4)+100,comments:Math.floor(Math.random()*1e3)+10,shares:Math.floor(Math.random()*500)+5,bookmarks:Math.floor(Math.random()*2e3)+20,createdAt:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),music:Math.random()>.3?{id:`music_${U}`,title:`Track ${U}`,artist:`Artist ${U}`,url:"",duration:30}:void 0,hashtags:[`#reel${U}`,"#amazing","#viral","#trending"],location:Math.random()>.5?"Київ, Україна":void 0,isLiked:Math.random()>.7,isBookmarked:Math.random()>.8,isFollowing:Math.random()>.6,category:h[Math.floor(Math.random()*h.length)]});return B},Fe=async h=>{const B=[];for(let U=1;U<=20;U++)B.push({id:`comment_${U}`,userId:`user_${U}`,userName:`User${U}`,userAvatar:`https://images.unsplash.com/photo-${15e11+U*1e3}?auto=format&fit=crop&w=50&q=80`,content:`This is an amazing comment ${U}! I love this reel! 😍`,likes:Math.floor(Math.random()*100),replies:Math.floor(Math.random()*10),createdAt:new Date(Date.now()-Math.random()*24*60*60*1e3).toISOString(),isLiked:Math.random()>.7});T(B)},pe=async h=>{l(B=>B.map(U=>U.id===h?{...U,isLiked:!U.isLiked,likes:U.isLiked?U.likes-1:U.likes+1}:U))},Ie=async h=>{l(B=>B.map(U=>U.id===h?{...U,isBookmarked:!U.isBookmarked,bookmarks:U.isBookmarked?U.bookmarks-1:U.bookmarks+1}:U))},cs=async h=>{l(B=>B.map(U=>U.userId===h?{...U,isFollowing:!U.isFollowing}:U))},es=async()=>{if(!$.trim())return;const h={id:Date.now().toString(),userId:u,userName:"Ви",content:$,likes:0,replies:0,createdAt:new Date().toISOString(),isLiked:!1};T(U=>[h,...U]),J("");const B=r[t];l(U=>U.map(_e=>_e.id===B.id?{..._e,comments:_e.comments+1}:_e))},ds=h=>{var U;const B=(U=h.target.files)==null?void 0:U[0];if(B&&B.type.startsWith("video/")){ne(B);const _e=URL.createObjectURL(B);je(_e),K("edit")}},us=()=>{const h=Y.current;h&&(N(h.duration),G(h.duration))},i=()=>{K("select"),ne(null),je(""),q(""),A(""),ce([]),ue(""),se("other"),Ee(void 0),p({brightness:100,contrast:100,saturation:100,blur:0,sepia:0,grayscale:0}),d(0),G(0)},j=async()=>{if(!ie)return;K("uploading"),re(0);for(let B=0;B<=100;B+=10)re(B),await new Promise(U=>setTimeout(U,200));const h={id:Date.now().toString(),userId:u,userName:"Ви",videoUrl:oe,title:R,description:C,duration:y-H,views:0,likes:0,comments:0,shares:0,bookmarks:0,createdAt:new Date().toISOString(),music:fe,hashtags:W,location:he,isLiked:!1,isBookmarked:!1,isFollowing:!1,category:xe};l(B=>[h,...B]),k(!1),i(),n(0)},Q=h=>{const B=Math.floor(h/60),U=Math.floor(h%60);return`${B}:${U.toString().padStart(2,"0")}`},te=h=>h>=1e6?(h/1e6).toFixed(1)+"M":h>=1e3?(h/1e3).toFixed(1)+"K":h.toString(),be=h=>{const B=Date.now()-new Date(h).getTime(),U=Math.floor(B/(1e3*60*60)),_e=Math.floor(B/(1e3*60*60*24));return U<24?`${U} год тому`:`${_e} дн тому`},Ce=()=>{t<r.length-1&&n(h=>h+1)},Ue=()=>{t>0&&n(h=>h-1)},$e=()=>{ee(!P)};if(c)return e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Завантаження рілс..."})]})})]});if(!P)return e.jsxs("div",{className:"flex min-h-screen bg-black",children:[e.jsx(ke,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-black border-b border-gray-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Рілс"}),e.jsx("div",{className:"flex space-x-2",children:[{id:"all",label:"Всі",icon:Qe},{id:"trending",label:"Тренди",icon:js},{id:"following",label:"Підписки",icon:Me},{id:"music",label:"Музика",icon:ws},{id:"comedy",label:"Комедія",icon:Ps},{id:"dance",label:"Танці",icon:Ds}].map(h=>e.jsxs("button",{onClick:()=>M(h.id),className:`flex items-center space-x-1 px-3 py-2 rounded-full text-sm transition-colors ${m===h.id?"bg-blue-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[e.jsx(h.icon,{size:16}),e.jsx("span",{children:h.label})]},h.id))})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>z(!x),className:"p-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:e.jsx(Ye,{size:20})}),x&&e.jsx("div",{className:"absolute right-0 top-12 w-80 bg-gray-900 rounded-lg shadow-xl border border-gray-700 p-4 z-50",children:e.jsx("input",{type:"text",placeholder:"Пошук рілс...",value:D,onChange:h=>Z(h.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})})]}),e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Xe,{size:20}),e.jsx("span",{children:"Створити"})]}),e.jsx("button",{onClick:$e,className:"p-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:e.jsx(it,{size:20})})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:r.map((h,B)=>{var U;return e.jsxs("div",{className:"relative aspect-[9/16] bg-gray-900 rounded-lg overflow-hidden cursor-pointer group hover:scale-105 transition-transform duration-200",onClick:()=>{n(B),$e()},children:[e.jsx("img",{src:h.thumbnailUrl,alt:h.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden",children:h.userAvatar?e.jsx("img",{src:h.userAvatar,alt:h.userName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white text-xs font-bold",children:(U=h.userName[0])==null?void 0:U.toUpperCase()})}),e.jsx("span",{className:"text-white text-sm font-medium",children:h.userName}),h.isVerified&&e.jsx(Ze,{size:12,className:"text-blue-500"})]}),e.jsx("p",{className:"text-white text-sm line-clamp-2 mb-2",children:h.title}),e.jsxs("div",{className:"flex items-center justify-between text-white/80 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Be,{size:12,className:"mr-1"}),te(h.likes)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ts,{size:12,className:"mr-1"}),te(h.views)]})]}),e.jsx("span",{children:Q(h.duration)})]})]}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Oe,{size:20,className:"text-white"})})]},h.id)})})})]})]});const le=r[t];return le?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex",ref:a,children:[e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:h=>{O.current[t]=h},src:le.videoUrl,className:"max-h-full max-w-full object-contain",loop:!0,playsInline:!0,onClick:()=>S(!w)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:!w&&e.jsx("button",{onClick:()=>S(!0),className:"w-16 h-16 bg-black/50 rounded-full flex items-center justify-center text-white",children:e.jsx(Oe,{size:24})})}),e.jsx("button",{onClick:Ue,disabled:t===0,className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-black/30 rounded-full flex items-center justify-center text-white disabled:opacity-30 hover:bg-black/50 transition-colors",children:e.jsx(nt,{size:20})}),e.jsx("button",{onClick:Ce,disabled:t===r.length-1,className:"absolute right-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-black/30 rounded-full flex items-center justify-center text-white disabled:opacity-30 hover:bg-black/50 transition-colors",children:e.jsx(ys,{size:20})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between text-white",children:[e.jsx("button",{onClick:$e,className:"p-2 bg-black/30 rounded-full hover:bg-black/50 transition-colors",children:e.jsx(ot,{size:20})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>I(!b),className:"p-2 bg-black/30 rounded-full hover:bg-black/50 transition-colors",children:b?e.jsx(As,{size:20}):e.jsx(qs,{size:20})})})]}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsx("div",{className:"w-full h-1 bg-white/30 rounded-full",children:e.jsx("div",{className:"h-full bg-white rounded-full transition-all duration-100",style:{width:`${F/le.duration*100}%`}})})})]}),e.jsxs("div",{className:"w-80 bg-black/50 backdrop-blur-sm p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden",children:le.userAvatar?e.jsx("img",{src:le.userAvatar,alt:le.userName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white text-lg font-bold",children:(Ns=le.userName[0])==null?void 0:Ns.toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-white font-semibold",children:le.userName}),le.isVerified&&e.jsx(Ze,{size:16,className:"text-blue-500"})]}),e.jsx("p",{className:"text-white/60 text-sm",children:be(le.createdAt)})]}),le.userId!==u&&e.jsx("button",{onClick:()=>cs(le.userId),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${le.isFollowing?"bg-gray-600 text-white hover:bg-gray-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:le.isFollowing?"Відписатися":"Підписатися"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-white text-lg font-semibold mb-2",children:le.title}),e.jsx("p",{className:"text-white/80 text-sm mb-3",children:le.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:le.hashtags.map((h,B)=>e.jsx("span",{className:"text-blue-400 text-sm hover:text-blue-300 cursor-pointer",children:h},B))}),le.music&&e.jsxs("div",{className:"flex items-center space-x-2 text-white/60 text-sm mb-3",children:[e.jsx(ws,{size:14}),e.jsxs("span",{children:[le.music.artist," - ",le.music.title]})]}),le.location&&e.jsxs("div",{className:"flex items-center space-x-2 text-white/60 text-sm",children:[e.jsx(Qe,{size:14}),e.jsx("span",{children:le.location})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-lg font-semibold",children:te(le.views)}),e.jsx("div",{className:"text-white/60 text-sm",children:"Переглядів"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-lg font-semibold",children:te(le.likes)}),e.jsx("div",{className:"text-white/60 text-sm",children:"Вподобань"})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("button",{onClick:()=>pe(le.id),className:`w-full flex items-center justify-center space-x-2 py-3 rounded-lg transition-colors ${le.isLiked?"bg-red-600 text-white hover:bg-red-700":"bg-gray-800 text-white hover:bg-gray-700"}`,children:[e.jsx(Be,{size:20,className:le.isLiked?"fill-current":""}),e.jsx("span",{children:le.isLiked?"Не подобається":"Подобається"})]}),e.jsxs("button",{onClick:()=>{V(!0),Fe(le.id)},className:"w-full flex items-center justify-center space-x-2 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx(Se,{size:20}),e.jsxs("span",{children:["Коментарі (",te(le.comments),")"]})]}),e.jsxs("button",{onClick:()=>Ie(le.id),className:`w-full flex items-center justify-center space-x-2 py-3 rounded-lg transition-colors ${le.isBookmarked?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-gray-800 text-white hover:bg-gray-700"}`,children:[le.isBookmarked?e.jsx(ct,{size:20}):e.jsx(dt,{size:20}),e.jsx("span",{children:le.isBookmarked?"В збережених":"Зберегти"})]}),e.jsxs("button",{className:"w-full flex items-center justify-center space-x-2 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx(vs,{size:20}),e.jsx("span",{children:"Поділитися"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold mb-3",children:"Схожі рілс"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.slice(t+1,t+5).map((h,B)=>e.jsx("div",{className:"aspect-[9/16] bg-gray-800 rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform",onClick:()=>n(t+1+B),children:e.jsx("img",{src:h.thumbnailUrl,alt:h.title,className:"w-full h-full object-cover"})},h.id))})]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-60",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("h3",{className:"text-white text-lg font-semibold",children:["Коментарі (",te(le.comments),")"]}),e.jsx("button",{onClick:()=>V(!1),className:"text-gray-400 hover:text-white",children:e.jsx(we,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:v.map(h=>{var B;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0",children:h.userAvatar?e.jsx("img",{src:h.userAvatar,alt:h.userName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:(B=h.userName[0])==null?void 0:B.toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-white font-medium text-sm",children:h.userName}),e.jsx("span",{className:"text-gray-400 text-xs",children:be(h.createdAt)})]}),e.jsx("p",{className:"text-white/80 text-sm mb-2",children:h.content}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-400 text-xs",children:[e.jsxs("button",{className:"hover:text-white flex items-center space-x-1",children:[e.jsx(Be,{size:12,className:h.isLiked?"fill-current text-red-500":""}),e.jsx("span",{children:h.likes})]}),e.jsx("button",{className:"hover:text-white",children:"Відповісти"})]})]})]},h.id)})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("input",{type:"text",placeholder:"Додати коментар...",value:$,onChange:h=>J(h.target.value),className:"flex-1 bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:h=>h.key==="Enter"&&es()}),e.jsx("button",{onClick:es,disabled:!$.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Надіслати"})]})})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-60",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[X==="select"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-white text-2xl font-bold",children:"Створити рел"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-white",children:e.jsx(we,{size:24})})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-12 text-center cursor-pointer hover:border-gray-500 transition-colors",onClick:()=>{var h;return(h=g.current)==null?void 0:h.click()},children:[e.jsx(He,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Завантажити відео"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Перетягніть відео сюди або натисніть для вибору"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Підтримувані формати: MP4, MOV, AVI. Максимум 100MB"})]}),e.jsx("input",{ref:g,type:"file",accept:"video/*",onChange:ds,className:"hidden"})]}),X==="edit"&&e.jsxs("div",{className:"flex h-[80vh]",children:[e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-6",children:e.jsx("video",{ref:Y,src:oe,className:"max-h-full max-w-full object-contain",controls:!0,onLoadedMetadata:us,onTimeUpdate:h=>de(h.currentTarget.currentTime),style:{filter:`brightness(${me.brightness}%) contrast(${me.contrast}%) saturate(${me.saturation}%) blur(${me.blur}px) sepia(${me.sepia}%) grayscale(${me.grayscale}%)`}})}),e.jsxs("div",{className:"w-80 bg-gray-800 p-6 overflow-y-auto",children:[e.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Редагування відео"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Обрізати відео"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 text-sm mb-1",children:["Початок: ",Q(H)]}),e.jsx("input",{type:"range",min:0,max:ve,step:.1,value:H,onChange:h=>d(Number(h.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 text-sm mb-1",children:["Кінець: ",Q(y)]}),e.jsx("input",{type:"range",min:0,max:ve,step:.1,value:y,onChange:h=>G(Number(h.target.value)),className:"w-full"})]}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Тривалість: ",Q(y-H)]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Фільтри"}),e.jsx("div",{className:"space-y-3",children:Object.entries(me).map(([h,B])=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 text-sm mb-1 capitalize",children:[h,": ",B,h==="blur"?"px":"%"]}),e.jsx("input",{type:"range",min:h==="blur"?0:h==="brightness"||h==="contrast"||h==="saturation"?50:0,max:h==="blur"?10:h==="brightness"||h==="contrast"||h==="saturation"?150:100,value:B,onChange:U=>p(_e=>({..._e,[h]:Number(U.target.value)})),className:"w-full"})]},h))})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>K("select"),className:"flex-1 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Назад"}),e.jsx("button",{onClick:()=>K("details"),className:"flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Далі"})]})]})]}),X==="details"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-white text-2xl font-bold",children:"Деталі рілу"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-white",children:e.jsx(we,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Назва *"}),e.jsx("input",{type:"text",value:R,onChange:h=>q(h.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введіть назву рілу",maxLength:100}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[R.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Опис"}),e.jsx("textarea",{value:C,onChange:h=>A(h.target.value),rows:4,className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Розкажіть про ваш рел",maxLength:500}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[C.length,"/500"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Категорія"}),e.jsxs("select",{value:xe,onChange:h=>se(h.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"other",children:"Інше"}),e.jsx("option",{value:"music",children:"Музика"}),e.jsx("option",{value:"comedy",children:"Комедія"}),e.jsx("option",{value:"dance",children:"Танці"}),e.jsx("option",{value:"food",children:"Їжа"}),e.jsx("option",{value:"travel",children:"Подорожі"}),e.jsx("option",{value:"sports",children:"Спорт"}),e.jsx("option",{value:"education",children:"Освіта"}),e.jsx("option",{value:"pets",children:"Тварини"}),e.jsx("option",{value:"art",children:"Мистецтво"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Локація"}),e.jsx("input",{type:"text",value:he,onChange:h=>ue(h.target.value),className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Де було знято відео"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Хештеги"}),e.jsx("input",{type:"text",placeholder:"Додайте хештеги через кому",className:"w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:h=>{if(h.key==="Enter"||h.key===","){h.preventDefault();const B=h.currentTarget.value.trim();B&&!W.includes(`#${B}`)&&(ce(U=>[...U,`#${B}`]),h.currentTarget.value="")}}}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:W.map((h,B)=>e.jsxs("span",{className:"bg-blue-600 text-white px-2 py-1 rounded-full text-sm flex items-center space-x-1",children:[e.jsx("span",{children:h}),e.jsx("button",{onClick:()=>ce(U=>U.filter((_e,Ws)=>Ws!==B)),className:"hover:text-red-300",children:e.jsx(we,{size:12})})]},B))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-white font-medium mb-2",children:"Попередній перегляд"}),e.jsx("div",{className:"aspect-[9/16] bg-black rounded-lg overflow-hidden",children:e.jsx("video",{src:oe,className:"w-full h-full object-cover",muted:!0,loop:!0,autoPlay:!0})})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx("button",{onClick:()=>K("edit"),className:"px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Назад"}),e.jsx("button",{onClick:j,disabled:!R.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Опублікувати"})]})]}),X==="uploading"&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-white text-2xl font-bold mb-2",children:"Завантаження рілу"}),e.jsx("p",{className:"text-gray-400",children:"Будь ласка, зачекайте..."})]}),e.jsxs("div",{className:"w-64 mx-auto",children:[e.jsx("div",{className:"bg-gray-700 rounded-full h-4 mb-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-300",style:{width:`${ge}%`}})}),e.jsxs("p",{className:"text-white text-lg font-semibold",children:[ge,"%"]})]})]})]})})]}):null}const Qt=r=>{switch(r){case"error":return e.jsx(mt,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(ms,{className:"w-5 h-5 text-yellow-600"});case"info":return e.jsx(ut,{className:"w-5 h-5 text-blue-600"});case"success":return e.jsx(xs,{className:"w-5 h-5 text-green-600"})}},Xt=r=>{switch(r){case"error":return{container:"bg-red-50 border-red-200 text-red-800",icon:"bg-red-100",closeButton:"text-red-400 hover:text-red-600",retryButton:"bg-red-600 hover:bg-red-700 text-white"};case"warning":return{container:"bg-yellow-50 border-yellow-200 text-yellow-800",icon:"bg-yellow-100",closeButton:"text-yellow-400 hover:text-yellow-600",retryButton:"bg-yellow-600 hover:bg-yellow-700 text-white"};case"info":return{container:"bg-blue-50 border-blue-200 text-blue-800",icon:"bg-blue-100",closeButton:"text-blue-400 hover:text-blue-600",retryButton:"bg-blue-600 hover:bg-blue-700 text-white"};case"success":return{container:"bg-green-50 border-green-200 text-green-800",icon:"bg-green-100",closeButton:"text-green-400 hover:text-green-600",retryButton:"bg-green-600 hover:bg-green-700 text-white"}}},ns=({type:r,title:l,message:t,details:n,onClose:c,autoClose:o=!0,duration:u=5e3,showRetry:L=!1,onRetry:w})=>{const[S,b]=s.useState(!0),[I,_]=s.useState(!1),V=Xt(r);s.useEffect(()=>{if(o){const v=setTimeout(()=>{b(!1),setTimeout(()=>c==null?void 0:c(),300)},u);return()=>clearTimeout(v)}},[o,u,c]);const E=()=>{b(!1),setTimeout(()=>c==null?void 0:c(),300)},k=()=>{w==null||w(),E()};return S?e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-md w-full transform transition-all duration-300 ${S?"translate-x-0 opacity-100":"translate-x-full opacity-0"}`,children:e.jsx("div",{className:`rounded-lg border p-4 shadow-lg ${V.container}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${V.icon}`,children:Qt(r)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:l}),e.jsx("button",{onClick:E,className:`flex-shrink-0 ml-2 p-1 rounded-md hover:bg-opacity-20 transition-colors ${V.closeButton}`,children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"mt-1 text-sm",children:t}),n&&e.jsxs("div",{className:"mt-2",children:[e.jsx("button",{onClick:()=>_(!I),className:"text-xs underline hover:no-underline",children:I?"Сховати деталі":"Показати деталі"}),I&&e.jsx("div",{className:"mt-2 p-2 bg-black bg-opacity-10 rounded text-xs font-mono overflow-auto max-h-32",children:n})]}),e.jsx("div",{className:"mt-3 flex space-x-2",children:L&&w&&e.jsx("button",{onClick:k,className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${V.retryButton}`,children:"Спробувати знову"})})]})]})})}):null},os=()=>{const[r,l]=s.useState([]),t=o=>{const u=Math.random().toString(36).substr(2,9),L={...o,id:u,onClose:()=>n(u)};l(w=>[...w,L])},n=o=>{l(u=>u.filter(L=>L.id!==o))};return{notifications:r,addNotification:t,removeNotification:n,clearAll:()=>{l([])}}};function Kt(){return new URLSearchParams(Te().search)}function Yt(){var K,ie,ne,oe,je,R,q;const[r,l]=s.useState([]),[t,n]=s.useState(null),[c,o]=s.useState([]),[u,L]=s.useState(null),[w,S]=s.useState(null),[b,I]=s.useState(""),[_,V]=s.useState(!1),[E,k]=s.useState(!0),[v,T]=s.useState(!1),$=s.useRef(null),J=Kt(),m=Te();Re();const{notifications:M,addNotification:D,removeNotification:Z}=os();s.useEffect(()=>{$.current&&$.current.scrollIntoView({behavior:"smooth"})},[c]),s.useEffect(()=>{x()},[m.key]),s.useEffect(()=>{u&&w&&z()},[u,w]),s.useEffect(()=>{const C=J.get("user");C&&u&&w&&P(C)},[u,w]);async function x(){try{const C=await Le.getCurrentUserProfile();if(!C){D({type:"error",title:"Помилка авторизації",message:"Не вдалося завантажити профіль користувача"});return}L(C);const{data:{user:A},error:W}=await f.auth.getUser();if(W||!A){D({type:"error",title:"Помилка авторизації",message:"Не вдалося отримати дані авторизації"});return}S(A)}catch(C){console.error("Error loading current user:",C),D({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити дані користувача",details:C instanceof Error?C.message:"Невідома помилка"})}}async function z(){try{if(!w){D({type:"error",title:"Помилка авторизації",message:"Не вдалося отримати дані користувача"});return}k(!0);const{data:C,error:A}=await f.from("conversations").select("*").or(`participant1_id.eq.${w.id},participant2_id.eq.${w.id}`).order("updated_at",{ascending:!1});if(A)throw A;const W=(C||[]).map(se=>se.participant1_id===w.id?se.participant2_id:se.participant1_id),{data:ce,error:he}=await f.from("user_profiles").select("id, name, last_name, avatar, auth_user_id").in("auth_user_id",W);if(he)throw he;const ue=(ce||[]).reduce((se,ge)=>(se[ge.auth_user_id]=ge,se),{}),xe=(C||[]).map(se=>{const ge=se.participant1_id===w.id?se.participant2_id:se.participant1_id,re=ue[ge];return{id:se.id,participant:re,updated_at:se.updated_at}});l(xe)}catch(C){console.error("Error loading conversations:",C),D({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити розмови",details:C instanceof Error?C.message:"Невідома помилка",showRetry:!0,onRetry:z}),l([])}finally{k(!1)}}async function P(C){try{if(!w){D({type:"error",title:"Помилка авторизації",message:"Не вдалося отримати дані користувача"});return}let A=r.find(W=>W.participant&&W.participant.auth_user_id===C);if(!A){const{data:W,error:ce}=await f.from("conversations").insert([{participant1_id:w.id,participant2_id:C}]).select("*").single();if(ce)throw ce;const{data:he}=await f.from("user_profiles").select("id, name, last_name, avatar, auth_user_id").eq("auth_user_id",C).single();A={id:W.id,participant:he,updated_at:W.updated_at},l(ue=>[A,...ue])}n(A),ee(A.id)}catch(A){console.error("Error creating conversation:",A),D({type:"error",title:"Помилка",message:"Не вдалося створити розмову",details:A instanceof Error?A.message:"Невідома помилка"})}}const ee=async C=>{try{T(!0);const{data:A,error:W}=await f.from("messages").select("*").eq("conversation_id",C).order("created_at",{ascending:!0});if(W)throw W;o(A||[])}catch(A){console.error("Error loading messages:",A),D({type:"error",title:"Помилка",message:"Не вдалося завантажити повідомлення",details:A instanceof Error?A.message:"Невідома помилка"})}finally{T(!1)}},X=async()=>{if(!(!b.trim()||!t||!w))try{V(!0);const{error:C}=await f.from("messages").insert([{conversation_id:t.id,sender_id:w.id,content:b.trim()}]);if(C)throw C;I(""),ee(t.id)}catch(C){console.error("Error sending message:",C),D({type:"error",title:"Помилка",message:"Не вдалося надіслати повідомлення",details:C instanceof Error?C.message:"Невідома помилка"})}finally{V(!1)}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsxs("div",{className:"flex-1 ml-64 flex",children:[M.map(C=>e.jsx(ns,{...C,onClose:()=>Z(C.id)},C.id)),e.jsxs("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Повідомлення"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:E?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Завантаження..."})]}):r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Se,{className:"w-12 h-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Немає розмов"}),e.jsx("p",{className:"text-gray-500",children:"Почніть розмову з друзями"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:r.map(C=>{var A,W,ce,he,ue,xe,se;return e.jsx("div",{onClick:()=>{n(C),ee(C.id)},className:`p-4 cursor-pointer hover:bg-gray-50 transition-colors ${(t==null?void 0:t.id)===C.id?"bg-blue-50 border-r-2 border-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:(A=C.participant)!=null&&A.avatar?e.jsx("img",{src:C.participant.avatar,alt:C.participant.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{className:"text-gray-600 font-semibold",children:[(ce=(W=C.participant)==null?void 0:W.name)==null?void 0:ce[0],(ue=(he=C.participant)==null?void 0:he.last_name)==null?void 0:ue[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 truncate",children:[(xe=C.participant)==null?void 0:xe.name," ",(se=C.participant)==null?void 0:se.last_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:C.updated_at?new Date(C.updated_at).toLocaleDateString("uk-UA"):""})]})]})},C.id)})})})]}),e.jsx("div",{className:"flex-1 flex flex-col bg-white",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:(K=t.participant)!=null&&K.avatar?e.jsx("img",{src:t.participant.avatar,alt:t.participant.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{className:"text-gray-600 font-semibold",children:[(ne=(ie=t.participant)==null?void 0:ie.name)==null?void 0:ne[0],(je=(oe=t.participant)==null?void 0:oe.last_name)==null?void 0:je[0]]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[(R=t.participant)==null?void 0:R.name," ",(q=t.participant)==null?void 0:q.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Онлайн"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:v?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Завантаження повідомлень..."})]}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Se,{className:"w-12 h-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Немає повідомлень"}),e.jsx("p",{className:"text-gray-500",children:"Почніть розмову першим повідомленням"})]}):c.map(C=>e.jsx("div",{className:`flex ${C.sender_id===(w==null?void 0:w.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${C.sender_id===(w==null?void 0:w.id)?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:C.content}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:new Date(C.created_at).toLocaleTimeString("uk-UA",{hour:"2-digit",minute:"2-digit"})})]})},C.id))}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:b,onChange:C=>I(C.target.value),onKeyPress:C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),X())},placeholder:"Напишіть повідомлення...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:_}),e.jsx("button",{type:"submit",onClick:X,disabled:_||!b.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(We,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Se,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Виберіть розмову"}),e.jsx("p",{className:"text-gray-500",children:"Оберіть чат зі списку зліва, щоб почати спілкування"})]})})})]})]})}function er(){const[r,l]=s.useState([]),[t,n]=s.useState([]),[c,o]=s.useState(""),[u,L]=s.useState([]),[w,S]=s.useState(!0),[b,I]=s.useState(null),_=Te(),V=Re(),{notifications:E,addNotification:k,removeNotification:v}=os();s.useEffect(()=>{T()},[_.key]),s.useEffect(()=>{b&&($(),J())},[b]);async function T(){try{const{data:{user:x},error:z}=await f.auth.getUser();if(z||!x){k({type:"error",title:"Помилка авторизації",message:"Не вдалося отримати дані користувача"});return}I(x)}catch(x){console.error("Error loading auth user:",x),k({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити дані користувача",details:x instanceof Error?x.message:"Невідома помилка"})}}const $=async()=>{try{if(!b){k({type:"warning",title:"Не авторизовано",message:"Для перегляду друзів потрібно авторизуватися"});return}const{data:x,error:z}=await f.from("friendships").select("*").or(`user1_id.eq.${b.id},user2_id.eq.${b.id}`);if(z)throw z;const P=(x||[]).map(K=>K.user1_id===b.id?K.user2_id:K.user1_id),{data:ee,error:X}=await f.from("user_profiles").select("id, name, last_name, avatar, auth_user_id").in("auth_user_id",P);if(X)throw X;l(ee||[])}catch(x){console.error("Error fetching friends:",x),k({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити список друзів",details:x instanceof Error?x.message:"Невідома помилка",showRetry:!0,onRetry:$}),l([])}finally{S(!1)}},J=async()=>{try{if(!b){n([]);return}const{data:x,error:z}=await f.from("friend_requests").select("*").eq("receiver_id",b.id).eq("status","pending");if(z)throw z;const P=(x||[]).map(ee=>ee.sender_id);if(P.length>0){const{data:ee,error:X}=await f.from("user_profiles").select("id, name, last_name, avatar, auth_user_id").in("auth_user_id",P);if(X)throw X;const K=(x||[]).map(ie=>{const ne=ee.find(oe=>oe.auth_user_id===ie.sender_id);return{...ie,sender:ne}});n(K)}else n([])}catch(x){console.error("Error fetching requests:",x),k({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити запити на дружбу",details:x instanceof Error?x.message:"Невідома помилка"}),n([])}},m=async x=>{try{const{error:z}=await f.from("friend_requests").update({status:"accepted"}).eq("id",x);if(z)throw z;k({type:"success",title:"Успішно!",message:"Запит на дружбу прийнято!",autoClose:!0,duration:3e3}),$(),J()}catch(z){console.error("Error accepting request:",z),k({type:"error",title:"Помилка",message:"Не вдалося прийняти запит на дружбу",details:z instanceof Error?z.message:"Невідома помилка",showRetry:!0,onRetry:()=>m(x)})}},M=async x=>{try{const{error:z}=await f.from("friend_requests").update({status:"rejected"}).eq("id",x);if(z)throw z;k({type:"success",title:"Успішно!",message:"Запит на дружбу відхилено!",autoClose:!0,duration:3e3}),J()}catch(z){console.error("Error rejecting request:",z),k({type:"error",title:"Помилка",message:"Не вдалося відхилити запит на дружбу",details:z instanceof Error?z.message:"Невідома помилка",showRetry:!0,onRetry:()=>M(x)})}},D=async x=>{if(o(x),x.length<2){L([]);return}try{const{data:z,error:P}=await f.from("user_profiles").select("id, name, last_name, avatar, auth_user_id").or(`name.ilike.%${x}%,last_name.ilike.%${x}%`).limit(10);if(P)throw P;L(z||[])}catch(z){console.error("Error searching users:",z),k({type:"error",title:"Помилка пошуку",message:"Не вдалося виконати пошук користувачів",details:z instanceof Error?z.message:"Невідома помилка"})}},Z=async x=>{try{if(!b){k({type:"warning",title:"Не авторизовано",message:"Для додавання в друзі потрібно авторизуватися"});return}const{error:z}=await f.from("friend_requests").insert([{sender_id:b.id,receiver_id:x,status:"pending"}]);if(z)throw z;k({type:"success",title:"Успішно!",message:"Запит на дружбу надіслано!",autoClose:!0,duration:3e3}),await $()}catch(z){console.error("Error adding friend:",z),k({type:"error",title:"Помилка",message:"Не вдалося надіслати запит на дружбу",details:z instanceof Error?z.message:"Невідома помилка",showRetry:!0,onRetry:()=>Z(x)})}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsxs("div",{className:"flex-1 ml-64 p-8",children:[E.map(x=>e.jsx(ns,{...x,onClose:()=>v(x.id)},x.id)),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Друзі"}),e.jsx("p",{className:"text-gray-600",children:"Керуйте своїми друзями та запитами на дружбу"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Знайти користувачів"}),e.jsx("div",{className:"flex space-x-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Пошук за ім'ям або прізвищем...",value:c,onChange:x=>D(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),u.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Результати пошуку:"}),e.jsx("div",{className:"space-y-2",children:u.map(x=>{var z,P;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:x.avatar?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{className:"text-gray-600 font-semibold",children:[(z=x.name)==null?void 0:z[0],(P=x.last_name)==null?void 0:P[0]]})}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium text-gray-900",children:[x.name," ",x.last_name]})})]}),e.jsxs("button",{onClick:()=>Z(x.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2 inline"}),"Додати"]})]},x.id)})})]})]}),t.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Запити на дружбу"}),e.jsx("div",{className:"space-y-4",children:t.map(x=>{var z,P,ee,X,K,ie,ne;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:(z=x.sender)!=null&&z.avatar?e.jsx("img",{src:x.sender.avatar,alt:x.sender.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{className:"text-gray-600 font-semibold",children:[(ee=(P=x.sender)==null?void 0:P.name)==null?void 0:ee[0],(K=(X=x.sender)==null?void 0:X.last_name)==null?void 0:K[0]]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[(ie=x.sender)==null?void 0:ie.name," ",(ne=x.sender)==null?void 0:ne.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Надіслав запит на дружбу"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(x.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Прийняти"}),e.jsx("button",{onClick:()=>M(x.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Відхилити"})]})]},x.id)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Мої друзі (",r.length,")"]}),w?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Завантаження..."})]}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"У вас поки немає друзів"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Знайдіть друзів через пошук вище"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(x=>{var z,P;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:x.avatar?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full rounded-full object-cover"}):e.jsxs("span",{className:"text-gray-600 font-semibold",children:[(z=x.name)==null?void 0:z[0],(P=x.last_name)==null?void 0:P[0]]})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>V(`/profile/${x.auth_user_id}`),children:e.jsxs("p",{className:"font-medium text-gray-900 truncate",children:[x.name," ",x.last_name]})})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>V(`/messages?user=${x.auth_user_id}`),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Повідомлення"]}),e.jsx("button",{onClick:()=>V(`/profile/${x.auth_user_id}`),className:"flex items-center justify-center px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",title:"Переглянути профіль",children:e.jsx(Ve,{className:"w-4 h-4"})})]})]},x.id)})})]})]})]})]})}function sr(){var $,J;const[r,l]=s.useState("profile"),[t,n]=s.useState(!0),c=Re(),[o,u]=s.useState({name:"",last_name:"",email:"",avatar:"",bio:"",city:"",birth_date:"",birthday:"",notifications:{email:!0,messages:!0,friendRequests:!0},privacy:{profileVisibility:"public",showBirthDate:!0,showEmail:!1},education:"",work:"",relationshipStatus:"",phone:"",hobbies:[],languages:[],website:""}),[L,w]=s.useState(!1),S=s.useRef(null),[b,I]=s.useState(""),[_,V]=s.useState("");s.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:{user:m},error:M}=await f.auth.getUser();if(M||!m){c("/login");return}const D=await Ft(m.id);if(!D)return;u({name:D.name||"",last_name:D.last_name||"",email:D.email||"",avatar:D.avatar||"",bio:D.bio||"",city:D.city||"",birth_date:D.birth_date||"",birthday:D.birthday||"",notifications:D.notifications||{email:!0,messages:!0,friendRequests:!0},privacy:D.privacy||{profileVisibility:"public",showBirthDate:!0,showEmail:!1},education:D.education||"",work:D.work||"",relationshipStatus:D.relationshipStatus||"",phone:D.phone||"",hobbies:D.hobbies||[],languages:D.languages||[],website:D.website||""})}catch(m){console.error("Error loading user settings:",m)}finally{n(!1)}},k=async m=>{m.preventDefault();try{const M={...o};M.birth_date||(M.birth_date=null),M.birthday||(M.birthday=null),M.hobbies||(M.hobbies=[]),M.languages||(M.languages=[]);const{data:{user:D},error:Z}=await f.auth.getUser();if(Z||!D){c("/login");return}const{data:x,error:z}=await Hs({auth_user_id:D.id,...M});if(z)throw z;alert("Налаштування збережено успішно")}catch(M){alert("Помилка при збереженні налаштувань: "+(M.message||M.details||""))}},v=async m=>{w(!0);try{const{data:{user:M}}=await f.auth.getUser();if(!M)throw new Error("Не авторизовано");const D=m.name.split(".").pop(),Z=`${M.id}_${Date.now()}.${D}`,{error:x}=await f.storage.from("avatar").upload(Z,m,{upsert:!0,contentType:m.type});if(x)throw x;const{data:z}=f.storage.from("avatar").getPublicUrl(Z);return z.publicUrl}catch{return alert("Помилка при завантаженні аватара"),null}finally{w(!1)}},T=[{id:"profile",label:"Профіль",icon:Ve},{id:"privacy",label:"Приватність",icon:qe},{id:"notifications",label:"Сповіщення",icon:xt}];return t?e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"text-center",children:"Завантаження..."})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Налаштування"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"flex border-b border-gray-200",children:T.map(({id:m,label:M,icon:D})=>e.jsxs("button",{onClick:()=>l(m),className:`flex items-center px-6 py-3 text-sm font-medium ${r===m?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(D,{size:18,className:"mr-2"}),M]},m))}),e.jsxs("div",{className:"p-6",children:[r==="profile"&&e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Ім'я *"}),e.jsx("input",{type:"text",value:o.name,onChange:m=>u({...o,name:m.target.value}),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Прізвище *"}),e.jsx("input",{type:"text",value:o.last_name,onChange:m=>u({...o,last_name:m.target.value}),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email *"}),e.jsx("input",{type:"email",value:o.email,onChange:m=>u({...o,email:m.target.value}),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Аватар"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[o.avatar&&e.jsx("img",{src:o.avatar,alt:"avatar",className:"w-16 h-16 rounded-full object-cover border"}),e.jsx("input",{type:"file",accept:"image/*",ref:S,style:{display:"none"},onChange:async m=>{var D;const M=(D=m.target.files)==null?void 0:D[0];if(M){const Z=await v(M);Z&&u(x=>({...x,avatar:Z}))}}}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>{var m;return(m=S.current)==null?void 0:m.click()},disabled:L,children:L?"Завантаження...":"Завантажити аватар"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Про себе"}),e.jsx("textarea",{value:o.bio||"",onChange:m=>u({...o,bio:m.target.value}),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Місто"}),e.jsx("input",{type:"text",value:o.city||"",onChange:m=>u({...o,city:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"День народження"}),e.jsx("input",{type:"date",value:o.birth_date||"",onChange:m=>u({...o,birth_date:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Освіта"}),e.jsx("input",{type:"text",value:o.education||"",onChange:m=>u({...o,education:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Робота"}),e.jsx("input",{type:"text",value:o.work||"",onChange:m=>u({...o,work:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Телефон"}),e.jsx("input",{type:"text",value:o.phone||"",onChange:m=>u({...o,phone:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Веб-сайт"}),e.jsx("input",{type:"text",value:o.website||"",onChange:m=>u({...o,website:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Хобі"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:($=o.hobbies)==null?void 0:$.map((m,M)=>e.jsxs("span",{className:"bg-blue-100 px-2 py-1 rounded-full flex items-center",children:[m,e.jsx("button",{type:"button",onClick:()=>u(D=>{var Z;return{...D,hobbies:(Z=D.hobbies)==null?void 0:Z.filter((x,z)=>z!==M)}}),className:"ml-1 text-red-500",children:"×"})]},M))}),e.jsx("input",{type:"text",value:b,onChange:m=>I(m.target.value),onKeyDown:m=>{m.key==="Enter"&&b.trim()&&(u(M=>({...M,hobbies:[...M.hobbies||[],b.trim()]})),I(""))},placeholder:"Додати хобі і натиснути Enter",className:"block w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Мови"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(J=o.languages)==null?void 0:J.map((m,M)=>e.jsxs("span",{className:"bg-green-100 px-2 py-1 rounded-full flex items-center",children:[m,e.jsx("button",{type:"button",onClick:()=>u(D=>{var Z;return{...D,languages:(Z=D.languages)==null?void 0:Z.filter((x,z)=>z!==M)}}),className:"ml-1 text-red-500",children:"×"})]},M))}),e.jsx("input",{type:"text",value:_,onChange:m=>V(m.target.value),onKeyDown:m=>{m.key==="Enter"&&_.trim()&&(u(M=>({...M,languages:[...M.languages||[],_.trim()]})),V(""))},placeholder:"Додати мову і натиснути Enter",className:"block w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Сімейний стан"}),e.jsx("input",{type:"text",value:o.relationshipStatus||"",onChange:m=>u({...o,relationshipStatus:m.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsx("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Зберегти"})]}),r==="privacy"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Видимість профілю"}),e.jsxs("div",{className:"flex space-x-4 mt-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"profileVisibility",value:"public",checked:o.privacy.profileVisibility==="public",onChange:()=>u({...o,privacy:{...o.privacy,profileVisibility:"public"}}),className:"form-radio h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Публічно"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"profileVisibility",value:"friends",checked:o.privacy.profileVisibility==="friends",onChange:()=>u({...o,privacy:{...o.privacy,profileVisibility:"friends"}}),className:"form-radio h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Тільки друзі"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"profileVisibility",value:"private",checked:o.privacy.profileVisibility==="private",onChange:()=>u({...o,privacy:{...o.privacy,profileVisibility:"private"}}),className:"form-radio h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Приватно"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.privacy.showEmail,onChange:m=>u({...o,privacy:{...o.privacy,showEmail:m.target.checked}}),className:"form-checkbox h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Показувати email"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.privacy.showBirthDate,onChange:m=>u({...o,privacy:{...o.privacy,showBirthDate:m.target.checked}}),className:"form-checkbox h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Показувати дату народження"})]})]})]}),r==="notifications"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.notifications.email,onChange:m=>u({...o,notifications:{...o.notifications,email:m.target.checked}}),className:"form-checkbox h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Email"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.notifications.messages,onChange:m=>u({...o,notifications:{...o.notifications,messages:m.target.checked}}),className:"form-checkbox h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Повідомлення"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.notifications.friendRequests,onChange:m=>u({...o,notifications:{...o.notifications,friendRequests:m.target.checked}}),className:"form-checkbox h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Запити в друзі"})]})]})})]})]})]})})]})}function tr({isOpen:r,onClose:l,onUpload:t,groupId:n}){var p,O;const[c,o]=s.useState("upload"),[u,L]=s.useState(null),[w,S]=s.useState(""),[b,I]=s.useState(0),[_,V]=s.useState(0),[E,k]=s.useState(!1),[v,T]=s.useState(!1),[$,J]=s.useState(0),[m,M]=s.useState(0),[D,Z]=s.useState([]),[x,z]=s.useState(!1),[P,ee]=s.useState(!1),[X,K]=s.useState(0),[ie,ne]=s.useState(0),[oe,je]=s.useState(""),[R,q]=s.useState(""),[C,A]=s.useState(""),[W,ce]=s.useState("full"),[he,ue]=s.useState(!1),xe=s.useRef(null),se=s.useRef(null),ge=s.useRef(null);s.useEffect(()=>{r||re()},[r]),s.useEffect(()=>{if(b>0){M(b),ne(Math.max(0,b-30));const a=[{type:"intro",start:0,end:Math.min(15,b*.1),skip:!1},{type:"content",start:Math.min(15,b*.1),end:Math.max(b-30,b*.9),skip:!1},{type:"outro",start:Math.max(b-30,b*.9),end:b,skip:!1}];Z(a),K(a[0].end),ne(a[2].start)}},[b]);const re=()=>{o("upload"),L(null),S(""),I(0),V(0),k(!1),J(0),M(0),z(!1),ee(!1),K(0),ne(0),je(""),q(""),A(""),Z([]),ce("full")},fe=a=>{var Y;const g=(Y=a.target.files)==null?void 0:Y[0];if(g&&g.type.startsWith("video/")){L(g);const ae=URL.createObjectURL(g);S(ae),je(g.name.replace(/\.[^/.]+$/,"")),o("trim")}},Ee=()=>{const a=xe.current;a&&(I(a.duration),M(a.duration))},ve=()=>{const a=xe.current;a&&(V(a.currentTime),W==="final"&&(x&&a.currentTime>=$&&a.currentTime<X&&(a.currentTime=X),P&&a.currentTime>=ie&&(a.currentTime=m,a.pause(),k(!1))))},N=()=>{const a=xe.current;a&&(E?a.pause():a.play(),k(!E))},H=a=>{const g=xe.current;g&&(g.currentTime=a,V(a))},d=a=>{const g=D.find(Y=>Y.type===a);g&&H(g.start)},y=(a,g)=>{a==="intro"&&g==="end"?(K(_),Z(Y=>Y.map(ae=>ae.type==="intro"?{...ae,end:_}:ae.type==="content"?{...ae,start:_}:ae))):a==="outro"&&g==="start"&&(ne(_),Z(Y=>Y.map(ae=>ae.type==="content"?{...ae,end:_}:ae.type==="outro"?{...ae,start:_}:ae)))},G=async()=>{const a=xe.current,g=ge.current;if(a&&g){ue(!0);const Y=D.find(Ne=>Ne.type==="content"),ae=Y?(Y.start+Y.end)/2:b/2;a.currentTime=ae,setTimeout(()=>{const Ne=g.getContext("2d");if(Ne){g.width=a.videoWidth,g.height=a.videoHeight,Ne.drawImage(a,0,0);const Pe=g.toDataURL("image/jpeg",.8);A(Pe)}ue(!1)},100)}},F=a=>{const g=Math.floor(a/60),Y=Math.floor(a%60);return`${g}:${Y.toString().padStart(2,"0")}`},de=()=>{let a=m-$;return x&&(a-=X-$),P&&(a-=m-ie),Math.max(0,a)},me=()=>{u&&(t({file:u,title:oe,description:R,thumbnail:C,startTime:$,endTime:m,skipIntro:x,skipOutro:P,introEnd:X,outroStart:ie}),l())};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ht,{className:"text-blue-600",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[c==="upload"&&"Завантажити відео",c==="trim"&&"Обрізати та налаштувати",c==="details"&&"Деталі відео",c==="preview"&&"Попередній перегляд"]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(we,{size:24})})]}),e.jsxs("div",{className:"flex h-[70vh]",children:[c!=="upload"&&e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:xe,src:w,className:"max-h-full max-w-full object-contain",onLoadedMetadata:Ee,onTimeUpdate:ve,muted:v}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsxs("div",{className:"bg-black/70 rounded-lg p-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"w-full h-2 bg-gray-600 rounded-full",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-100",style:{width:`${_/b*100}%`}})}),D.map((a,g)=>e.jsxs("div",{className:"absolute top-0 h-2 flex",children:[e.jsx("div",{className:`h-full ${a.type==="intro"?"bg-yellow-500/50":a.type==="outro"?"bg-red-500/50":"bg-green-500/50"}`,style:{left:`${a.start/b*100}%`,width:`${(a.end-a.start)/b*100}%`}}),a.skip&&e.jsx("div",{className:"absolute top-0 h-full bg-gray-800/80 flex items-center justify-center",style:{left:`${a.start/b*100}%`,width:`${(a.end-a.start)/b*100}%`},children:e.jsx(we,{size:12,className:"text-white"})})]},g)),e.jsx("div",{className:"absolute top-0 w-1 h-2 bg-blue-400",style:{left:`${$/b*100}%`}}),e.jsx("div",{className:"absolute top-0 w-1 h-2 bg-blue-400",style:{left:`${m/b*100}%`}})]}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:N,className:"p-2 bg-blue-600 rounded-full hover:bg-blue-700 transition-colors",children:E?e.jsx(gt,{size:20}):e.jsx(Oe,{size:20})}),e.jsx("button",{onClick:()=>T(!v),className:"p-2 bg-gray-600 rounded-full hover:bg-gray-700 transition-colors",children:v?e.jsx(As,{size:20}):e.jsx(qs,{size:20})}),e.jsxs("span",{className:"text-sm",children:[F(_)," / ",F(b)]})]}),c==="trim"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>d("intro"),className:"px-3 py-1 bg-yellow-600 rounded text-sm hover:bg-yellow-700 transition-colors",children:"Інтро"}),e.jsx("button",{onClick:()=>d("content"),className:"px-3 py-1 bg-green-600 rounded text-sm hover:bg-green-700 transition-colors",children:"Контент"}),e.jsx("button",{onClick:()=>d("outro"),className:"px-3 py-1 bg-red-600 rounded text-sm hover:bg-red-700 transition-colors",children:"Аутро"})]}),c==="preview"&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{value:W,onChange:a=>ce(a.target.value),className:"bg-gray-700 text-white rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"full",children:"Повне відео"}),e.jsx("option",{value:"trimmed",children:"Обрізане"}),e.jsx("option",{value:"final",children:"Фінальна версія"})]})})]})]})})]})}),e.jsxs("div",{className:"w-96 bg-gray-50 p-6 overflow-y-auto",children:[c==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-gray-400 transition-colors",onClick:()=>{var a;return(a=se.current)==null?void 0:a.click()},children:[e.jsx(He,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Завантажити відео"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Перетягніть відео сюди або натисніть для вибору"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Підтримувані формати: MP4, MOV, AVI, WebM",e.jsx("br",{}),"Максимальний розмір: 500MB"]})]}),e.jsx("input",{ref:se,type:"file",accept:"video/*",onChange:fe,className:"hidden"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ps,{className:"text-blue-600 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Розумне обрізання"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Ми автоматично виявимо інтро та аутро у вашому відео та дозволимо їх пропустити для кращого досвіду перегляду."})]})]})})]}),c==="trim"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Обрізати відео"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Початок: ",F($)]}),e.jsx("input",{type:"range",min:0,max:b,step:.1,value:$,onChange:a=>J(Number(a.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Кінець: ",F(m)]}),e.jsx("input",{type:"range",min:0,max:b,step:.1,value:m,onChange:a=>M(Number(a.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"bg-gray-100 rounded p-3 text-sm",children:[e.jsx("strong",{children:"Тривалість після обрізання:"})," ",F(m-$)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Налаштування пропуску"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:a=>z(a.target.checked),className:"rounded"}),e.jsx("span",{className:"font-medium text-yellow-900",children:"Пропустити інтро"})]}),e.jsxs("span",{className:"text-yellow-700 text-sm",children:[F(((p=D.find(a=>a.type==="intro"))==null?void 0:p.start)||0)," - ",F(X)]})]}),x&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>y("intro","end"),className:"flex items-center space-x-1 text-yellow-700 text-sm hover:text-yellow-800",children:[e.jsx(_s,{size:14}),e.jsxs("span",{children:["Встановити кінець інтро тут (",F(_),")"]})]})})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:a=>ee(a.target.checked),className:"rounded"}),e.jsx("span",{className:"font-medium text-red-900",children:"Пропустити аутро"})]}),e.jsxs("span",{className:"text-red-700 text-sm",children:[F(ie)," - ",F(((O=D.find(a=>a.type==="outro"))==null?void 0:O.end)||b)]})]}),P&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>y("outro","start"),className:"flex items-center space-x-1 text-red-700 text-sm hover:text-red-800",children:[e.jsx(_s,{size:14}),e.jsxs("span",{children:["Встановити початок аутро тут (",F(_),")"]})]})})]})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ft,{className:"text-green-600 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900 mb-1",children:"Ефективна тривалість"}),e.jsxs("p",{className:"text-green-700",children:[F(de())," (заощаджено ",F(m-$-de()),")"]})]})]})})]}),c==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Назва відео *"}),e.jsx("input",{type:"text",value:oe,onChange:a=>je(a.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введіть назву відео",maxLength:100}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:[oe.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Опис"}),e.jsx("textarea",{value:R,onChange:a=>q(a.target.value),rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Опишіть ваше відео",maxLength:500}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:[R.length,"/500"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Мініатюра"}),e.jsxs("div",{className:"space-y-3",children:[C?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:C,alt:"Thumbnail",className:"w-full h-32 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>A(""),className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700",children:e.jsx(we,{size:16})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(bt,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Мініатюра буде згенерована автоматично"})]}),e.jsx("button",{onClick:G,disabled:he,className:"w-full flex items-center justify-center space-x-2 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:he?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Генерація..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($s,{size:16}),e.jsx("span",{children:"Згенерувати мініатюру"})]})})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Налаштування відео"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Оригінальна тривалість:"}),e.jsx("span",{children:F(b)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Обрізана тривалість:"}),e.jsx("span",{children:F(m-$)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ефективна тривалість:"}),e.jsx("span",{className:"font-semibold",children:F(de())})]}),x&&e.jsxs("div",{className:"flex justify-between text-yellow-700",children:[e.jsx("span",{children:"• Пропуск інтро:"}),e.jsx("span",{children:F(X-$)})]}),P&&e.jsxs("div",{className:"flex justify-between text-red-700",children:[e.jsx("span",{children:"• Пропуск аутро:"}),e.jsx("span",{children:F(m-ie)})]})]})]})]}),c==="preview"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Попередній перегляд"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:oe}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:R}),C&&e.jsx("img",{src:C,alt:"Thumbnail",className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Тривалість:"}),e.jsx("div",{className:"font-semibold",children:F(de())})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Розмір файлу:"}),e.jsx("div",{className:"font-semibold",children:u?`${(u.size/1024/1024).toFixed(1)} MB`:"N/A"})]})]})]}),(x||P)&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ds,{className:"text-green-600 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900 mb-1",children:"Покращений досвід перегляду"}),e.jsxs("ul",{className:"text-green-700 text-sm space-y-1",children:[x&&e.jsx("li",{children:"• Інтро буде автоматично пропущено"}),P&&e.jsx("li",{children:"• Аутро буде автоматично пропущено"}),e.jsx("li",{children:"• Глядачі зможуть дивитися основний контент одразу"})]})]})]})})]})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center space-x-2",children:c!=="upload"&&e.jsx("button",{onClick:()=>{c==="trim"?o("upload"):c==="details"?o("trim"):c==="preview"&&o("details")},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Назад"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[c==="trim"&&e.jsx("button",{onClick:()=>o("details"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Далі"}),c==="details"&&e.jsx("button",{onClick:()=>o("preview"),disabled:!oe.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Переглянути"}),c==="preview"&&e.jsxs("button",{onClick:me,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(He,{size:16}),e.jsx("span",{children:"Завантажити відео"})]})]})]}),e.jsx("canvas",{ref:ge,className:"hidden"})]})}):null}const rr=r=>{switch(r){case"sm":return"w-4 h-4";case"md":return"w-6 h-6";case"lg":return"w-8 h-8";case"xl":return"w-12 h-12";default:return"w-6 h-6"}},ar=r=>{switch(r){case"blue":return"border-blue-600";case"green":return"border-green-600";case"red":return"border-red-600";case"yellow":return"border-yellow-600";case"purple":return"border-purple-600";case"gray":return"border-gray-600";default:return"border-blue-600"}},lr=({size:r="md",color:l="blue",text:t,fullScreen:n=!1})=>{const c=rr(r),o=ar(l),u=e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:`${c} ${o} border-2 border-t-transparent rounded-full animate-spin`}),t&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 animate-pulse",children:t})]});return n?e.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50",children:u}):u},Us=["Технології","Мистецтво","Спорт","Музика","Освіта","Бізнес","Подорожі","Їжа","Фотографія","Ігри","Книги","Фільми","Наука","Природа","Мода","Здоров'я","Інше"];function ir(){const[r,l]=s.useState([]),[t,n]=s.useState([]),[c,o]=s.useState([]),[u,L]=s.useState([]),[w,S]=s.useState([]),[b,I]=s.useState([]),[_,V]=s.useState([]),[E,k]=s.useState(""),[v,T]=s.useState("explore"),[$,J]=s.useState(!0),[m,M]=s.useState(null),[D,Z]=s.useState(!1),[x,z]=s.useState(!1),[P,ee]=s.useState(""),[X,K]=s.useState(!1),[ie,ne]=s.useState(!1),[oe,je]=s.useState("grid"),{notifications:R,addNotification:q,removeNotification:C}=os(),[A,W]=s.useState({category:"",member_count:"all",privacy:"all",activity:"all",sortBy:"activity",sortOrder:"desc",hasAvatar:!1,is_verified:!1}),[ce,he]=s.useState(new Set),[ue,xe]=s.useState(!1),se=Re(),ge=Te(),[re,fe]=s.useState({name:"",description:"",category:"",is_private:!1,avatar:null,cover:null,tags:[],location:"",website:"",rules:[""],contactEmail:""});s.useEffect(()=>{Ee()},[ge.key]),s.useEffect(()=>{m&&ve()},[m]),s.useEffect(()=>{me()},[E,r,t,c,u,w,A,v]);const Ee=async()=>{try{const{data:{user:i},error:j}=await f.auth.getUser();if(j||!i){se("/login");return}M(i.id)}catch(i){console.error("Error fetching current user:",i),se("/login")}},ve=async()=>{try{await Promise.all([N(),H(),d(),y(),G(),F()])}catch(i){console.error("Error fetching data:",i)}finally{J(!1)}},N=async()=>{try{const{data:{user:i}}=await f.auth.getUser();if(!i){q({type:"warning",title:"Не авторизовано",message:"Для перегляду груп потрібно авторизуватися",showRetry:!0,onRetry:()=>se("/login")}),l([]);return}const{data:j,error:Q}=await f.from("users").select("id").eq("auth_user_id",i.id).single();if(Q){q({type:"error",title:"Помилка отримання даних",message:"Не вдалося отримати дані користувача",details:Q.message,showRetry:!0,onRetry:N}),l([]);return}const{data:te,error:be}=await f.from("groups").select("*").eq("is_private",!1).order("created_at",{ascending:!1});if(be){q({type:"error",title:"Помилка завантаження груп",message:"Не вдалося завантажити групи",details:be.message,showRetry:!0,onRetry:N}),l([]);return}const Ce=await Promise.all((te||[]).map(async Ue=>{if(Ue.created_by){const{data:$e}=await f.from("users").select("id, name, lastName as last_name, avatar").eq("id",Ue.created_by).single();return{...Ue,creator:$e||{id:Ue.created_by,name:"Unknown",last_name:"User",avatar:""}}}return Ue}));l(Ce)}catch(i){console.error("Error fetching groups:",i),q({type:"error",title:"Помилка системи",message:"Виникла неочікувана помилка при завантаженні груп",details:i instanceof Error?i.message:"Невідома помилка",showRetry:!0,onRetry:N}),l([])}},H=async()=>{try{if(!m)return;const{data:i,error:j}=await f.from("users").select("id").eq("auth_user_id",m).single();if(j){q({type:"error",title:"Помилка отримання даних",message:"Не вдалося отримати дані користувача",details:j.message}),n([]);return}const{data:Q,error:te}=await f.from("groups").select("*").eq("created_by",i.id).order("created_at",{ascending:!1});if(te){q({type:"error",title:"Помилка завантаження груп",message:"Не вдалося завантажити ваші групи",details:te.message}),n([]);return}n(Q||[])}catch(i){console.error("Error fetching my groups:",i),q({type:"error",title:"Помилка системи",message:"Виникла неочікувана помилка при завантаженні ваших груп",details:i instanceof Error?i.message:"Невідома помилка"}),n([])}},d=async()=>{try{if(!m)return;const{data:i,error:j}=await f.from("group_members").select("group_id, role").eq("user_id",m).eq("role","member");if(j)throw j;if(i&&i.length>0){const Q=i.map(Ce=>Ce.group_id),{data:te,error:be}=await f.from("groups").select("*").in("id",Q);if(be)throw be;o(te||[])}else o([])}catch(i){console.error("Error fetching joined groups:",i),o([])}},y=async()=>{try{if(!m)return;const{data:i,error:j}=await f.from("group_members").select("group_id, role").eq("user_id",m).in("role",["admin","moderator"]);if(j)throw j;if(i&&i.length>0){const Q=i.map(Ce=>Ce.group_id),{data:te,error:be}=await f.from("groups").select("*").in("id",Q);if(be)throw be;L(te||[])}else L([])}catch(i){console.error("Error fetching managed groups:",i),L([])}},G=async()=>{try{if(!m)return;S([])}catch(i){console.error("Error fetching invitations:",i),S([])}},F=async()=>{try{const{data:i,error:j}=await f.from("group_members").select("*");if(j)throw j;V(i||[])}catch(i){console.error("Error fetching group members:",i),V([])}},de=()=>{switch(v){case"explore":return r;case"my-groups":return t;case"joined":return c;case"managed":return u;case"invitations":return w;default:return r}},me=()=>{let i=de();E.trim()!==""&&(i=i.filter(j=>{var Q,te,be;return j.name.toLowerCase().includes(E.toLowerCase())||j.description.toLowerCase().includes(E.toLowerCase())||((Q=j.category)==null?void 0:Q.toLowerCase().includes(E.toLowerCase()))||((te=j.tags)==null?void 0:te.some(Ce=>Ce.toLowerCase().includes(E.toLowerCase())))||((be=j.location)==null?void 0:be.toLowerCase().includes(E.toLowerCase()))})),A.category&&(i=i.filter(j=>j.category===A.category)),A.member_count!=="all"&&(i=i.filter(j=>{const Q=j.member_count||0;switch(A.member_count){case"small":return Q<50;case"medium":return Q>=50&&Q<200;case"large":return Q>=200;default:return!0}})),A.privacy!=="all"&&(i=i.filter(j=>A.privacy==="public"?!j.is_private:j.is_private)),A.activity!=="all"&&(i=i.filter(j=>A.activity==="active"?j.is_active:!j.is_active)),A.hasAvatar&&(i=i.filter(j=>j.avatar)),A.is_verified&&(i=i.filter(j=>j.is_verified)),i.sort((j,Q)=>{let te=0;switch(A.sortBy){case"name":te=j.name.localeCompare(Q.name);break;case"members":te=(j.member_count||0)-(Q.member_count||0);break;case"activity":j.is_active&&!Q.is_active?te=-1:!j.is_active&&Q.is_active?te=1:te=new Date(Q.last_activity||0).getTime()-new Date(j.last_activity||0).getTime();break;case"created":te=new Date(j.created_at).getTime()-new Date(Q.created_at).getTime();break;case"popularity":te=(j.member_count||0)+(j.post_count||0)-((Q.member_count||0)+(Q.post_count||0));break}return A.sortOrder==="asc"?te:-te}),I(i)},p=async()=>{if(re.name.trim()){K(!0);try{if(!m){q({type:"warning",title:"Не авторизовано",message:"Для створення групи потрібно авторизуватися",showRetry:!0,onRetry:()=>se("/login")}),K(!1);return}const{data:i,error:j}=await f.from("users").select("id").eq("auth_user_id",m).single();if(j){q({type:"error",title:"Помилка отримання даних",message:"Не вдалося отримати дані користувача",details:j.message}),K(!1);return}const Q={name:re.name.trim(),description:re.description.trim()||null,is_private:re.is_private,created_by:i.id,category:re.category||null,tags:re.tags.length>0?re.tags:null,location:re.location||null,website:re.website||null,contactEmail:re.contactEmail||null,rules:re.rules.filter(Ue=>Ue.trim()).length>0?re.rules.filter(Ue=>Ue.trim()):null},{data:te,error:be}=await f.from("groups").insert([Q]).select().single();if(be){q({type:"error",title:"Помилка створення групи",message:"Не вдалося створити групу",details:be.message,showRetry:!0,onRetry:p}),K(!1);return}const{error:Ce}=await f.from("group_members").insert([{group_id:te.id,user_id:i.id,role:"admin"}]);q(Ce?{type:"warning",title:"Часткова помилка",message:"Групу створено, але не вдалося додати вас як адміністратора",details:Ce.message}:{type:"success",title:"Успішно!",message:"Групу успішно створено!",autoClose:!0,duration:3e3}),Z(!1),Pe(),ve()}catch(i){console.error("Error creating group:",i),q({type:"error",title:"Помилка системи",message:"Виникла неочікувана помилка при створенні групи",details:i instanceof Error?i.message:"Невідома помилка",showRetry:!0,onRetry:p})}finally{K(!1)}}},O=async i=>{if(m)try{const{data:j,error:Q}=await f.from("users").select("id").eq("auth_user_id",m).single();if(Q){q({type:"error",title:"Помилка отримання даних",message:"Не вдалося отримати дані користувача",details:Q.message});return}if(_.find(Ce=>Ce.group_id===i&&Ce.user_id===j.id)){q({type:"warning",title:"Вже є членом",message:"Ви вже є членом цієї групи!",autoClose:!0,duration:3e3});return}const{error:be}=await f.from("group_members").insert([{group_id:i,user_id:j.id,role:"member"}]);if(be){q({type:"error",title:"Помилка приєднання",message:"Не вдалося приєднатися до групи",details:be.message,showRetry:!0,onRetry:()=>O(i)});return}q({type:"success",title:"Успішно!",message:"Ви успішно приєдналися до групи!",autoClose:!0,duration:3e3}),ve()}catch(j){console.error("Error joining group:",j),q({type:"error",title:"Помилка системи",message:"Виникла неочікувана помилка при приєднанні до групи",details:j instanceof Error?j.message:"Невідома помилка",showRetry:!0,onRetry:()=>O(i)})}},a=i=>null,g=i=>!1,Y=i=>{const j=new Set(ce);j.has(i)?j.delete(i):j.add(i),he(j),xe(j.size>0)},ae=()=>{he(new Set),xe(!1)},Ne=async()=>{for(const i of ce)await O(i);ae()},Pe=()=>{fe({name:"",description:"",category:"",is_private:!1,avatar:null,cover:null,tags:[],location:"",website:"",rules:[""],contactEmail:""})},ye=i=>{console.log("Video uploaded to group:",P,i),z(!1),ee("")},Fe=()=>{W({category:"",member_count:"all",privacy:"all",activity:"all",sortBy:"activity",sortOrder:"desc",hasAvatar:!1,is_verified:!1}),k("")},pe=()=>{let i=0;return A.category&&i++,A.member_count!=="all"&&i++,A.privacy!=="all"&&i++,A.activity!=="all"&&i++,(A.sortBy!=="activity"||A.sortOrder!=="desc")&&i++,A.hasAvatar&&i++,A.is_verified&&i++,i},Ie=i=>{if(!i)return"Немає активності";const j=Date.now()-new Date(i).getTime(),Q=Math.floor(j/(1e3*60*60)),te=Math.floor(j/(1e3*60*60*24));return Q<24?`${Q} год тому`:`${te} дн тому`},cs=()=>{fe(i=>({...i,rules:[...i.rules,""]}))},es=i=>{fe(j=>({...j,rules:j.rules.filter((Q,te)=>te!==i)}))},ds=(i,j)=>{fe(Q=>({...Q,rules:Q.rules.map((te,be)=>be===i?j:te)}))},us=i=>{var be,Ce,Ue;const j=a(i.id),Q=g(),te=ce.has(i.id);return oe==="list"?e.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all duration-200 ${te?"ring-2 ring-blue-500 bg-blue-50":""}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:te,onChange:()=>Y(i.id),className:"absolute top-0 left-0 w-4 h-4 rounded border-gray-300 text-blue-600"}),e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center text-white text-2xl font-bold overflow-hidden ml-6",children:i.avatar?e.jsx("img",{src:i.avatar,alt:i.name,className:"w-full h-full object-cover"}):e.jsx("span",{children:(be=i.name[0])==null?void 0:be.toUpperCase()})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 truncate",children:i.name}),i.is_verified&&e.jsx(xs,{size:20,className:"text-blue-500"}),i.is_private?e.jsx(qe,{size:16,className:"text-gray-400"}):e.jsx(Qe,{size:16,className:"text-green-500"}),Q,j==="admin"]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:14,className:"mr-1"}),i.member_count," учасників"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{size:14,className:"mr-1"}),i.post_count," постів"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{size:14,className:"mr-1"}),Ie(i.last_activity)]}),i.location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(rs,{size:14,className:"mr-1"}),i.location]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:i.category}),(Ce=i.tags)==null?void 0:Ce.map($e=>e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["#",$e]},$e))]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("button",{onClick:()=>O(i.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Приєднатися"}),e.jsx("button",{className:"p-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsx(as,{size:16})})]})]})},i.id):e.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-200 cursor-pointer group hover:scale-105 ${te?"ring-2 ring-blue-500":""}`,onClick:()=>se(`/groups/${i.id}`),children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:te,onChange:$e=>{$e.stopPropagation(),Y(i.id)},className:"absolute top-3 left-3 w-4 h-4 rounded border-gray-300 text-blue-600 z-10"}),e.jsxs("div",{className:"h-32 bg-gradient-to-r from-purple-500 to-blue-600 relative",children:[i.cover&&e.jsx("img",{src:i.cover,alt:i.name,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-3 right-3 flex space-x-1",children:[i.is_verified&&e.jsx(xs,{size:16,className:"text-white"}),i.is_private?e.jsx(qe,{size:16,className:"text-white"}):e.jsx(Qe,{size:16,className:"text-white"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3 -mt-8",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-lg border-4 border-white shadow-lg flex items-center justify-center text-purple-600 text-xl font-bold overflow-hidden",children:i.avatar?e.jsx("img",{src:i.avatar,alt:i.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx("span",{children:(Ue=i.name[0])==null?void 0:Ue.toUpperCase()})}),e.jsx("div",{className:"flex-1 mt-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-1",children:i.name}),Q,j==="admin"]})})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:14,className:"mr-1"}),i.member_count]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{size:14,className:"mr-1"}),i.post_count]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-1 ${i.is_active?"bg-green-500":"bg-gray-400"}`}),i.is_active?"Активна":"Неактивна"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:i.category}),i.location&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(rs,{size:12,className:"mr-1"}),i.location]})]}),e.jsxs("div",{className:"flex space-x-2",onClick:$e=>$e.stopPropagation(),children:[e.jsxs("button",{onClick:()=>O(i.id),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx(Ke,{size:16,className:"mr-1"}),"Приєднатися"]}),e.jsx("button",{className:"flex items-center justify-center px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsx(vs,{size:16})})]})]})]})},i.id)};return $?e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx(lr,{size:"lg",text:"Завантаження груп...",color:"blue"})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsxs("div",{className:"flex-1 ml-64 p-8",children:[R.map(i=>e.jsx(ns,{...i,onClose:()=>C(i.id)},i.id)),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Групи"}),e.jsx("p",{className:"text-gray-600",children:"Знайдіть спільноти за вашими інтересами або створіть власну"})]}),e.jsxs("button",{onClick:()=>Z(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Xe,{size:20,className:"mr-2"}),"Створити групу"]})]}),e.jsx("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg",children:[{id:"explore",label:"Дослідити",count:r.length},{id:"my-groups",label:"Мої групи",count:t.length},{id:"joined",label:"Приєднані",count:c.length},{id:"managed",label:"Керую",count:u.length},{id:"invitations",label:"Запрошення",count:w.length}].map(i=>e.jsxs("button",{onClick:()=>T(i.id),className:`flex-1 px-4 py-3 text-sm font-medium rounded-md transition-colors ${v===i.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[i.label," (",i.count,")"]},i.id))}),ue&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-blue-800",children:["Обрано ",ce.size," груп"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Ne,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Приєднатися до всіх"}),e.jsx("button",{onClick:ae,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Скасувати"})]})]})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук груп...",value:E,onChange:i=>k(i.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),E&&e.jsx("button",{onClick:()=>k(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(we,{size:18})})]}),e.jsxs("button",{onClick:()=>ne(!ie),className:`flex items-center px-4 py-3 border rounded-lg transition-colors relative ${ie?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(Fs,{size:20,className:"mr-2"}),"Фільтри",pe()>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:pe()}),e.jsx(ys,{size:16,className:`ml-2 transition-transform ${ie?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>je("grid"),className:`p-3 ${oe==="grid"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:e.jsx(Is,{size:18})}),e.jsx("button",{onClick:()=>je("list"),className:`p-3 ${oe==="list"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:e.jsx(Gs,{size:18})})]})]}),ie&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категорія"}),e.jsxs("select",{value:A.category,onChange:i=>W(j=>({...j,category:i.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Всі категорії"}),Us.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Розмір"}),e.jsxs("select",{value:A.member_count,onChange:i=>W(j=>({...j,member_count:i.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі розміри"}),e.jsx("option",{value:"small",children:"Мала (<50)"}),e.jsx("option",{value:"medium",children:"Середня (50-200)"}),e.jsx("option",{value:"large",children:"Велика (>200)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Приватність"}),e.jsxs("select",{value:A.privacy,onChange:i=>W(j=>({...j,privacy:i.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі"}),e.jsx("option",{value:"public",children:"Публічні"}),e.jsx("option",{value:"private",children:"Приватні"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Активність"}),e.jsxs("select",{value:A.activity,onChange:i=>W(j=>({...j,activity:i.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі"}),e.jsx("option",{value:"active",children:"Активні"}),e.jsx("option",{value:"inactive",children:"Неактивні"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Сортування"}),e.jsxs("select",{value:A.sortBy,onChange:i=>W(j=>({...j,sortBy:i.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"activity",children:"Активністю"}),e.jsx("option",{value:"name",children:"Назвою"}),e.jsx("option",{value:"members",children:"Кількістю учасників"}),e.jsx("option",{value:"created",children:"Датою створення"}),e.jsx("option",{value:"popularity",children:"Популярністю"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:A.hasAvatar,onChange:i=>W(j=>({...j,hasAvatar:i.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Тільки з аватаром"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:A.is_verified,onChange:i=>W(j=>({...j,is_verified:i.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Тільки верифіковані"})]}),e.jsxs("button",{onClick:()=>W(i=>({...i,sortOrder:i.sortOrder==="asc"?"desc":"asc"})),className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(js,{size:16,className:"mr-1"}),A.sortOrder==="asc"?"За зростанням":"За спаданням"]})]}),e.jsx("button",{onClick:Fe,className:"text-sm text-blue-600 hover:text-blue-800",children:"Скинути фільтри"})]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[E?`Знайдено ${b.length} груп з ${de().length}`:`Всього ${b.length} груп`,E&&e.jsxs("span",{children:[' за запитом "',e.jsx("span",{className:"font-semibold",children:E}),'"']})]}),ce.size>0&&e.jsx("button",{onClick:()=>{ce.size===b.length?ae():(he(new Set(b.map(i=>i.id))),xe(!0))},className:"text-sm text-blue-600 hover:text-blue-800",children:ce.size===b.length?"Скасувати вибір":"Обрати всі"})]}),b.length>0?e.jsx("div",{className:oe==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:b.map(us)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Груп не знайдено"}),e.jsx("p",{className:"text-gray-600 mb-4",children:E||pe()>0?"Спробуйте змінити критерії пошуку або фільтри":"Поки що немає створених груп"}),E||pe()>0?e.jsx("button",{onClick:Fe,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Скинути всі фільтри"}):e.jsxs("button",{onClick:()=>Z(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Xe,{size:20,className:"mr-2"}),"Створити першу групу"]})]})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Створити групу"}),e.jsx("button",{onClick:()=>Z(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(we,{size:24})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Назва групи *"}),e.jsx("input",{type:"text",value:re.name,onChange:i=>fe(j=>({...j,name:i.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введіть назву групи"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Опис"}),e.jsx("textarea",{value:re.description,onChange:i=>fe(j=>({...j,description:i.target.value})),rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Розкажіть про вашу групу"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категорія"}),e.jsxs("select",{value:re.category,onChange:i=>fe(j=>({...j,category:i.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Оберіть категорію"}),Us.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Місцезнаходження"}),e.jsx("input",{type:"text",value:re.location,onChange:i=>fe(j=>({...j,location:i.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Місто, країна"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Веб-сайт"}),e.jsx("input",{type:"url",value:re.website,onChange:i=>fe(j=>({...j,website:i.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email для зв'язку"}),e.jsx("input",{type:"email",value:re.contactEmail,onChange:i=>fe(j=>({...j,contactEmail:i.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Правила групи"}),e.jsxs("div",{className:"space-y-2",children:[re.rules.map((i,j)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:i,onChange:Q=>ds(j,Q.target.value),className:"flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:`Правило ${j+1}`}),re.rules.length>1&&e.jsx("button",{onClick:()=>es(j),className:"text-red-500 hover:text-red-700",children:e.jsx(we,{size:20})})]},j)),e.jsx("button",{onClick:cs,className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Додати правило"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:re.is_private,onChange:i=>fe(j=>({...j,is_private:i.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Приватна група"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Тільки запрошені користувачі зможуть приєднатися до групи"})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-8 pt-6 border-t",children:[e.jsx("button",{onClick:()=>Z(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Скасувати"}),e.jsx("button",{onClick:p,disabled:X||!re.name.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:X?"Створення...":"Створити групу"})]})]})})}),e.jsx(tr,{isOpen:x,onClose:()=>{z(!1),ee("")},onUpload:ye,groupId:P})]})}function nr(){var re,fe,Ee,ve;const{groupId:r}=Xs(),l=Re(),t=Te(),[n,c]=s.useState(null),[o,u]=s.useState([]),[L,w]=s.useState([]),[S,b]=s.useState(null),[I,_]=s.useState(null),[V,E]=s.useState(!0),[k,v]=s.useState("posts"),[T,$]=s.useState(""),[J,m]=s.useState([]),[M,D]=s.useState(!1),[Z,x]=s.useState(!1),[z,P]=s.useState(""),[ee,X]=s.useState(null),[K,ie]=s.useState(!1);s.useEffect(()=>{ne()},[t.key]),s.useEffect(()=>{S&&r&&(oe(),je(),R(),q())},[S,r]);const ne=async()=>{try{const{data:{user:N},error:H}=await f.auth.getUser();if(H||!N){l("/login");return}const{data:d,error:y}=await f.from("user_profiles").select("*").eq("auth_user_id",N.id).single();if(y){console.error("Error fetching user profile:",y);return}b(d)}catch(N){console.error("Error fetching current user:",N)}},oe=async()=>{try{const{data:N,error:H}=await f.from("groups").select(`
          *,
          created_by_profile:user_profiles!groups_created_by_fkey(name, last_name, avatar)
        `).eq("id",r).single();if(H)throw H;c(N)}catch(N){console.error("Error fetching group details:",N),l("/groups")}finally{E(!1)}},je=async()=>{try{const{data:N,error:H}=await f.from("group_posts").select(`
          *,
          author:user_profiles!group_posts_author_id_fkey(name, last_name, avatar),
          media:group_post_media(*)
        `).eq("group_id",r).order("created_at",{ascending:!1});if(H)throw H;u(N||[])}catch(N){console.error("Error fetching group posts:",N)}},R=async()=>{try{const{data:N,error:H}=await f.from("group_members").select(`
          *,
          user:user_profiles!group_members_user_id_fkey(name, last_name, avatar)
        `).eq("group_id",r).order("joined_at",{ascending:!1});if(H)throw H;w(N||[])}catch(N){console.error("Error fetching group members:",N)}},q=async()=>{try{if(!S)return;const{data:N,error:H}=await f.from("group_members").select("*").eq("group_id",r).eq("user_id",S.id).single();if(H&&H.code!=="PGRST116")throw H;_(N)}catch(N){console.error("Error checking user membership:",N)}},C=async()=>{try{if(!S)return;const{error:N}=await f.from("group_members").insert([{group_id:r,user_id:S.id,role:"member"}]);if(N)throw N;q(),R(),alert("Ви успішно приєдналися до групи!")}catch(N){console.error("Error joining group:",N),alert("Помилка при приєднанні до групи")}},A=async()=>{try{if(!S||!I)return;if(I.role==="admin"){alert("Адміністратор не може покинути групу");return}const{error:N}=await f.from("group_members").delete().eq("group_id",r).eq("user_id",S.id);if(N)throw N;_(null),R(),alert("Ви покинули групу")}catch(N){console.error("Error leaving group:",N),alert("Помилка при виході з групи")}},W=N=>{const H=Array.from(N.target.files);m(H)},ce=N=>{m(H=>H.filter((d,y)=>y!==N))},he=async N=>{if(N.preventDefault(),!S||!I||!T.trim()&&J.length===0){alert("Ви не є членом цієї групи або не авторизовані.");return}try{if(D(!0),!S.id){alert("Ваш профіль не знайдено. Спробуйте перелогінитися або зверніться до підтримки."),D(!1);return}const{data:H,error:d}=await f.from("group_posts").insert([{group_id:r,author_id:S.id,content:T.trim()}]).select().single();if(d)throw d.code==="42501"||d.status===403?alert("Ви не є членом цієї групи або у вас немає прав на створення поста."):alert("Помилка при створенні поста: "+(d.message||d.details||"")),d;if(J.length>0)for(const y of J){const G=y.name.split(".").pop(),F=`${Date.now()}-${Math.random().toString(36).substring(7)}.${G}`,de=`group-posts/${r}/${F}`,me=y.type.startsWith("video/")?"video":"image",{error:p}=await f.storage.from("media").upload(de,y);if(p)throw p;const{data:{publicUrl:O}}=f.storage.from("media").getPublicUrl(de);await f.from("group_post_media").insert([{post_id:H.id,type:me,url:O,filename:y.name,file_size:y.size}])}$(""),m([]),je()}catch(H){(H==null?void 0:H.code)==="42501"||(H==null?void 0:H.status)===403?alert("Ви не є членом цієї групи або у вас немає прав на створення поста."):alert("Помилка при створенні поста: "+(H.message||H.details||"")),console.error("Error creating post:",H)}finally{D(!1)}},ue=N=>new Date(N).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),xe=N=>{switch(N){case"admin":return"Адміністратор";case"moderator":return"Модератор";default:return"Учасник"}};if(V)return e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"text-center",children:"Завантаження..."})})]});if(!n)return e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsx("div",{className:"text-center",children:"Група не знайдена"})})]});const se=!!I,ge=(I==null?void 0:I.role)==="admin";return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>l("/groups"),className:"mr-4 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(jt,{size:20})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mr-4",children:n.avatar?e.jsx("img",{src:n.avatar,alt:n.name,className:"w-full h-full rounded-full object-cover"}):e.jsx(Me,{size:24,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mr-2",children:n.name}),n.is_private?e.jsx(qe,{size:16,className:"text-gray-500"}):e.jsx(Qe,{size:16,className:"text-gray-500"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 space-x-4",children:[e.jsxs("span",{children:[n.member_count||L.length," учасників"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Створено ",ue(n.created_at)]})]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:se?e.jsxs(e.Fragment,{children:[!ge&&e.jsxs("button",{onClick:A,className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(yt,{size:18,className:"mr-2"}),"Покинути"]}),ge&&e.jsxs("button",{className:"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(bs,{size:18,className:"mr-2"}),"Керувати"]})]}):e.jsxs("button",{onClick:C,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Ke,{size:18,className:"mr-2"}),"Приєднатися"]})})]}),n.description&&e.jsx("p",{className:"mt-4 text-gray-600",children:n.description})]})}),e.jsx("div",{className:"max-w-6xl mx-auto px-8 py-6",children:se?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>v("posts"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${k==="posts"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Пости (",o.length,")"]}),e.jsxs("button",{onClick:()=>v("members"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${k==="members"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Учасники (",L.length,")"]}),e.jsx("button",{onClick:()=>v("info"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${k==="info"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Інформація"})]})}),k==="posts"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("form",{onSubmit:he,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:S!=null&&S.avatar?e.jsx("img",{src:S.avatar,alt:S.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm text-gray-600",children:(fe=(re=S==null?void 0:S.name)==null?void 0:re[0])==null?void 0:fe.toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:T,onChange:N=>$(N.target.value),placeholder:"Поділіться чимось з групою...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3}),J.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-4 gap-2",children:J.map((N,H)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:N.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(N),alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(zs,{size:24,className:"text-gray-400"})})}),e.jsx("button",{type:"button",onClick:()=>ce(H),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center",children:e.jsx(we,{size:12})})]},H))}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-lg cursor-pointer",children:[e.jsx(ps,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Фото/Відео"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",className:"hidden",onChange:W})]})}),e.jsxs("button",{type:"submit",disabled:M||!T.trim()&&J.length===0,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[M?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(We,{size:16,className:"mr-2"}),M?"Публікація...":"Опублікувати"]})]})]})]})})}),o.length>0?o.map(N=>{var H,d,y,G,F,de;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:(H=N.author)!=null&&H.avatar?e.jsx("img",{src:N.author.avatar,alt:N.author.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm text-gray-600",children:(G=(y=(d=N.author)==null?void 0:d.name)==null?void 0:y[0])==null?void 0:G.toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[(F=N.author)==null?void 0:F.name," ",(de=N.author)==null?void 0:de.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:ue(N.created_at)})]})]}),e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(as,{size:16,className:"text-gray-400"})})]})}),N.content&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("p",{className:"text-gray-900",children:N.content})}),N.media&&N.media.length>0&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:N.media.map((me,p)=>e.jsx("div",{className:"rounded-lg overflow-hidden",children:me.type==="image"?e.jsx("img",{src:me.url,alt:"",className:"w-full h-64 object-cover"}):e.jsx("video",{src:me.url,className:"w-full h-64 object-cover",controls:!0})},p))})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{className:"flex items-center text-gray-600 hover:text-red-500",children:[e.jsx(Be,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Подобається"})]}),e.jsxs("button",{className:"flex items-center text-gray-600 hover:text-blue-500",children:[e.jsx(Se,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Коментувати"})]}),e.jsxs("button",{className:"flex items-center text-gray-600 hover:text-green-500",children:[e.jsx(vt,{size:18,className:"mr-1"}),e.jsx("span",{className:"text-sm",children:"Поділитися"})]})]})})})]},N.id)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Поки що немає постів"}),e.jsx("p",{className:"text-gray-600",children:"Станьте першим, хто поділиться чимось цікавим!"})]})]}),k==="members"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Учасники групи (",L.length,")"]}),e.jsx("div",{className:"space-y-4",children:L.map(N=>{var H,d,y,G,F,de,me;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center",children:(H=N.user)!=null&&H.avatar?e.jsx("img",{src:N.user.avatar,alt:N.user.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-lg text-gray-600",children:(G=(y=(d=N.user)==null?void 0:d.name)==null?void 0:y[0])==null?void 0:G.toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[(F=N.user)==null?void 0:F.name," ",(de=N.user)==null?void 0:de.last_name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${N.role==="admin"?"bg-red-100 text-red-800":N.role==="moderator"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:xe(N.role)}),e.jsxs("span",{className:"ml-2",children:["Приєднався ",ue(N.joined_at)]})]})]})]}),ge&&((me=N.user)==null?void 0:me.id)!==(S==null?void 0:S.id)&&e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx(as,{size:16})})]},N.id)})})]})}),k==="info"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 max-w-xl mx-auto",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-24 h-24 mb-4",children:[e.jsx("img",{src:ee?URL.createObjectURL(ee):n.avatar||"",alt:"Group avatar",className:"w-24 h-24 rounded-full object-cover border border-gray-200"}),ge&&e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white rounded-full p-1 cursor-pointer hover:bg-blue-700",children:[e.jsx(He,{size:16}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:N=>X(N.target.files[0])})]})]}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:n.name}),e.jsxs("div",{className:"text-gray-600 mb-2",children:["Створено: ",ue(n.created_at)]}),e.jsxs("div",{className:"text-gray-600 mb-2",children:["Адміністратор: ",((ve=(Ee=L.find(N=>N.role==="admin"))==null?void 0:Ee.user)==null?void 0:ve.name)||"—"]}),Z?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border rounded p-2 mb-2",rows:3,value:z,onChange:N=>P(N.target.value)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:K,onClick:async()=>{ie(!0);let N=n.avatar;if(ee){const d=ee.name.split(".").pop(),y=`${Date.now()}-${Math.random().toString(36).substring(7)}.${d}`,G=`group-avatars/${r}/${y}`,{error:F}=await f.storage.from("media").upload(G,ee);if(!F){const{data:{publicUrl:de}}=f.storage.from("media").getPublicUrl(G);N=de}}const{error:H}=await f.from("groups").update({description:z,avatar:N}).eq("id",r);H||(c({...n,description:z,avatar:N}),x(!1),X(null)),ie(!1)},children:"Зберегти"}),e.jsx("button",{className:"px-4 py-2 border rounded hover:bg-gray-100",onClick:()=>{x(!1),P(n.description||""),X(null)},children:"Скасувати"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 text-gray-800 w-full text-center min-h-[48px]",children:n.description||"Опис відсутній"}),ge&&e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>{x(!0),P(n.description||"")},children:"Редагувати опис"})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(qe,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Приєднайтеся до групи"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Щоб переглядати пости та брати участь в обговореннях, приєднайтеся до групи"}),e.jsxs("button",{onClick:C,className:"flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mx-auto",children:[e.jsx(Ke,{size:18,className:"mr-2"}),"Приєднатися до групи"]})]})})]})]})}function or(){const[r,l]=s.useState([]),[t,n]=s.useState([]),[c,o]=s.useState([]),[u,L]=s.useState(""),[w,S]=s.useState(!0),[b,I]=s.useState(null),[_,V]=s.useState(!1),[E,k]=s.useState("grid"),[v,T]=s.useState({city:"",onlineStatus:"all",friendStatus:"all",sortBy:"date",sortOrder:"desc",hasAvatar:!1,hasBio:!1}),[$,J]=s.useState([]),[m,M]=s.useState(new Set),[D,Z]=s.useState(!1),x=Re(),[z,P]=s.useState(0),[ee,X]=s.useState(!1),[K,ie]=s.useState(!0),ne=s.useRef(null),oe=s.useRef(null),je=Te(),{notifications:R,addNotification:q,removeNotification:C}=os();s.useEffect(()=>{A(),W()},[je.key]),s.useEffect(()=>{ue()},[u,r,c,v]),s.useEffect(()=>(ne.current&&ne.current.disconnect(),ne.current=new IntersectionObserver(d=>{d[0].isIntersecting&&K&&!ee&&A()}),oe.current&&ne.current.observe(oe.current),()=>{var d;return(d=ne.current)==null?void 0:d.disconnect()}),[K,ee,z,t]);const A=async()=>{try{S(!0),console.log("🔍 Fetching users...");const{data:{user:d},error:y}=await f.auth.getUser();if(y||!d){console.error("Auth error:",y),q({type:"error",title:"Помилка авторизації",message:"Не вдалося отримати дані користувача"});return}I(d.id);const{data:G,error:F}=await f.from("user_profiles").select("*").order("created_at",{ascending:!1});if(F)throw F;const{data:de,error:me}=await f.from("friendships").select("*").or(`user1_id.eq.${d.id},user2_id.eq.${d.id}`);if(me)throw me;const p=(de||[]).map(a=>a.user1_id===d.id?a.user2_id:a.user1_id),O=(G||[]).filter(a=>a.auth_user_id!==d.id&&!p.includes(a.auth_user_id));console.log("✅ Users loaded:",O.length),l(O)}catch(d){console.error("Error fetching users:",d),q({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити користувачів",details:d instanceof Error?d.message:"Невідома помилка",showRetry:!0,onRetry:A}),l([])}finally{S(!1)}},W=async()=>{try{const{data:{user:d}}=await f.auth.getUser();if(!d){o([]);return}const{data:y,error:G}=await f.from("friend_requests").select("*").or(`sender_id.eq.${d.id},receiver_id.eq.${d.id}`).eq("status","pending");if(G)throw G;o(y||[])}catch(d){console.error("Error fetching friend requests:",d),q({type:"error",title:"Помилка завантаження",message:"Не вдалося завантажити запити на дружбу",details:d instanceof Error?d.message:"Невідома помилка"}),o([])}},ce=d=>{if(!b)return"not_friends";if(d===b)return"self";const y=c.find(G=>G.sender_id===b&&G.receiver_id===d||G.sender_id===d&&G.receiver_id===b);return y?y.status==="accepted"?"friends":y.status==="pending"?y.sender_id===b?"sent":"received":"not_friends":"not_friends"},he=d=>{var y;return((y=d.privacy)==null?void 0:y.profileVisibility)==="public"},ue=()=>{let d=[...r];u.trim()!==""&&(d=d.filter(y=>y.name.toLowerCase().includes(u.toLowerCase())||(y.last_name||"").toLowerCase().includes(u.toLowerCase())||y.email.toLowerCase().includes(u.toLowerCase())||y.city&&y.city.toLowerCase().includes(u.toLowerCase())||y.bio&&y.bio.toLowerCase().includes(u.toLowerCase()))),v.city&&(d=d.filter(y=>y.city===v.city)),v.onlineStatus!=="all"&&(d=d.filter(y=>v.onlineStatus==="online"?y.isOnline:!y.isOnline)),v.friendStatus!=="all"&&(d=d.filter(y=>{const G=ce(y.auth_user_id);switch(v.friendStatus){case"friends":return G==="friends";case"not_friends":return G==="not_friends";case"pending":return G==="sent"||G==="received";default:return!0}})),v.hasAvatar&&(d=d.filter(y=>y.avatar)),v.hasBio&&(d=d.filter(y=>y.bio&&y.bio.trim()!=="")),d.sort((y,G)=>{let F=0;switch(v.sortBy){case"name":F=`${y.name} ${y.last_name}`.localeCompare(`${G.name} ${G.last_name}`);break;case"date":F=new Date(y.created_at||0).getTime()-new Date(G.created_at||0).getTime();break;case"city":F=(y.city||"").localeCompare(G.city||"");break;case"lastSeen":y.isOnline&&!G.isOnline?F=-1:!y.isOnline&&G.isOnline?F=1:F=new Date(G.lastSeen||0).getTime()-new Date(y.lastSeen||0).getTime();break;case"popularity":F=(G.friendsCount||0)-(y.friendsCount||0);break}return v.sortOrder==="asc"?F:-F}),n(d)},xe=async d=>{try{if(!b){q({type:"warning",title:"Не авторизовано",message:"Для додавання в друзі потрібно авторизуватися"});return}if(d===b){q({type:"warning",title:"Неможливо додати себе",message:"Ви не можете додати себе в друзі!"});return}if(c.find(F=>F.sender_id===b&&F.receiver_id===d||F.sender_id===d&&F.receiver_id===b)){q({type:"warning",title:"Запит вже існує",message:"Запит на дружбу вже надіслано!"});return}const{error:G}=await f.from("friend_requests").insert([{sender_id:b,receiver_id:d,status:"pending"}]);if(G)throw G;q({type:"success",title:"Успішно!",message:"Запит на дружбу надіслано!",autoClose:!0,duration:3e3}),W()}catch(y){console.error("Error adding friend:",y),q({type:"error",title:"Помилка",message:"Не вдалося надіслати запит на дружбу",details:y instanceof Error?y.message:"Невідома помилка",showRetry:!0,onRetry:()=>xe(d)})}},se=async(d,y)=>{try{const{error:G}=await f.from("friend_requests").update({status:y==="accept"?"accepted":"rejected"}).eq("id",d);if(G)throw G;q({type:"success",title:"Успішно!",message:y==="accept"?"Запит прийнято!":"Запит відхилено!",autoClose:!0,duration:3e3}),W()}catch(G){console.error("Error handling friend request:",G),q({type:"error",title:"Помилка",message:"Не вдалося обробити запит на дружбу",details:G instanceof Error?G.message:"Невідома помилка",showRetry:!0,onRetry:()=>se(d,y)})}},ge=()=>{M(new Set),Z(!1)},re=async()=>{for(const d of m)await xe(d);ge()},fe=()=>{T({city:"",onlineStatus:"all",friendStatus:"all",sortBy:"date",sortOrder:"desc",hasAvatar:!1,hasBio:!1}),L("")},Ee=d=>new Date(d).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric"}),ve=()=>{let d=0;return v.city&&d++,v.onlineStatus!=="all"&&d++,v.friendStatus!=="all"&&d++,(v.sortBy!=="date"||v.sortOrder!=="desc")&&d++,v.hasAvatar&&d++,v.hasBio&&d++,d},N=(d,y)=>{const G=d?d[0].toUpperCase():"",F=y?y[0].toUpperCase():"";return`${G}${F}`},H=d=>{var G;const y=ce(d.auth_user_id);return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center",children:d.avatar?e.jsx("img",{src:d.avatar,alt:`${d.name} ${d.last_name}`,className:"w-full h-full rounded-full object-cover"}):e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold text-lg",children:N(d.name,d.last_name)})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>x(`/profile/${d.auth_user_id}`),children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:[d.name," ",d.last_name]}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:d.email})]}),d.city&&e.jsxs("p",{className:"text-sm text-gray-600 flex items-center mt-1",children:[e.jsx(rs,{className:"w-4 h-4 mr-1"}),d.city]}),d.created_at&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Приєднався ",Ee(d.created_at||"")]}),((G=d.privacy)==null?void 0:G.profileVisibility)&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d.privacy.profileVisibility==="public"?"🌐 Публічний профіль":"🔒 Приватний профіль"})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[y==="not_friends"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>xe(d.auth_user_id),className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Додати в друзі"]}),he(d)&&e.jsxs("button",{onClick:()=>x(`/messages?user=${d.auth_user_id}`),className:"flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Повідомлення"]})]}),y==="sent"&&e.jsxs("div",{className:"flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-600 rounded-lg text-sm",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Запит надіслано"]}),y==="received"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{const F=c.find(de=>de.sender_id===d.auth_user_id);F&&se(F.id,"accept")},className:"flex items-center justify-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx(Ze,{className:"w-4 h-4 mr-1"}),"Прийняти"]}),e.jsxs("button",{onClick:()=>{const F=c.find(de=>de.sender_id===d.auth_user_id);F&&se(F.id,"reject")},className:"flex items-center justify-center px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),"Відхилити"]})]})]})]})},d.id)};return w?e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Завантаження користувачів..."})]})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx("div",{style:{zIndex:50,background:"#fff",borderRight:"1px solid #e5e7eb",minHeight:"100vh",width:"16rem",position:"fixed",left:0,top:0},children:e.jsx(ke,{})}),e.jsxs("div",{className:"flex-1 ml-64 p-8",children:[R.map(d=>e.jsx(ns,{...d,onClose:()=>C(d.id)},d.id)),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Всі користувачі"}),e.jsx("p",{className:"text-gray-600",children:"Перегляньте всіх зареєстрованих користувачів нашої соціальної мережі"})]}),D&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-blue-800",children:["Обрано ",m.size," користувачів"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:re,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Додати всіх в друзі"}),e.jsx("button",{onClick:ge,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Скасувати"})]})]})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук серед всіх користувачів...",value:u,onChange:d=>L(d.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),u&&e.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(we,{size:18})})]}),e.jsxs("button",{onClick:()=>V(!_),className:`flex items-center px-4 py-3 border rounded-lg transition-colors relative ${_?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(Fs,{size:20,className:"mr-2"}),"Фільтри",ve()>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:ve()}),e.jsx(ys,{size:16,className:`ml-2 transition-transform ${_?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>k("grid"),className:`p-3 ${E==="grid"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:e.jsx(Is,{size:18})}),e.jsx("button",{onClick:()=>k("list"),className:`p-3 ${E==="list"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:e.jsx(Gs,{size:18})})]})]}),_&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Місто"}),e.jsxs("select",{value:v.city,onChange:d=>T(y=>({...y,city:d.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Всі міста"}),$.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Онлайн статус"}),e.jsxs("select",{value:v.onlineStatus,onChange:d=>T(y=>({...y,onlineStatus:d.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі"}),e.jsx("option",{value:"online",children:"Онлайн"}),e.jsx("option",{value:"offline",children:"Офлайн"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Статус дружби"}),e.jsxs("select",{value:v.friendStatus,onChange:d=>T(y=>({...y,friendStatus:d.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Всі"}),e.jsx("option",{value:"friends",children:"Друзі"}),e.jsx("option",{value:"not_friends",children:"Не друзі"}),e.jsx("option",{value:"pending",children:"Очікуючі запити"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Сортувати за"}),e.jsxs("select",{value:v.sortBy,onChange:d=>T(y=>({...y,sortBy:d.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"date",children:"Датою реєстрації"}),e.jsx("option",{value:"name",children:"Ім'ям"}),e.jsx("option",{value:"city",children:"Містом"}),e.jsx("option",{value:"lastSeen",children:"Останньою активністю"}),e.jsx("option",{value:"popularity",children:"Популярністю"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:v.hasAvatar,onChange:d=>T(y=>({...y,hasAvatar:d.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Тільки з фото"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:v.hasBio,onChange:d=>T(y=>({...y,hasBio:d.target.checked})),className:"rounded border-gray-300 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Тільки з біографією"})]}),e.jsxs("button",{onClick:()=>T(d=>({...d,sortOrder:d.sortOrder==="asc"?"desc":"asc"})),className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(Nt,{size:16,className:"mr-1"}),v.sortOrder==="asc"?"За зростанням":"За спаданням"]})]}),e.jsx("button",{onClick:fe,className:"text-sm text-blue-600 hover:text-blue-800",children:"Скинути фільтри"})]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[u?`Знайдено ${t.length} користувачів з ${r.length}`:`Всього ${t.length} користувачів`,u&&e.jsxs("span",{children:[' за запитом "',e.jsx("span",{className:"font-semibold",children:u}),'"']})]}),m.size>0&&e.jsx("button",{onClick:()=>{m.size===t.length?ge():(M(new Set(t.map(d=>d.auth_user_id))),Z(!0))},className:"text-sm text-blue-600 hover:text-blue-800",children:m.size===t.length?"Скасувати вибір":"Обрати всіх"})]}),t.length>0?e.jsxs("div",{className:E==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:[t.map(H),e.jsx("div",{ref:oe})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{size:32,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Користувачів не знайдено"}),e.jsx("p",{className:"text-gray-600 mb-4",children:u||ve()>0?"Спробуйте змінити критерії пошуку або фільтри":"Поки що немає зареєстрованих користувачів"}),(u||ve()>0)&&e.jsx("button",{onClick:fe,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Скинути всі фільтри"})]}),ee&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Завантаження..."}),!K&&t.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400",children:"Більше користувачів немає"})]})]})]})}class De{static async getAllGames(l,t){try{let n=f.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("is_active",!0).order("created_at",{ascending:!1});l&&l!=="other"&&(n=n.eq("category",l)),t&&t.length>=2&&(n=n.ilike("title",`%${t}%`));const{data:c,error:o}=await n;if(o)throw o;return c||[]}catch(n){return console.error("Error fetching games:",n),[]}}static async getGameById(l){try{const{data:t,error:n}=await f.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("id",l).eq("is_active",!0).single();if(n)throw n;return t}catch(t){return console.error("Error fetching game:",t),null}}static async createGame(l){try{const t=await Le.getCurrentUserProfile();if(!t)return null;const{data:n,error:c}=await f.from("games").insert([{...l,developer_id:t.id.toString()}]).select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).single();if(c)throw c;return n}catch(t){return console.error("Error creating game:",t),null}}static async updateGame(l,t){try{const{error:n}=await f.from("games").update({...t,updated_at:new Date().toISOString()}).eq("id",l);if(n)throw n;return!0}catch(n){return console.error("Error updating game:",n),!1}}static async deleteGame(l){try{const{error:t}=await f.from("games").delete().eq("id",l);if(t)throw t;return!0}catch(t){return console.error("Error deleting game:",t),!1}}static async getGamesByDeveloper(){try{const l=await Le.getCurrentUserProfile();if(!l)return[];const{data:t,error:n}=await f.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("developer_id",l.id.toString()).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(l){return console.error("Error fetching developer games:",l),[]}}static async recordGamePlay(l,t=0){try{const n=await Le.getCurrentUserProfile();if(!n)return!1;const{error:c}=await f.from("game_plays").insert([{game_id:l,user_id:n.id.toString(),duration:t}]);if(c)throw c;return!0}catch(n){return console.error("Error recording game play:",n),!1}}static async rateGame(l,t,n=""){try{const c=await Le.getCurrentUserProfile();if(!c)return!1;const{error:o}=await f.from("game_ratings").upsert([{game_id:l,user_id:c.id.toString(),rating:t,review:n}]);if(o)throw o;return!0}catch(c){return console.error("Error rating game:",c),!1}}static async getGameRatings(l){try{const{data:t,error:n}=await f.from("game_ratings").select(`
          *,
          user:users!game_ratings_user_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("game_id",l).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){return console.error("Error fetching game ratings:",t),[]}}static async getUserGameRating(l){try{const t=await Le.getCurrentUserProfile();if(!t)return null;const{data:n,error:c}=await f.from("game_ratings").select("*").eq("game_id",l).eq("user_id",t.id.toString()).single();if(c){if(c.code==="PGRST116")return null;throw c}return n}catch(t){return console.error("Error fetching user game rating:",t),null}}static async getPopularGames(l=10){try{const{data:t,error:n}=await f.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("is_active",!0).order("play_count",{ascending:!1}).limit(l);if(n)throw n;return t||[]}catch(t){return console.error("Error fetching popular games:",t),[]}}static async getTopRatedGames(l=10){try{const{data:t,error:n}=await f.from("games").select(`
          *,
          developer:users!games_developer_id_fkey (
            name,
            lastName,
            avatar
          )
        `).eq("is_active",!0).gt("rating",0).order("rating",{ascending:!1}).limit(l);if(n)throw n;return t||[]}catch(t){return console.error("Error fetching top rated games:",t),[]}}}function cr({game:r,onPlay:l}){var c,o,u,L,w,S;const t=b=>({action:"Екшн",puzzle:"Головоломки",strategy:"Стратегія",arcade:"Аркада",adventure:"Пригоди",simulation:"Симулятори",sports:"Спорт",racing:"Гонки",other:"Інше"})[b]||b,n=b=>b>=1e3?`${(b/1e3).toFixed(1)}k`:b.toString();return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow overflow-hidden group",children:[e.jsxs("div",{className:"relative h-48 bg-gradient-to-br from-blue-500 to-purple-600 overflow-hidden",children:[r.thumbnail?e.jsx("img",{src:r.thumbnail,alt:r.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Oe,{className:"text-white opacity-50",size:48})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("button",{onClick:l,className:"flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Oe,{size:20,className:"mr-2"}),"Грати"]})}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded-full",children:t(r.category)})}),r.rating>0&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("div",{className:"flex items-center px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded-full",children:[e.jsx(hs,{size:12,className:"mr-1 fill-current text-yellow-400"}),r.rating.toFixed(1)]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-1",children:r.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:r.description||"Немає опису"}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center mr-2",children:(c=r.developer)!=null&&c.avatar?e.jsx("img",{src:r.developer.avatar,alt:r.developer.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs text-gray-600",children:(L=(u=(o=r.developer)==null?void 0:o.name)==null?void 0:u[0])==null?void 0:L.toUpperCase()})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(w=r.developer)==null?void 0:w.name," ",(S=r.developer)==null?void 0:S.lastName]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ts,{size:16,className:"mr-1"}),e.jsxs("span",{children:[n(r.play_count)," грали"]})]}),e.jsx("span",{children:new Date(r.created_at).toLocaleDateString("uk-UA")})]}),e.jsxs("button",{onClick:l,className:"w-full mt-4 flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Oe,{size:18,className:"mr-2"}),"Грати зараз"]})]})]})}const dr=[{value:"action",label:"Екшн"},{value:"puzzle",label:"Головоломки"},{value:"strategy",label:"Стратегія"},{value:"arcade",label:"Аркада"},{value:"adventure",label:"Пригоди"},{value:"simulation",label:"Симулятори"},{value:"sports",label:"Спорт"},{value:"racing",label:"Гонки"},{value:"other",label:"Інше"}];function ur({onClose:r,onSubmit:l}){const[t,n]=s.useState(""),[c,o]=s.useState(""),[u,L]=s.useState(""),[w,S]=s.useState(""),[b,I]=s.useState("other"),[_,V]=s.useState(!1),E=async k=>{if(k.preventDefault(),!(!t.trim()||!w.trim())){V(!0);try{await l({title:t.trim(),description:c.trim(),thumbnail:u.trim()||void 0,game_url:w.trim(),category:b})}finally{V(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Додати нову гру"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Назва гри *"}),e.jsx("input",{type:"text",value:t,onChange:k=>n(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введіть назву гри",required:!0,maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Опис гри"}),e.jsx("textarea",{value:c,onChange:k=>o(k.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Розкажіть про вашу гру...",maxLength:500})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категорія *"}),e.jsx("select",{value:b,onChange:k=>I(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:dr.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL гри *"}),e.jsxs("div",{className:"relative",children:[e.jsx(wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"url",value:w,onChange:k=>S(k.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/game.html",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Посилання на HTML файл гри або веб-сторінку з грою"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Зображення гри (URL)"}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"url",value:u,onChange:k=>L(k.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/thumbnail.jpg"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Посилання на зображення-превью гри (необов'язково)"})]}),u&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Превью:"}),e.jsx("img",{src:u,alt:"Game thumbnail preview",className:"w-full h-32 object-cover rounded-lg",onError:k=>{k.currentTarget.style.display="none"}})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Скасувати"}),e.jsx("button",{type:"submit",disabled:_||!t.trim()||!w.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Додавання...":"Додати гру"})]})]})]})})}function mr({game:r,onClose:l}){var x,z;const[t,n]=s.useState(!1),[c,o]=s.useState(null),[u,L]=s.useState([]),[w,S]=s.useState(0),[b,I]=s.useState(""),[_,V]=s.useState(!1),[E]=s.useState(Date.now()),[k,v]=s.useState(!1);s.useEffect(()=>{T(),$(),J()},[r.id]);const T=async()=>{const P=await De.getGameRatings(r.id);L(P)},$=async()=>{const P=await De.getUserGameRating(r.id);o(P),P&&(S(P.rating),I(P.review))},J=async()=>{await De.recordGamePlay(r.id)},m=async P=>{if(P.preventDefault(),w===0)return;v(!0),await De.rateGame(r.id,w,b)&&(await T(),await $(),V(!1)),v(!1)},M=async()=>{const P=Math.floor((Date.now()-E)/1e3);P>10&&await De.recordGamePlay(r.id,P),l()},D=()=>{n(!t)},Z=(P,ee=!1,X)=>e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(K=>e.jsx("button",{type:ee?"button":void 0,onClick:ee&&X?()=>X(K):void 0,className:`${ee?"cursor-pointer hover:scale-110":"cursor-default"} transition-transform`,disabled:!ee,children:e.jsx(hs,{size:20,className:`${K<=P?"text-yellow-400 fill-current":"text-gray-300"}`})},K))});return e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${t?"p-0":"p-4"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl ${t?"w-full h-full rounded-none":"w-full max-w-6xl h-[90vh]"} flex flex-col`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mr-4",children:r.title}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(hs,{size:16,className:"mr-1 text-yellow-400 fill-current"}),e.jsxs("span",{children:[r.rating.toFixed(1)," (",u.length," відгуків)"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:D,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",title:t?"Вийти з повноекранного режиму":"Повноекранний режим",children:e.jsx(_t,{size:20})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",title:"Перезапустити гру",children:e.jsx(kt,{size:20})}),e.jsx("button",{onClick:M,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",children:e.jsx(we,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx("div",{className:"flex-1 bg-gray-100",children:e.jsx("iframe",{src:r.game_url,className:"w-full h-full border-0",title:r.title,allowFullScreen:!0,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-pointer-lock"})}),!t&&e.jsx("div",{className:"w-80 border-l border-gray-200 bg-gray-50 overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Про гру"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:r.description||"Немає опису"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Розробник:"}),e.jsxs("span",{className:"text-gray-900",children:[(x=r.developer)==null?void 0:x.name," ",(z=r.developer)==null?void 0:z.lastName]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Категорія:"}),e.jsx("span",{className:"text-gray-900",children:r.category})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Зіграно:"}),e.jsxs("span",{className:"text-gray-900",children:[r.play_count," разів"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Оцінка"}),!c&&e.jsx("button",{onClick:()=>V(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:"Оцінити"})]}),_&&e.jsxs("form",{onSubmit:m,className:"mb-4 p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ваша оцінка:"}),Z(w,!0,S)]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Відгук (необов'язково):"}),e.jsx("textarea",{value:b,onChange:P=>I(P.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Поділіться враженнями від гри..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Скасувати"}),e.jsx("button",{type:"submit",disabled:k||w===0,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:k?"Збереження...":"Зберегти"})]})]}),c&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Ваша оцінка:"}),e.jsx("button",{onClick:()=>V(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:"Змінити"})]}),Z(c.rating),c.review&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:c.review})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(Ct,{size:18,className:"mr-2"}),"Відгуки (",u.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:u.length>0?u.map(P=>{var ee,X,K,ie,ne,oe;return e.jsxs("div",{className:"p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center mr-2",children:(ee=P.user)!=null&&ee.avatar?e.jsx("img",{src:P.user.avatar,alt:P.user.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs text-gray-600",children:(ie=(K=(X=P.user)==null?void 0:X.name)==null?void 0:K[0])==null?void 0:ie.toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[(ne=P.user)==null?void 0:ne.name," ",(oe=P.user)==null?void 0:oe.lastName]})]}),Z(P.rating)]}),P.review&&e.jsx("p",{className:"text-sm text-gray-600",children:P.review}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(P.created_at).toLocaleDateString("uk-UA")})]},P.id)}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Поки немає відгуків"})})]})]})})]})]})})}const xr=[{value:"action",label:"Екшн"},{value:"puzzle",label:"Головоломки"},{value:"strategy",label:"Стратегія"},{value:"arcade",label:"Аркада"},{value:"adventure",label:"Пригоди"},{value:"simulation",label:"Симулятори"},{value:"sports",label:"Спорт"},{value:"racing",label:"Гонки"},{value:"other",label:"Інше"}];function hr(){const[r,l]=s.useState([]),[t,n]=s.useState([]),[c,o]=s.useState([]),[u,L]=s.useState(!0),[w,S]=s.useState(""),[b,I]=s.useState(""),[_,V]=s.useState(!1),[E,k]=s.useState(null),[v,T]=s.useState("all");Re(),s.useEffect(()=>{$(),J(),m()},[]),s.useEffect(()=>{const x=setTimeout(()=>{$()},300);return()=>clearTimeout(x)},[w,b]);const $=async()=>{try{L(!0);const x=await De.getAllGames(b,w);l(x)}catch(x){console.error("Error loading games:",x)}finally{L(!1)}},J=async()=>{try{const x=await De.getPopularGames(6);n(x)}catch(x){console.error("Error loading popular games:",x)}},m=async()=>{try{const x=await De.getTopRatedGames(6);o(x)}catch(x){console.error("Error loading top rated games:",x)}},M=async x=>{const z=await De.createGame(x);z&&(l(P=>[z,...P]),V(!1))},D=x=>{k(x)},Z=()=>{switch(v){case"popular":return t;case"top-rated":return c;default:return r}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("div",{className:"flex-1 ml-64 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ks,{className:"h-8 w-8 text-blue-600 mr-3"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ігри"})]}),e.jsxs("button",{onClick:()=>V(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Xe,{size:20,className:"mr-2"}),"Додати гру"]})]}),e.jsxs("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg w-fit",children:[e.jsx("button",{onClick:()=>T("all"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${v==="all"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Всі ігри"}),e.jsxs("button",{onClick:()=>T("popular"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${v==="popular"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(js,{size:16,className:"mr-1"}),"Популярні"]}),e.jsxs("button",{onClick:()=>T("top-rated"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${v==="top-rated"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(St,{size:16,className:"mr-1"}),"Найкращі"]})]}),v==="all"&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Пошук ігор...",value:w,onChange:x=>S(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsxs("select",{value:b,onChange:x=>I(x.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Всі категорії"}),xr.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]})]}),u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Завантаження ігор..."})]}):Z().length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Z().map(x=>e.jsx(cr,{game:x,onPlay:()=>D(x)},x.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ks,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:w||b?"Ігри не знайдено":"Немає ігор"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:w||b?"Спробуйте змінити пошуковий запит або фільтр":"Додайте першу гру для спільноти"}),!w&&!b&&e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>V(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(Xe,{className:"-ml-1 mr-2 h-5 w-5"}),"Додати гру"]})})]})]})}),_&&e.jsx(ur,{onClose:()=>V(!1),onSubmit:M}),E&&e.jsx(mr,{game:E,onClose:()=>k(null)})]})}function gr(){const[r,l]=s.useState([]),[t,n]=s.useState(null),[c,o]=s.useState(null),[u,L]=s.useState(!0),[w,S]=s.useState(null),[b,I]=s.useState([]);s.useEffect(()=>{V()},[]);const _=v=>{const T=new Date().toLocaleTimeString();I($=>[...$,`[${T}] ${v}`]),console.log(v)},V=async()=>{try{L(!0),S(null),I([]),_("🚀 Starting database connection test..."),_("🔍 Checking environment variables...");const v="https://gtfgvqttfydelzgvgwly.supabase.co",T="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0Zmd2cXR0ZnlkZWx6Z3Znd2x5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjE0OTEsImV4cCI6MjA1OTU5NzQ5MX0.nBdVMHZ6LJ8ZvdSuXk_uDVMb6DxB5iTeFdc0dM7zolI";_(`✅ Environment variables OK (URL: ${v})`),_("🔐 Checking authentication status...");const{data:{user:$},error:J}=await Ge.getUser();if(J?(_(`❌ Auth Error: ${J.message}`),S(`Auth Error: ${J.message}`)):$?(_(`✅ User authenticated: ${$.email}`),n($)):_("⚠️ No authenticated user found"),$){_("👤 Getting current user profile...");try{const m=await Le.getCurrentUserProfile();m?(_(`✅ Profile found: ${m.name} ${m.lastname}`),o(m)):_("❌ No profile found")}catch(m){_(`❌ Profile error: ${m instanceof Error?m.message:"Unknown error"}`)}}_("👥 Fetching all users...");try{const m=await Le.getAllUsers();_(`✅ Fetched ${m.length} users`),l(m)}catch(m){_(`❌ Users fetch error: ${m instanceof Error?m.message:"Unknown error"}`)}_("🗄️ Testing direct database connection...");try{const{data:m,error:M}=await f.from("users").select("count(*)").single();_(M?`❌ Database error: ${M.message}`:"✅ Database connection successful")}catch(m){_(`❌ Database connection failed: ${m instanceof Error?m.message:"Unknown error"}`)}L(!1),_("✨ Test completed!")}catch(v){const T=v instanceof Error?v.message:"Unknown error";_(`💥 Test failed: ${T}`),S(T),L(!1)}},E=async()=>{var v;try{_("🔑 Testing login...");const{data:T,error:$}=await Ge.signIn("test@example.com","testpassword");$?_(`❌ Login failed: ${$.message}`):(_(`✅ Login successful: ${(v=T.user)==null?void 0:v.email}`),V())}catch(T){_(`❌ Login error: ${T instanceof Error?T.message:"Unknown error"}`)}},k=()=>{I([])};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"🧪 Supabase Database Test"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"📋 Environment Info"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"URL:"})," ","https://gtfgvqttfydelzgvgwly.supabase.co"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Key:"})," ","Set ✅"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mode:"})," ","Production"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"🔐 Auth Status"}),u?e.jsx("p",{children:"Loading..."}):t?e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",t.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Verified:"})," ",t.email_confirmed_at?"Yes ✅":"No ❌"]}),c&&e.jsxs("p",{children:[e.jsx("strong",{children:"Profile:"})," ",c.name," ",c.lastname]})]}):e.jsx("p",{className:"text-orange-600",children:"No authenticated user ⚠️"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["👥 Users (",r.length,")"]}),u?e.jsx("p",{children:"Loading..."}):w?e.jsx("p",{className:"text-red-600",children:w}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-60 overflow-y-auto",children:[r.map((v,T)=>e.jsxs("div",{className:"p-3 border rounded bg-gray-50",children:[e.jsxs("p",{className:"font-medium",children:[v.name," ",v.lastname]}),e.jsx("p",{className:"text-sm text-gray-600",children:v.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",v.id]})]},v.id||T)),r.length===0&&e.jsx("p",{className:"text-gray-500 col-span-3",children:"No users found 😔"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:V,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"🔄 Refresh Test"}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"🔑 Test Login"}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"🧹 Clear Logs"})]}),e.jsxs("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold",children:"📜 Test Logs"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[b.length," entries"]})]}),e.jsx("div",{className:"text-sm font-mono max-h-60 overflow-y-auto space-y-1",children:b.length===0?e.jsx("p",{className:"text-gray-500",children:"No logs yet. Run a test to see output."}):b.map((v,T)=>e.jsx("div",{className:"break-words",children:v},T))})]})]})})}const fr=["😊","😂","❤️","👍","🎉","🔥","😍","🤔","😭","😎","🥳","💪","✨","🌟","💯"];function br(){var me;const[r,l]=s.useState([]),[t,n]=s.useState(!0),[c,o]=s.useState(""),[u,L]=s.useState(""),[w,S]=s.useState(""),[b,I]=s.useState(""),[_,V]=s.useState(!1),[E,k]=s.useState(null),[v,T]=s.useState({}),[$,J]=s.useState({}),[m,M]=s.useState({}),[D,Z]=s.useState(null),[x,z]=s.useState(""),[P,ee]=s.useState(""),[X,K]=s.useState(""),[ie,ne]=s.useState(null),[oe,je]=s.useState(!1),[R,q]=s.useState(!1),[C,A]=s.useState(0),[W,ce]=s.useState(null),he=Te(),ue=280;s.useEffect(()=>{xe(),se()},[he.key]),s.useEffect(()=>{A(u.length)},[u]);const xe=async()=>{const{data:{user:p}}=await f.auth.getUser();k(p)},se=async()=>{n(!0),o("");try{const{data:p,error:O}=await Js();if(O)throw O;l(p||[])}catch{o("Не вдалося завантажити пости")}finally{n(!1)}},ge=async p=>{if(p.preventDefault(),!(!u.trim()||!E||C>ue)){V(!0);try{const{error:O}=await Zs({user_id:E.id,content:u,media_url:w||void 0,media_type:b||void 0});if(O)throw O;L(""),S(""),I(""),q(!1),je(!1),se()}catch{o("Не вдалося створити пост")}finally{V(!1)}}},re=p=>{C+p.length<=ue&&L(O=>O+p)},fe=async p=>{if(E)try{p.isLiked?await Ot(p.id,E.id):await Bt(p.id,E.id),se()}catch(O){console.error("Error fetching posts:",O)}},Ee=async p=>{if(!v[p]){M(O=>({...O,[p]:!0}));try{const{data:O,error:a}=await Es(p);if(a)throw a;T(g=>({...g,[p]:O||[]}))}catch(O){console.error("Error loading comments:",O)}M(O=>({...O,[p]:!1}))}},ve=async p=>{var O;if(!(!E||!((O=$[p])!=null&&O.trim()))){M(a=>({...a,[p]:!0}));try{const{error:a}=await Vt(p,E.id,$[p]);if(a)throw a;J(Y=>({...Y,[p]:""}));const{data:g}=await Es(p);T(Y=>({...Y,[p]:g||[]}))}catch(a){console.error("Error adding comment:",a)}M(a=>({...a,[p]:!1}))}},N=p=>{Z(p.id),z(p.content),ee(p.media_url||""),K(p.media_type||"")},H=async p=>{try{const{error:O}=await Ht(p,{content:x,media_url:P||null,media_type:X||null});if(O)throw O;Z(null),se()}catch{o("Не вдалося оновити пост")}},d=()=>{Z(null)},y=p=>{ne(p),ce(null)},G=async p=>{try{const{error:O}=await Jt(p);if(O)throw O;ne(null),se()}catch{o("Не вдалося видалити пост")}},F=()=>{ne(null)},de=p=>{const O=new Date(p),g=Math.floor((new Date().getTime()-O.getTime())/(1e3*60*60));return g<1?"щойно":g<24?`${g}г тому`:O.toLocaleDateString("uk-UA",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ke,{}),e.jsx("main",{className:"flex-1 ml-64 p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Стрічка"}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:((me=E==null?void 0:E.email)==null?void 0:me.charAt(0).toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("form",{onSubmit:ge,children:[e.jsx("textarea",{className:"w-full border-0 resize-none text-lg placeholder-gray-500 focus:outline-none focus:ring-0",placeholder:"Що нового?",value:u,onChange:p=>L(p.target.value),rows:3,maxLength:ue}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>je(!oe),className:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 rounded-full transition-colors",children:e.jsx(Ls,{size:20})}),e.jsx("button",{type:"button",onClick:()=>q(!R),className:"p-2 text-gray-500 hover:text-green-500 hover:bg-green-50 rounded-full transition-colors",children:e.jsx(ps,{size:20})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:`text-sm ${C>ue?"text-red-500":"text-gray-500"}`,children:[C,"/",ue]}),e.jsxs("button",{type:"submit",disabled:_||!u.trim()||C>ue,className:"px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",children:[_?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(We,{size:16,className:"mr-2"}),_?"Створення...":"Опублікувати"]})]})]})]}),oe&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"grid grid-cols-8 gap-2",children:fr.map((p,O)=>e.jsx("button",{onClick:()=>re(p),className:"text-2xl hover:bg-white rounded p-1 transition-colors",children:p},O))})}),R&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Посилання на медіа (необов'язково)",value:w,onChange:p=>S(p.target.value)}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:b,onChange:p=>I(p.target.value),children:[e.jsx("option",{value:"",children:"Тип медіа"}),e.jsx("option",{value:"photo",children:"Фото"}),e.jsx("option",{value:"video",children:"Відео"}),e.jsx("option",{value:"document",children:"Документ"})]})]})]})]})}),c&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:c}),t?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Завантаження постів..."})]}):r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Поки що немає постів"}),e.jsx("p",{className:"text-gray-600",children:"Будьте першим, хто поділиться своїми думками!"})]}):e.jsx("div",{className:"space-y-6",children:r.map(p=>{var O,a;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold",children:p.author.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[p.author.name," ",p.author.last_name]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(ss,{size:14,className:"mr-1"}),de(p.created_at)]})]})]}),E&&p.author&&p.author.id===E.id&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ce(W===p.id?null:p.id),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(as,{size:16})}),W===p.id&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>N(p),className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[e.jsx(Rs,{size:14,className:"mr-2"}),"Редагувати"]}),e.jsxs("button",{onClick:()=>y(p.id),className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center",children:[e.jsx(Cs,{size:14,className:"mr-2"}),"Видалити"]})]})]})]})}),D===p.id?e.jsxs("div",{className:"px-6 pb-4",children:[e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:x,onChange:g=>z(g.target.value),rows:3}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",className:"flex-1 border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Посилання на медіа (необов'язково)",value:P,onChange:g=>ee(g.target.value)}),e.jsxs("select",{className:"border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:X,onChange:g=>K(g.target.value),children:[e.jsx("option",{value:"",children:"Тип медіа"}),e.jsx("option",{value:"photo",children:"Фото"}),e.jsx("option",{value:"video",children:"Відео"}),e.jsx("option",{value:"document",children:"Документ"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>H(p.id),children:"Зберегти"}),e.jsx("button",{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition-colors",onClick:d,children:"Скасувати"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 pb-4",children:[e.jsx("div",{className:"text-gray-900 text-lg leading-relaxed whitespace-pre-line mb-4",children:p.content}),p.media_url&&e.jsx("div",{className:"mb-4",children:p.media_type==="photo"?e.jsx("img",{src:p.media_url,alt:"media",className:"max-h-96 w-full object-cover rounded-lg"}):p.media_type==="video"?e.jsx("video",{src:p.media_url,controls:!0,className:"max-h-96 w-full rounded-lg"}):p.media_type==="document"?e.jsxs("a",{href:p.media_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(Ms,{size:16,className:"mr-2"}),"Переглянути документ"]}):null})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors ${p.isLiked?"text-red-500 bg-red-50 hover:bg-red-100":"text-gray-500 hover:text-red-500 hover:bg-red-50"}`,onClick:()=>fe(p),children:[e.jsx(Be,{size:18,className:p.isLiked?"fill-current":""}),e.jsx("span",{className:"text-sm font-medium",children:p.likes_count})]}),e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-gray-500 hover:text-blue-500 hover:bg-blue-50 transition-colors",onClick:()=>Ee(p.id),children:[e.jsx(Se,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:p.comments_count})]}),e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-gray-500 hover:text-green-500 hover:bg-green-50 transition-colors",children:[e.jsx(vs,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Поділитися"})]})]})})}),v[p.id]&&e.jsx("div",{className:"border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4 font-semibold text-gray-900",children:"Коментарі"}),m[p.id]?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})}):v[p.id].length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Коментарів ще немає"}):e.jsx("div",{className:"space-y-3 mb-4",children:v[p.id].map(g=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold",children:g.author.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-900 text-sm",children:[g.author.name," ",g.author.last_name]}),e.jsx("span",{className:"text-xs text-gray-500",children:de(g.created_at)})]}),e.jsx("div",{className:"text-gray-700 text-sm",children:g.content})]})]},g.id))}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold",children:((O=E==null?void 0:E.email)==null?void 0:O.charAt(0).toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1 flex items-center space-x-2",children:[e.jsx("input",{type:"text",className:"flex-1 px-3 py-2 border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ваш коментар...",value:$[p.id]||"",onChange:g=>J(Y=>({...Y,[p.id]:g.target.value})),disabled:m[p.id]}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",onClick:()=>ve(p.id),disabled:m[p.id]||!((a=$[p.id])!=null&&a.trim()),children:m[p.id]?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(We,{size:14})})]})]})]})})]})]},p.id)})})]})}),ie&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Cs,{className:"h-6 w-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Видалити пост?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Цю дію неможливо скасувати. Пост буде видалено назавжди."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",onClick:F,children:"Скасувати"}),e.jsx("button",{className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",onClick:()=>G(ie),children:"Видалити"})]})]})})})]})}function pr(){return s.useEffect(()=>{gs.initialize()},[]),null}function jr(){return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Me,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Соціальна мережа"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(ts,{to:"/login",className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"Вхід"}),e.jsx(ts,{to:"/register",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200",children:"Реєстрація"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-8",children:"Ласкаво просимо до нашої спільноти"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Приєднуйтесь до нашої соціальної мережі, щоб спілкуватися з друзями, ділитися моментами та знаходити нові знайомства."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-12",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Спілкування"}),e.jsx("p",{className:"text-gray-600",children:"Спілкуйтеся з друзями та знаходьте нові знайомства"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Контент"}),e.jsx("p",{className:"text-gray-600",children:"Діліться фото, відео та іншими матеріалами"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Приватність"}),e.jsx("p",{className:"text-gray-600",children:"Повний контроль над вашими даними та приватністю"})]})]})]})})]})}function yr(){return e.jsxs(e.Fragment,{children:[e.jsx(pr,{}),e.jsxs(Ks,{children:[e.jsx(ze,{path:"/",element:e.jsx(jr,{})}),e.jsx(ze,{path:"/login",element:e.jsx(qt,{})}),e.jsx(ze,{path:"/register",element:e.jsx(It,{})}),e.jsx(ze,{path:"/profile",element:e.jsx(Zt,{})}),e.jsx(ze,{path:"/reels",element:e.jsx(Wt,{})}),e.jsx(ze,{path:"/messages",element:e.jsx(Yt,{})}),e.jsx(ze,{path:"/friends",element:e.jsx(er,{})}),e.jsx(ze,{path:"/people",element:e.jsx(or,{})}),e.jsx(ze,{path:"/settings",element:e.jsx(sr,{})}),e.jsx(ze,{path:"/groups",element:e.jsx(ir,{})}),e.jsx(ze,{path:"/groups/:groupId",element:e.jsx(nr,{})}),e.jsx(ze,{path:"/games",element:e.jsx(hr,{})}),e.jsx(ze,{path:"/test-db",element:e.jsx(gr,{})}),e.jsx(ze,{path:"/wall",element:e.jsx(br,{})})]})]})}Vs(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(Ys,{children:e.jsx(yr,{})})}));
