# Налаштування завантаження медіа файлів

## Що було додано

### 1. Сервіс для роботи з медіа (`src/lib/mediaService.ts`)
- **MediaService** - клас для завантаження файлів на Supabase Storage
- Підтримка зображень та відео
- Валідація типів файлів та розмірів
- Автоматична генерація унікальних імен файлів

### 2. Компонент завантаження медіа (`src/components/MediaUpload.tsx`)
- Drag & Drop функціональність
- Підтримка різних типів файлів (зображення/відео)
- Валідація та обробка помилок
- Прев'ю завантажених файлів

### 3. Компонент завантаження аватара (`src/components/ProfileImageUpload.tsx`)
- Спеціалізований компонент для аватарів профілю
- Прев'ю зображення перед завантаженням
- Обмеження розміру файлу (5MB)

### 4. Оновлення компонентів профілю
- **ProfileHeader** - додано функціональність завантаження аватара
- **CreatePostForm** - додано завантаження медіа для постів
- **useProfile** - додано функцію `handleAvatarChange`

## Налаштування бази даних

### Крок 1: Виконайте SQL скрипт
Запустіть файл `setup_storage_buckets.sql` в Supabase SQL Editor:

```sql
-- Цей скрипт створить:
-- 1. Storage buckets: avatars, covers, posts, media
-- 2. RLS політики для безпечного доступу
-- 3. Публічний доступ до медіа файлів
```

### Крок 2: Перевірте налаштування
Після виконання скрипта перевірте:

1. **Storage buckets** створені в Supabase Dashboard
2. **RLS політики** активовані
3. **Публічний доступ** налаштований

## Функціональність

### Завантаження аватара профілю
- Клікніть на іконку камери під час редагування профілю
- Виберіть зображення з комп'ютера
- Автоматичне завантаження на Supabase Storage
- Прев'ю перед збереженням

### Завантаження медіа для постів
- Клікніть на іконку зображення в формі створення посту
- Перетягніть файл або клікніть для вибору
- Підтримуються зображення та відео
- Максимальний розмір: 50MB

### Підтримувані формати
**Зображення:**
- JPG/JPEG
- PNG
- GIF
- WebP

**Відео:**
- MP4
- WebM
- OGG
- QuickTime

## Обмеження розмірів

- **Аватари профілю**: 5MB
- **Обкладинки профілю**: 10MB
- **Медіа постів**: 50MB (відео), 10MB (зображення)

## Безпека

### RLS Політики
- Публічний доступ для перегляду медіа
- Авторизовані користувачі можуть завантажувати
- Користувачі можуть видаляти тільки свої файли

### Валідація
- Перевірка типів файлів
- Обмеження розмірів
- Унікальні імена файлів
- Безпечні шляхи завантаження

## Використання

### В компонентах
```typescript
import { MediaUpload } from '../components/MediaUpload';
import { ProfileImageUpload } from '../components/ProfileImageUpload';

// Для завантаження медіа
<MediaUpload
  onUpload={(result) => console.log(result.url)}
  accept="both"
  maxSize={50}
/>

// Для завантаження аватара
<ProfileImageUpload
  currentAvatar={profile.avatar}
  onUpload={(avatarUrl) => setAvatar(avatarUrl)}
/>
```

### В сервісах
```typescript
import { MediaService } from '../lib/mediaService';

// Завантаження файлу
const result = await MediaService.uploadPostMedia(file);

// Завантаження аватара
const avatarUrl = await MediaService.uploadProfileImage(file);
```

## Тестування

### 1. Завантаження аватара
1. Перейдіть на сторінку профілю
2. Клікніть "Редагувати профіль"
3. Клікніть на іконку камери біля аватара
4. Виберіть зображення
5. Перевірте прев'ю та збережіть

### 2. Завантаження медіа для посту
1. На сторінці профілю знайдіть форму створення посту
2. Клікніть на іконку зображення
3. Перетягніть файл або виберіть з комп'ютера
4. Перевірте прев'ю та створіть пост

### 3. Перевірка помилок
- Спробуйте завантажити файл неправильного типу
- Спробуйте завантажити файл занадто великого розміру
- Перевірте повідомлення про помилки

## Наступні кроки

1. **Додати компресію зображень** для зменшення розміру
2. **Додати генерацію прев'ю** для відео
3. **Додати галерею медіа** для перегляду всіх файлів
4. **Додати редагування зображень** (обрізка, фільтри)
5. **Додати прогресивне завантаження** для великих файлів

## Виправлення проблем

### Помилка "Bucket not found"
- Перевірте, чи виконано SQL скрипт налаштування
- Перевірте назви buckets в Supabase Dashboard

### Помилка "Access denied"
- Перевірте RLS політики
- Перевірте авторизацію користувача

### Файл не завантажується
- Перевірте розмір файлу
- Перевірте тип файлу
- Перевірте мережеве з'єднання 