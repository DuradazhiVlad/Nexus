# –ü—ñ–¥—Å—É–º–æ–∫ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≥—Ä—É–ø

## –ü—Ä–æ–±–ª–µ–º–∏, —è–∫—ñ –±—É–ª–∏ –≤–∏—è–≤–ª–µ–Ω—ñ

### 1. –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –º—ñ–∂ —Å—Ö–µ–º–æ—é –ë–î —Ç–∞ –∫–æ–¥–æ–º
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü—è `groups.created_by` –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ `users(id)`, –∞–ª–µ –∫–æ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `user_profiles`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü—è `group_members.user_id` –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ `users(id)`, –∞–ª–µ –∫–æ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `user_profiles`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### 2. –í—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—ñ groups
- **–ü—Ä–æ–±–ª–µ–º–∞**: –£ —Å—Ö–µ–º—ñ –ë–î –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ –∫–æ–¥—ñ
- **–í—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è**: `category`, `tags`, `location`, `website`, `rules`, `contactemail`, `cover`, `post_count`, `is_verified`, `is_active`, `last_activity`

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏ –≤ –∫–æ–¥—ñ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–∫–ª–∞–¥–µ–Ω–∏–π JOIN –∑–∞–ø–∏—Ç –∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é –ø–æ —á–ª–µ–Ω—Å—Ç–≤—É
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–µ –≤—Å—ñ –≥—Ä—É–ø–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è, —Ç—ñ–ª—å–∫–∏ —Ç—ñ, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î —á–ª–µ–Ω–æ–º

## –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ñ–∞–π–ª–∏ –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ë–î

#### `fix_groups_database.sql`
- –î–æ–¥–∞—î –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `groups`
- –í–∏–ø—Ä–∞–≤–ª—è—î foreign key constraints
- –°—Ç–≤–æ—Ä—é—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—å

#### `supabase/migrations/20250125000000_fix_groups_user_profiles.sql`
- –ú—ñ–≥—Ä–∞—Ü—ñ—è –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ `groups` —Ç–∞ `user_profiles`
- –î–æ–¥–∞—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–æ–ª—è
- –í–∏–ø—Ä–∞–≤–ª—è—î foreign key constraints

#### `test_groups_functionality.sql`
- –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—å
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î foreign key constraints
- –¢–µ—Å—Ç—É—î –∑–∞–ø–∏—Ç–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≥—Ä—É–ø
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —ñ–Ω–¥–µ–∫—Å–∏ —Ç–∞ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏

### 2. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É

#### `src/pages/groups/hooks/useGroups.ts`
**–û—Å–Ω–æ–≤–Ω—ñ –∑–º—ñ–Ω–∏:**
```typescript
// –ë—É–ª–æ: –°–∫–ª–∞–¥–µ–Ω–∏–π JOIN –∑–∞–ø–∏—Ç
const { data, error: groupsError } = await supabase
  .from('groups')
  .select(`
    *,
    user_profiles!groups_created_by_fkey (
      id,
      name,
      last_name,
      avatar
    ),
    group_members!group_members_group_id_fkey (
      role,
      joined_at
    )
  `)
  .eq('group_members.user_id', user.id);

// –°—Ç–∞–ª–æ: –†–æ–∑–¥—ñ–ª–µ–Ω—ñ –∑–∞–ø–∏—Ç–∏
const { data: groupsData, error: groupsError } = await supabase
  .from('groups')
  .select(`
    *,
    creator:user_profiles!groups_created_by_fkey (
      id,
      name,
      last_name,
      avatar
    )
  `)
  .eq('is_active', true)
  .order('last_activity', { ascending: false });

// –û–∫—Ä–µ–º–∏–π –∑–∞–ø–∏—Ç –¥–ª—è —á–ª–µ–Ω—Å—Ç–≤–∞
const { data: membershipsData, error: membershipsError } = await supabase
  .from('group_members')
  .select('group_id, role, joined_at')
  .eq('user_id', user.id);
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:**
- ‚úÖ –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –≥—Ä—É–ø–∏, –∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ —Ç—ñ, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î —á–ª–µ–Ω–æ–º
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–≤'—è–∑–∫–∏ –∑ `user_profiles`
- ‚úÖ –ö—Ä–∞—â–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –∑–∞–ø–∏—Ç–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 3. –°—Ç–≤–æ—Ä–µ–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó

#### `GROUPS_FIX_INSTRUCTIONS.md`
- –î–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º
- –ü–æ—è—Å–Ω–µ–Ω–Ω—è –∑–º—ñ–Ω –≤ –∫–æ–¥—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ –ø—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å
- –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–æ–∂–ª–∏–≤–∏—Ö –ø—Ä–æ–±–ª–µ–º

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ñ groups –ø—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

```sql
CREATE TABLE groups (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  avatar text,
  is_private boolean DEFAULT false,
  created_by uuid NOT NULL REFERENCES user_profiles(id),
  created_at timestamptz DEFAULT now(),
  member_count integer DEFAULT 1,
  category text,
  tags text[] DEFAULT '{}',
  location text,
  website text,
  rules text[] DEFAULT '{}',
  contactemail text,
  cover text,
  post_count integer DEFAULT 0,
  is_verified boolean DEFAULT false,
  is_active boolean DEFAULT true,
  last_activity timestamptz DEFAULT now()
);
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ñ group_members

```sql
CREATE TABLE group_members (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL REFERENCES groups(id) ON DELETE CASCADE,
  user_id uuid NOT NULL REFERENCES user_profiles(id) ON DELETE CASCADE,
  role text DEFAULT 'member' CHECK (role IN ('admin', 'moderator', 'member')),
  joined_at timestamptz DEFAULT now(),
  UNIQUE(group_id, user_id)
);
```

## –ö—Ä–æ–∫–∏ –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

1. **–í–∏–∫–æ–Ω–∞–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—é –ë–î**:
   - –ó–∞–ø—É—Å—Ç—ñ—Ç—å `fix_groups_database.sql` –≤ Supabase SQL Editor
   - –ê–±–æ –≤–∏–∫–æ–Ω–∞–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—é `20250125000000_fix_groups_user_profiles.sql`

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É**:
   - –ó–∞–ø—É—Å—Ç—ñ—Ç—å `test_groups_functionality.sql` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

3. **–ö–æ–¥ –≤–∂–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π**:
   - –ó–º—ñ–Ω–∏ –≤ `useGroups.ts` –≤–∂–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ

4. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**:
   - –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≥—Ä—É–ø
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
   - –°–ø—Ä–æ–±—É–π—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø—É —Ç–∞ –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –Ω–µ—ó

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚úÖ –í—Å—ñ –≥—Ä—É–ø–∏ –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å—Ç–≤–æ—Ä–Ω–∏–∫–∞ –≥—Ä—É–ø–∏ –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏—Å—è
- ‚úÖ –ß–ª–µ–Ω—Å—Ç–≤–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±—É–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä—É–ø –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
- ‚úÖ –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è/–≤–∏—Ö—ñ–¥ –∑ –≥—Ä—É–ø –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
- ‚úÖ –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ –ø–æ—à—É–∫ –±—É–¥—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–ö–æ–¥ –º—ñ—Å—Ç–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è:
- `üîç` - –ø–æ—á–∞—Ç–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- `‚úÖ` - —É—Å–ø—ñ—à–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è  
- `‚ùå` - –ø–æ–º–∏–ª–∫–∞

–¶–µ –¥–æ–ø–æ–º–æ–∂–µ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–Ω—É—Ç–∏. 