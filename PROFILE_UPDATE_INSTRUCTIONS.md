# Інструкції для оновлення профілю користувача

## Що було зроблено

### 1. Оновлено форму редагування профілю
- Додано дві колонки для кращого розподілу полів
- Додано кнопку "Завантажити аватар" з функціональністю завантаження файлів
- Покращено макет та стилізацію полів
- Додано іконку календаря для поля дати народження
- Додано валідацію полів (email, телефон, веб-сайт, біо)

### 2. Додано нові поля до інтерфейсу UserProfile
- `education` - освіта
- `phone` - телефон
- `hobbies` - хобі (масив)
- `relationship_status` - сімейний стан
- `work` - робота
- `website` - веб-сайт
- `languages` - мови (масив)

### 3. Створено міграцію бази даних
Файл: `supabase/migrations/20250128000004_add_profile_fields.sql`

### 4. Додано нові компоненти та функції
- `FileUpload` компонент для завантаження аватара
- Валідація форми з перевіркою email, телефону, веб-сайту
- Відображення додаткової інформації в режимі перегляду профілю
- Покращена обробка помилок та повідомлень

## Що потрібно зробити

### 1. Виконати міграцію бази даних

Зайдіть в Supabase Dashboard → SQL Editor і виконайте наступний SQL скрипт:

```sql
-- Додавання відсутніх полів до таблиці user_profiles
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS education TEXT;
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS phone TEXT;
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS hobbies TEXT[] DEFAULT '{}';
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS relationship_status TEXT;
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS work TEXT;
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS website TEXT;
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS languages TEXT[] DEFAULT '{}';
```

### 2. Налаштувати Supabase Storage для аватара

1. Зайдіть в Supabase Dashboard → Storage
2. Створіть новий bucket з назвою `avatars`
3. Налаштуйте політики доступу для bucket `avatars`:

```sql
-- Політика для завантаження аватара (тільки авторизовані користувачі)
CREATE POLICY "Users can upload avatars" ON storage.objects
FOR INSERT WITH CHECK (bucket_id = 'avatars' AND auth.role() = 'authenticated');

-- Політика для перегляду аватара (публічний доступ)
CREATE POLICY "Anyone can view avatars" ON storage.objects
FOR SELECT USING (bucket_id = 'avatars');

-- Політика для оновлення аватара (тільки власник)
CREATE POLICY "Users can update their avatars" ON storage.objects
FOR UPDATE USING (bucket_id = 'avatars' AND auth.uid()::text = (storage.foldername(name))[1]);

-- Політика для видалення аватара (тільки власник)
CREATE POLICY "Users can delete their avatars" ON storage.objects
FOR DELETE USING (bucket_id = 'avatars' AND auth.uid()::text = (storage.foldername(name))[1]);
```

### 3. Перевірити функціональність

1. Запустіть проект: `npm run dev`
2. Зайдіть на сторінку профілю
3. Натисніть "Редагувати профіль"
4. Перевірте, що всі поля відображаються правильно:
   - Ліва колонка: Ім'я, Email, Про себе, Місто, Освіта, Телефон, Хобі, Сімейний стан
   - Права колонка: Прізвище, Аватар, День народження, Робота, Веб-сайт, Мови

### 4. Тестування функціональності

1. **Додавання хобі**: Введіть текст в поле "Хобі" і натисніть Enter
2. **Додавання мов**: Введіть текст в поле "Мови" і натисніть Enter
3. **Видалення тегів**: Натисніть X на тегах хобі або мов
4. **Завантаження аватара**: Натисніть "Завантажити аватар" і виберіть зображення
5. **Валідація**: Спробуйте ввести невірний email або веб-сайт
6. **Збереження**: Натисніть "Зберегти" і перевірте, що дані зберігаються

### 5. Перевірка бази даних

Виконайте наступний запит в Supabase SQL Editor для перевірки структури:

```sql
SELECT 
    column_name, 
    data_type, 
    is_nullable, 
    column_default
FROM information_schema.columns 
WHERE table_name = 'user_profiles'
ORDER BY ordinal_position;
```

## Поля, які відповідають фото

✅ **Ім'я** - є в коді  
✅ **Email** - є в коді  
✅ **Про себе** - є в коді (bio)  
✅ **Місто** - є в коді  
✅ **Освіта** - додано  
✅ **Телефон** - додано  
✅ **Хобі** - додано  
✅ **Сімейний стан** - додано  
✅ **Прізвище** - є в коді  
✅ **Аватар** - є в коді + кнопка завантаження  
✅ **День народження** - є в коді  
✅ **Робота** - додано  
✅ **Веб-сайт** - додано  
✅ **Мови** - додано  

## Можливі проблеми та рішення

### Проблема: Поля не зберігаються
**Рішення**: Перевірте, чи виконана міграція бази даних

### Проблема: Помилка TypeScript
**Рішення**: Перезапустіть TypeScript сервер в IDE

### Проблема: Поля не відображаються
**Рішення**: Перевірте, чи правильно оновлений інтерфейс UserProfile

### Проблема: Не вдається завантажити аватар
**Рішення**: 
1. Перевірте, чи створений bucket `avatars` в Supabase Storage
2. Перевірте, чи налаштовані політики доступу для bucket
3. Перевірте, чи файл не перевищує 5MB
4. Перевірте, чи файл є зображенням (jpg, png, gif, etc.)

### Проблема: Помилка валідації
**Рішення**: Перевірте формат введених даних:
- Email повинен бути у форматі user@domain.com
- Телефон може містити цифри, пробіли, дефіси, дужки
- Веб-сайт повинен починатися з http:// або https://

## Додаткові покращення

1. **Автозбереження**: Додати автоматичне збереження при зміні полів
2. **Попередній перегляд**: Додати можливість попереднього перегляду змін
3. **Розширена валідація**: Додати більше перевірок для полів
4. **Обрізка зображень**: Додати можливість обрізки аватара перед завантаженням
5. **Експорт профілю**: Додати можливість експорту даних профілю
6. **Імпорт профілю**: Додати можливість імпорту даних з інших соціальних мереж 