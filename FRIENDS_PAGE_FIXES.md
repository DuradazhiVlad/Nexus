# Виправлення сторінки друзів

## Проблеми, які були виправлені

### 1. Навігація на сторінку користувача

**Проблема**: Кнопки переходу на сторінку друга використовували старий шлях `/profile/${friend.auth_user_id}` замість нового `/user/${friend.id}`.

**Рішення**: Оновлено навігацію в двох місцях:
- При кліку на ім'я друга
- При кліку на кнопку "Переглянути профіль"

```typescript
// Було:
onClick={() => navigate(`/profile/${friend.auth_user_id}`)}

// Стало:
onClick={() => navigate(`/user/${friend.id}`)}
```

### 2. Навігація до повідомлень

**Проблема**: Непослідовність у використанні ID для навігації до повідомлень.

**Рішення**: Оновлено для використання `friend.id` замість `friend.auth_user_id`:

```typescript
// Було:
onClick={() => navigate(`/messages?user=${friend.auth_user_id}`)}

// Стало:
onClick={() => navigate(`/messages?user=${friend.id}`)}
```

### 3. Структура даних

**Проблема**: Неправильне використання полів з бази даних:
- Використання `last_name` замість `lastname`
- Неправильне співставлення ID між таблицями

**Рішення**: 
- Оновлено інтерфейс `Friend` для використання `lastname`
- Виправлено відображення імен у компонентах
- Додано детальне логування для відстеження даних

### 4. Запити до бази даних

**Проблема**: Неправильне співставлення між `auth.users(id)` та `users(auth_user_id)`.

**Рішення**: 
- Оновлено `fetchFriends()` для правильного отримання друзів
- Оновлено `fetchRequests()` для правильного отримання запитів
- Додано перевірки на порожні масиви
- Додано детальне логування для відстеження процесу

### 5. Функція додавання друзів

**Проблема**: Неправильне використання ID при додаванні друзів з результатів пошуку.

**Рішення**: Оновлено для використання `auth_user_id`:

```typescript
// Було:
onClick={() => addFriend(user.id)}

// Стало:
onClick={() => addFriend(user.auth_user_id)}
```

## Структура даних

### Таблиця `friendships`
- `user1_id` та `user2_id` посилаються на `auth.users(id)`
- Використовується для зберігання підтверджених дружб

### Таблиця `users`
- `id` - унікальний ідентифікатор користувача
- `auth_user_id` - посилання на `auth.users(id)`
- Використовується для зберігання профільної інформації

### Таблиця `friend_requests`
- `sender_id` та `receiver_id` посилаються на `auth.users(id)`
- Використовується для зберігання запитів на дружбу

## Логування

Додано детальне логування для відстеження:
- Отримання даних друзів
- Отримання запитів на дружбу
- Процес додавання друзів
- Структуру даних на кожному етапі

## Тестування

Для перевірки виправлень:

1. **Перейдіть на сторінку друзів** (`/friends`)
2. **Спробуйте пошук користувачів** - повинно працювати
3. **Клікніть на ім'я друга** - повинно перейти на `/user/:userId`
4. **Клікніть на кнопку профілю** - повинно перейти на `/user/:userId`
5. **Клікніть на кнопку повідомлень** - повинно перейти на `/messages?user=:userId`

## Наступні кроки

1. **Перевірте консоль браузера** для логів
2. **Перевірте навігацію** між сторінками
3. **Перевірте функціональність додавання друзів**
4. **Перевірте відображення списку друзів**

Якщо виникають проблеми, перевірте:
- Логи в консолі браузера
- Мережеві запити в DevTools
- Структуру даних в базі даних 